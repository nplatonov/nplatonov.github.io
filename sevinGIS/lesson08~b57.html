<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ГИС 08</title>
    <meta charset="utf-8" />
    <script src="https://nplatonov.github.io/site_libs/header-attrs-2.29/header-attrs.js"></script>
    <link href="https://nplatonov.github.io/site_libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="https://nplatonov.github.io/site_libs/remark-css-0.0.1/hygge.css" rel="stylesheet" />
    <link href="https://nplatonov.github.io/site_libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="https://nplatonov.github.io/site_libs/tile-view-0.2.6/tile-view.js"></script>
    <script src="https://nplatonov.github.io/site_libs/xaringanExtra_fit-screen-0.2.6/fit-screen.js"></script>
    <script src="https://nplatonov.github.io/site_libs/js-cookie-3.0.0/js.cookie.js"></script>
    <script src="https://nplatonov.github.io/site_libs/peerjs-1.3.1/peerjs.min.js"></script>
    <script src="https://nplatonov.github.io/site_libs/tiny.toast-1.0.0/toast.min.js"></script>
    <link href="https://nplatonov.github.io/site_libs/xaringanExtra-broadcast-0.2.6/broadcast.css" rel="stylesheet" />
    <script src="https://nplatonov.github.io/site_libs/xaringanExtra-broadcast-0.2.6/broadcast.js"></script>
    <script src="https://nplatonov.github.io/site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <link href="https://nplatonov.github.io/site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
    <script src="https://nplatonov.github.io/site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <link href="https://nplatonov.github.io/site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="https://nplatonov.github.io/site_libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="https://nplatonov.github.io/site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="https://nplatonov.github.io/site_libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="https://nplatonov.github.io/site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="https://nplatonov.github.io/site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="https://nplatonov.github.io/site_libs/leaflet-binding-2.2.2/leaflet.js"></script>
    <script src="https://nplatonov.github.io/site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
    <script src="https://nplatonov.github.io/site_libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
    <link rel="stylesheet" href="https://nplatonov.github.io/site_libs/common.css" type="text/css" />
    <link rel="stylesheet" href="https://nplatonov.github.io/site_libs/moon_reader.css" type="text/css" />
    <link rel="stylesheet" href="https://nplatonov.github.io/site_libs/moon_reader-fonts.css" type="text/css" />
    <link rel="stylesheet" href="assets/general/general.css" type="text/css" />
  </head>
  <body>

<div id="loader" class="loader"></div>

<style>
.remark-backdrop:after{
   content: 'Никита Платонов \A \A ГИС аспирантура';
}
</style>

    <textarea id="source">

layout: true








.toc.banner[

.shorttitle[
[ГИС аспирантура](break.html#home)
]

]

---
name: home
class: metadata customtitle middle left giphy

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[






.authors[


.author[Никита&nbsp;Платонов]


.institute[с.н.с. ИПЭЭ РАН]



]


.title[
Операции с геометрией
]


.subtitle[
ГИС технологии в биологических исследованиях
]


.what[
Занятие 08
]


.where[

]


.when[
 .updated[Обновлено: 2025-04-03 13:38]
]



]






---
name: difference

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference).fg[]
### ["Геообработка"](#difference).fg[].bg[]
### ["Геометрия" ](#Hd5674)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h3.broad[
"Геообработка" .parent[.grand[Инструменты QGIS]]
]

.fixprecode[



<img src="assets/lesson08/QGIS-geoprocessing.png" width="1330" height="700" style="display: block; margin: auto auto auto 0;" />


]
]
---

name: Hd5674

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference).fg[]
### ["Геообработка"](#difference)
### ["Геометрия" ](#Hd5674).fg[].bg[]
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[



.header.h3.broad[
"Геометрия" .parent[.grand[Инструменты QGIS]]
]

.fixprecode[



<img src="assets/lesson08/QGIS-geometry.png" width="1330" height="700" style="display: block; margin: auto auto auto 0;" />


]
]
---

name: H90e56

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56) <span class="bullet bullet-active">[&#8226;](#H90e56)</span><span class="bullet mslide9m">[&#8226;](#Ha5c44)</span><span class="bullet mslide10m">[&#8226;](#Hc9837)</span>.fg[].bg[]
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Данные и методы
]

.fixprecode[


Пакет для визуализации: `tmap`.


``` r
require(tmap)
```

```
Loading required package: tmap
```

``` r
tmap_mode("view") ## plot view
```

```
ℹ tmap mode set to "view".
```



Пакет для геообработки: `sf`.

[Шпаргалка](https://github.com/r-spatial/sf/wiki/Migrating) по миграции между `sp` и `sf`:

<iframe src="https://github.com/r-spatial/sf/wiki/Migrating" width="1330" height="300" data-external="1"></iframe>


]
]
---

name: Ha5c44

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56) <span class="bullet bullet">[&#8226;](#H90e56)</span><span class="bullet bullet-active">[&#8226;](#Ha5c44)</span><span class="bullet mslide10m">[&#8226;](#Hc9837)</span>.fg[].bg[]
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Данные и методы
]

.fixprecode[



``` r
hr <- sf::st_read("data/hr.geojson",quiet=TRUE) |>
   sf::st_transform(3572)
sf::st_agr(hr) <- "constant"
hr2 <- lapply(unique(hr$id),function(id) {
   hr2 <- hr[hr$id==id,]
   ulevel <- unique(hr2$level)
   hr3 <- lapply(ulevel,function(level) hr2[hr2$level==level,])
   names(hr3) <- ulevel
   hr4 <- list('50-95'=sf::st_difference(sf::st_geometry(hr3[["95"]])
                                        ,sf::st_geometry(hr3[["50"]]))
              ,'0-50'=sf::st_geometry(hr3[["50"]])
              )
   sf::st_sf(id=id,level=names(hr4)
            ,geometry=do.call(rbind,hr4),crs=sf::st_crs(hr))
})
hr2 <- do.call(rbind,hr2)
hr2 <- sf::st_transform(hr2,4326)
hr2$group <- paste(hr2$id,hr2$level,sep=":")
```


]
]
---

name: Hc9837

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56) <span class="bullet bullet">[&#8226;](#H90e56)</span><span class="bullet bullet">[&#8226;](#Ha5c44)</span><span class="bullet bullet-active">[&#8226;](#Hc9837)</span>.fg[].bg[]
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Данные и методы
]

.fixprecode[



``` r
m1 <- tm_shape(hr2)+tm_polygons("group",fill_alpha=0.5,group="Kernel levels")
```

``` r
# try(print(m1))
m1
```

<style>#legend01 { background: #FFFFFF; opacity: 1}</style>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-c29c94efa57ad9fbfdc1" style="width:1330px;height:700px;"></div>
<script type="application/json" data-for="htmlwidget-c29c94efa57ad9fbfdc1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"attributionControl":true},"calls":[{"method":"createMapPane","args":["tmap401",401]},{"method":"addLayersControl","args":[["Esri.WorldGrayCanvas","OpenStreetMap","Esri.WorldTopoMap"],"Kernel levels",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addProviderTiles","args":["Esri.WorldGrayCanvas",null,"Esri.WorldGrayCanvas",{"minZoom":0,"maxZoom":18,"maxNativeZoom":17,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"maxNativeZoom":17,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldTopoMap",null,"Esri.WorldTopoMap",{"minZoom":0,"maxZoom":18,"maxNativeZoom":17,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addPolygons","args":[[[[{"lng":[-153.1044163789101,-152.9586252939537,-152.9337108935632,-152.6013136045105,-152.2609129470039,-151.9168525626025,-151.5734674725988,-151.3300431449598,-151.2322227625791,-151.0919533327897,-151.0933250975193,-151.163192415125,-151.2304014429477,-151.2172006792914,-151.0159024525957,-150.9214854999664,-150.5651864927439,-150.2065164191007,-150.0167447138368,-149.8492942997123,-149.7034412567944,-149.5209285220855,-149.4984326145262,-149.3353280836584,-149.1555820659199,-149.1460498672918,-148.9375210987336,-148.8203858973656,-148.4691125969976,-148.465202691537,-148.3857013102079,-148.2839359638371,-148.0882932965087,-148.0828602399512,-147.8160583212181,-147.7179790685231,-147.3519693672307,-147.2713502095683,-146.9895272889442,-146.6310613276403,-146.2775799324455,-146.0129814519477,-145.9284791749692,-145.5803711397181,-145.2380851002242,-144.9899647209044,-144.8967631700476,-144.5499996151514,-144.2005681829657,-143.8475482183214,-143.494656377961,-143.1431853417545,-142.7958794684262,-142.4514507473477,-142.1084934281789,-141.7651124772745,-141.4201672818838,-141.0699315474621,-140.7110737383143,-140.6314658271328,-140.3312126778522,-139.9853537508392,-139.9502729367483,-139.5673611739519,-139.2062231900017,-138.857955410583,-138.5243157324998,-138.2192277313841,-138.1472842893569,-137.9331280585637,-137.8158301542697,-137.6785049465858,-137.6008857755581,-137.4100133098413,-137.0853985008496,-136.7217569295589,-136.3617261377766,-136.3043888124904,-136.000796416704,-135.649001611249,-135.2987413635639,-135.0548711243725,-134.92757943393,-134.5879856595419,-134.4973108044713,-134.3342943899964,-134.1294430136155,-133.9700976823642,-133.8801003091932,-133.8435023264994,-133.7938898673697,-133.7166275463975,-133.6146206200355,-133.5015944538999,-133.4050313607048,-133.3322787330059,-133.2732333838768,-133.1912361909115,-133.1010250521389,-132.9803546153739,-132.8313588466571,-132.6095837472301,-132.3356301460466,-132.2748996936304,-131.8297603294686,-131.8278163057701,-131.3795138675969,-130.9822247730547,-130.614981546105,-130.2751934721243,-129.9856472256894,-129.9094939196589,-129.7674297724023,-129.7382648587083,-129.6709841036866,-129.7187301776141,-129.7694909414362,-129.8006222238785,-129.8871222050638,-129.9942340955406,-130.118238324646,-130.2659730148622,-130.4309116033116,-130.4809161196474,-130.5972539996152,-130.7717392813656,-130.9547050014901,-131.1401928664277,-131.2878050183671,-131.3805569309308,-131.4115775751119,-131.362123034052,-131.3529888655523,-131.091713858359,-130.7871141248617,-130.4734213122873,-130.1531639891256,-129.8337882233097,-129.5188688873664,-129.221516881181,-129.0389900531725,-128.9383940151834,-128.6730265437547,-128.5241990055587,-128.4644475061655,-128.3571533441265,-128.3498673217775,-128.3434731100654,-128.3573642938748,-128.4510450171405,-128.5821949867652,-128.7523014523807,-128.9371796009676,-128.9850110877484,-129.0909285817368,-129.2347203968548,-129.4067087587038,-129.6264015783817,-129.7460978222244,-129.8597977448485,-130.1406084559716,-130.2361259689339,-130.4390341171276,-130.6675237519083,-130.7886169556874,-131.0723131257595,-131.1585753686551,-131.4635948984355,-131.5515251308159,-131.844522719153,-131.9726537347067,-132.2158596441897,-132.4197213537949,-132.5781371793381,-132.9238176819321,-132.935627753578,-133.2780824528697,-133.5399815992869,-133.6033482794947,-133.9386276917738,-134.2509280865713,-134.3907374000193,-134.5713432625997,-134.8983810017465,-135.1867156865191,-135.2170849892728,-135.5569658620699,-135.863973776341,-135.8735462835127,-136.1992827311226,-136.5079367764502,-136.8055103246013,-137.0962737931087,-137.3782402143158,-137.643964687359,-137.6838500277329,-137.9168359415574,-138.1524904455433,-138.167789062518,-138.4192886704982,-138.4706260700326,-138.6738457958263,-138.7967832483156,-138.9300689762487,-139.1298350326502,-139.1910423185349,-139.4556071009048,-139.4944967161248,-139.7233114896858,-139.8430614006424,-139.9878997080864,-140.1673268096939,-140.2571745260385,-140.5390471110538,-140.6466865194748,-140.8402616755228,-141.1534834809636,-141.4738691824604,-141.7924352096507,-142.1088310191709,-142.4289232521109,-142.7372163052424,-142.7581415732836,-143.1004017302167,-143.2791205377092,-143.4534817381167,-143.5950995108223,-143.767619493249,-143.8432561988268,-143.8606192718529,-143.9889415320349,-144.2314160866684,-144.2929533484703,-144.5515541645595,-144.8563825769122,-144.8595787212822,-145.0516723935235,-145.0903228900782,-145.0526971325129,-145.0542581882467,-145.0589814065524,-145.1670107559476,-145.3304049518032,-145.3575869202199,-145.6191413555183,-145.6243195097839,-145.9264390243923,-145.9266062194814,-146.2410024288757,-146.5627773405662,-146.8929743758187,-147.2254629444584,-147.557788442761,-147.8905079283827,-147.9255272899967,-148.2251945526902,-148.50855977829,-148.5564234360351,-148.8853821441794,-149.2112297755756,-149.5361309811929,-149.7758308323872,-149.8616857194945,-150.1891833141525,-150.3046098285463,-150.5190054190857,-150.8509006105837,-150.889411561691,-151.1835440171982,-151.5177672439339,-151.7195121155726,-151.8541326485993,-152.1933602874662,-152.3446768361958,-152.53522819375,-152.8375874191027,-152.8838832936765,-153.0635109929983,-153.1044163789101],"lat":[71.79412496520509,71.90565051834488,71.91513621631228,71.98457575872513,72.0096433669944,72.00825842444871,72.01325997726138,72.03398602236072,72.05172361010746,72.14446380553353,72.25332377273756,72.36174738608237,72.47015044900107,72.57905880091344,72.68905833183331,72.7156615025541,72.75676889176269,72.73874087185811,72.69180115431718,72.64007116218013,72.5827874843073,72.47360873166575,72.4585035032345,72.36421644419961,72.25784902144551,72.25459474406054,72.14463803942539,72.05591429041807,72.13409931643311,72.14127158665545,72.24947662545503,72.35743270075683,72.46018178249618,72.46432776580301,72.57025632404041,72.59685950553813,72.66639780341336,72.67199272996641,72.69779647569953,72.70129168860228,72.68017825595315,72.64946289310673,72.6433370923949,72.60777520843807,72.5553639389861,72.51566176705219,72.50605451004125,72.47992844455455,72.46442112479681,72.46033349293884,72.4557056823683,72.447265582646,72.42882530930839,72.40472889927244,72.37881754621627,72.35534943289078,72.33635760099854,72.32868201218974,72.33734636794634,72.34555661045489,72.38301297064395,72.42173491559994,72.42638713167362,72.46917243780538,72.47303505449543,72.45581508228842,72.41671881133165,72.33675424402244,72.31150840272372,72.23253024092914,72.17817037852339,72.08727909154149,72.05200635010495,71.96718243417655,71.92984745989529,71.94647623048606,71.95679175258191,71.9567923608718,71.96703068760402,71.96472797449967,71.9600053135685,71.96785325117499,71.97949778637809,72.04053043367213,72.06488969833079,72.13127672691526,72.22623520905019,72.32521886549915,72.43042203821098,72.5404237369697,72.64928708047995,72.75572672536066,72.86001016961211,72.96335481482841,73.0682005897216,73.17519933599301,73.28344791854067,73.38970577263709,73.49528172891411,73.59821620195481,73.69869012413423,73.7927221166054,73.85987575932708,73.87653530481465,73.9495631959539,73.94972668858958,73.98699267795489,73.97859771749778,73.94571503176755,73.89170372708611,73.79970459688896,73.760850171831,73.65438620609602,73.62709163832075,73.50407191884013,73.39335865351241,73.33858130080313,73.28638190382782,73.17996676707958,73.07585053470193,72.97363206649449,72.87404543202508,72.77636862300741,72.75158687378391,72.678884944822,72.58231066201485,72.48666789344814,72.39130972363694,72.29196853982302,72.18688110589714,72.07530524656015,71.96021920080263,71.95416403917099,71.87519024947306,71.82352688932576,71.78113344659668,71.7453334916049,71.7092834123391,71.66989277660502,71.61611061649967,71.57066509297643,71.55128172202924,71.472808213395,71.38855650694261,71.34860330936334,71.24963803819568,71.14807056386576,71.13054968054323,71.01507958081355,70.91023813491162,70.81044123018648,70.71586269763412,70.62326127420029,70.59968451181686,70.52659176232349,70.42866078881652,70.33445446337805,70.24644980600547,70.21085329944677,70.16014956871187,70.07979059248568,70.05832368323685,70.00143207971313,69.95610298590472,69.92912965079269,69.87580495472898,69.8588445684147,69.80544990270657,69.7907508339362,69.7424850865866,69.72528614624026,69.68671055233185,69.66197473148347,69.63813235022076,69.60618368119266,69.60534531343819,69.56188229406391,69.55681543913852,69.55055455747312,69.52553611727011,69.52825016592733,69.53138931141008,69.51981748864425,69.50149626151855,69.49639167756182,69.49313349133627,69.45397060084773,69.44685834202156,69.44586773841205,69.4232176429358,69.42470500090648,69.44281317702358,69.47194772194361,69.51607214693648,69.58841735669438,69.60150058286128,69.65144393893206,69.74924938231548,69.75431324534691,69.86020796017743,69.88426488483069,69.96492218372046,70.01887883529253,70.07096498941844,70.15296979694455,70.172837341475,70.27253275197099,70.28809690825246,70.37085314750962,70.42107481265157,70.47999236050386,70.55156070070771,70.58520115305548,70.67013384966,70.68990872761071,70.71904019918294,70.74452570774652,70.75506197792738,70.77006150484735,70.7909432299451,70.80353292628213,70.79358161235379,70.79230465437472,70.7428160272304,70.70623100583272,70.65534434744322,70.60880436824591,70.50556422200192,70.39861188258241,70.38480874261268,70.2942163049342,70.20124741145079,70.19533674088352,70.17910184595492,70.21308755234271,70.21412542989982,70.32962490536212,70.44033697270832,70.54876014516893,70.65832950075807,70.66262944809705,70.77110375094487,70.86991011099784,70.88589266992284,71.00222118527805,71.00426449576138,71.11909024362699,71.1191417337245,71.18910068147532,71.23161565643711,71.23105765818238,71.21402126629974,71.19289087956034,71.16081726454797,71.15483345923087,71.09484305332236,71.05179497345593,71.04335941469499,70.99954475519128,70.99415119836856,71.01929938623165,71.05813142461319,71.07005990146475,71.14238056238456,71.16703655465849,71.20816489515398,71.2686311994631,71.27403631902571,71.30664442862911,71.34710032983952,71.37683861555993,71.39415035913959,71.45066150218922,71.47862442613942,71.51091340307987,71.58043561445946,71.60004227204169,71.685753105752,71.79412496520509]},{"lng":[-138.2492602010831,-138.1358381872089,-138.1044625377537,-138.0004665649631,-137.8878377446911,-137.8190975157317,-137.6579649763184,-137.5885836335705,-137.4106687299292,-137.21151921199,-137.1467850913591,-136.8650223593411,-136.571286532777,-136.2642662922778,-135.9457469422208,-135.9386519321383,-135.6101968221177,-135.2906029885345,-135.2723810859187,-134.9393262938764,-134.6149772317477,-134.3889401870476,-134.2982838496878,-133.9804095749284,-133.649456161871,-133.4638219244434,-133.3133275742513,-132.961047759287,-132.8912631507873,-132.5912197113828,-132.4531912711258,-132.2102346399797,-132.0532922186614,-131.8082341544329,-131.7020454311658,-131.3955308946136,-131.3559847277129,-131.035340703572,-130.9563429495695,-130.7732147169518,-130.5378467598001,-130.3745221669775,-130.3732890409084,-130.3603006755027,-130.2705093295173,-130.2288753848505,-130.2178078369051,-130.2720936005837,-130.4172737545676,-130.5299820695275,-130.7763489739742,-130.8666612734776,-131.2414044994624,-131.3762065480356,-131.6249953481165,-131.9636447105989,-132.271167919513,-132.5600153996541,-132.8415756944146,-132.9447209525672,-133.1267158752674,-133.4356171238898,-133.7712976286727,-133.8330295021679,-134.133783401803,-134.4068139526086,-134.5254860058442,-134.8553459190378,-134.9214304277387,-135.2827064433631,-135.3173162049452,-135.6891014860865,-135.8444315507859,-136.0456673805263,-136.3758646074408,-136.7027569748536,-137.0457960913889,-137.0817006025454,-137.3991550771734,-137.7025051846745,-137.7652061881712,-138.0621417231236,-138.1805138801822,-138.2496953918881,-138.2888838922627,-138.2810444989144,-138.2492602010831],"lat":[70.53720940679024,70.41754868835756,70.39151359759171,70.29606757972489,70.22055617806929,70.17086254319027,70.07650082155297,70.04145867628169,69.96490527721107,69.89974402412395,69.88299622604492,69.83120743106707,69.79896546395992,69.78696067660663,69.7912949129158,69.79166527755098,69.81849633272043,69.84525184867594,69.8468643639527,69.86700873776908,69.87439596569303,69.87159456814854,69.8711765538432,69.8689328216104,69.88200138246005,69.89063599523588,69.90002554611684,69.93535031328412,69.94340308323727,69.988316356152,70.00952768736978,70.05056341880632,70.07913258280337,70.13184778349247,70.1537039359613,70.21985738133206,70.22842407266732,70.3057465321719,70.32981347943519,70.38980501620031,70.47696384333996,70.57191972477384,70.57270073633237,70.58557413356256,70.67602097139579,70.7868537932745,70.90141982418746,70.99294390277971,71.04117208203365,71.07588965104054,71.08338915452222,71.08517745850925,71.05676966105244,71.03677789474159,71.01750225871194,71.02202935067314,71.05860690297519,71.11567997392761,71.18194782252267,71.20475754146135,71.24598590683556,71.28536987682305,71.2953720662873,71.29233130732143,71.27405485317591,71.23290259530152,71.21612384395866,71.16070038810123,71.14911518401314,71.08577943511069,71.07771243829157,71.03313619257736,71.02147854214824,71.00593219422139,71.01305167213512,71.02454389957735,71.01250104525739,71.00900276156116,70.98364609570049,70.94382115060677,70.93274773344245,70.85827008456067,70.7985968560444,70.76012592442679,70.65146975572718,70.63453456009395,70.53720940679024]}],[{"lng":[-129.3743362499303,-129.3029108470735,-128.8312630157842,-128.4341918609385,-128.2873094566151,-128.294478716276,-128.7043091599029,-128.8656665595142,-129.2866379835753,-129.4797321945802,-129.5593285531369,-129.5576609239551,-129.3743362499303],"lat":[76.10961825822899,76.13092285534904,76.15214738073698,76.10196650451195,76.03470055820898,75.91882437541757,75.84240265357283,75.83012909615093,75.85994387258141,75.91581229372304,75.98871156766327,76.03859347773393,76.10961825822899]}]],[[{"lng":[-138.2810444989144,-138.2888838922627,-138.2496953918881,-138.1805138801822,-138.0621417231236,-137.7652061881712,-137.7025051846745,-137.3991550771734,-137.0817006025454,-137.0457960913889,-136.7027569748536,-136.3758646074408,-136.0456673805263,-135.8444315507859,-135.6891014860865,-135.3173162049452,-135.2827064433631,-134.9214304277387,-134.8553459190378,-134.5254860058442,-134.4068139526086,-134.133783401803,-133.8330295021679,-133.7712976286727,-133.4356171238898,-133.1267158752674,-132.9447209525672,-132.8415756944146,-132.5600153996541,-132.271167919513,-131.9636447105989,-131.6249953481165,-131.3762065480356,-131.2414044994624,-130.8666612734776,-130.7763489739742,-130.5299820695275,-130.4172737545676,-130.2720936005837,-130.2178078369051,-130.2288753848505,-130.2705093295173,-130.3603006755027,-130.3732890409084,-130.3745221669775,-130.5378467598001,-130.7732147169518,-130.9563429495695,-131.035340703572,-131.3559847277129,-131.3955308946136,-131.7020454311658,-131.8082341544329,-132.0532922186614,-132.2102346399797,-132.4531912711258,-132.5912197113828,-132.8912631507873,-132.961047759287,-133.3133275742513,-133.4638219244434,-133.649456161871,-133.9804095749284,-134.2982838496878,-134.3889401870476,-134.6149772317477,-134.9393262938764,-135.2723810859187,-135.2906029885345,-135.6101968221177,-135.9386519321383,-135.9457469422208,-136.2642662922778,-136.571286532777,-136.8650223593411,-137.1467850913591,-137.21151921199,-137.4106687299292,-137.5885836335705,-137.6579649763184,-137.8190975157317,-137.8878377446911,-138.0004665649631,-138.1044625377537,-138.1358381872089,-138.2492602010831,-138.2810444989144,-138.2810444989144],"lat":[70.63453456009395,70.65146975572718,70.76012592442679,70.7985968560444,70.85827008456067,70.93274773344245,70.94382115060677,70.98364609570049,71.00900276156116,71.01250104525739,71.02454389957735,71.01305167213512,71.00593219422139,71.02147854214824,71.03313619257736,71.07771243829157,71.08577943511069,71.14911518401314,71.16070038810123,71.21612384395866,71.23290259530152,71.27405485317591,71.29233130732143,71.2953720662873,71.28536987682305,71.24598590683556,71.20475754146135,71.18194782252267,71.11567997392761,71.05860690297519,71.02202935067314,71.01750225871194,71.03677789474159,71.05676966105244,71.08517745850925,71.08338915452222,71.07588965104054,71.04117208203365,70.99294390277971,70.90141982418746,70.7868537932745,70.67602097139579,70.58557413356256,70.57270073633237,70.57191972477384,70.47696384333996,70.38980501620031,70.32981347943519,70.3057465321719,70.22842407266732,70.21985738133206,70.1537039359613,70.13184778349247,70.07913258280337,70.05056341880632,70.00952768736978,69.988316356152,69.94340308323727,69.93535031328412,69.90002554611684,69.89063599523588,69.88200138246005,69.8689328216104,69.8711765538432,69.87159456814854,69.87439596569303,69.86700873776908,69.8468643639527,69.84525184867594,69.81849633272043,69.79166527755098,69.7912949129158,69.78696067660663,69.79896546395992,69.83120743106707,69.88299622604492,69.89974402412395,69.96490527721107,70.04145867628169,70.07650082155297,70.17086254319027,70.22055617806929,70.29606757972489,70.39151359759171,70.41754868835756,70.53720940679024,70.63453456009395,70.63453456009395]}]],[[{"lng":[-152.4998694738958,-152.4920188619988,-152.4775143268782,-152.2826599653396,-152.1884164031457,-151.9498794657653,-151.8648299472612,-151.5357137737374,-151.2119467592573,-151.2022333190503,-150.8673314428779,-150.5308839758462,-150.1940969511931,-149.8577027048164,-149.8187460322775,-149.5218336182889,-149.1867796295723,-148.8520168822625,-148.5173212119576,-148.1825570842017,-147.8484756681575,-147.5163296435809,-147.1860955002375,-147.0813750380021,-146.8566333516036,-146.5289691986529,-146.2023421722002,-145.8706143230372,-145.5301788029578,-145.2918740000607,-145.1869999071183,-144.8407725216048,-144.502454871076,-144.1745597638876,-143.8573659356042,-143.7165112063728,-143.5463713299898,-143.2590146489747,-143.2467292856811,-142.9508335275694,-142.8901642350016,-142.6630635723579,-142.57399476137,-142.3784234013492,-142.2468116777801,-142.0934021694846,-141.875436571191,-141.8088353952141,-141.5197861466415,-141.3943861764983,-141.2294891841246,-140.947339593341,-140.9264653975934,-140.6705637887246,-140.5679669598283,-140.4148964386839,-140.3681474761916,-140.2449646730535,-140.2313870648528,-140.2341597073095,-140.2496647526534,-140.3176508080049,-140.3432514191508,-140.494304475715,-140.7282524986058,-140.7533659318725,-141.0661352114415,-141.2609086900029,-141.3843558610063,-141.6930503360504,-141.994197943456,-142.2877682315195,-142.5801747034988,-142.7545694989454,-142.8747741220831,-143.1699680301802,-143.4712844928775,-143.775552811295,-144.0802644485956,-144.3847843391197,-144.6884067597628,-144.9911556635263,-145.2942961703867,-145.5972041257502,-145.9000632631386,-146.2025012583597,-146.5039277370808,-146.8055055813165,-147.1072297673858,-147.1850944742579,-147.4119501584584,-147.7175989159632,-148.0241334896892,-148.3307499688134,-148.6374352096154,-148.9443607550956,-149.2515220855072,-149.3004327867687,-149.559734756995,-149.8687109720371,-150.039013262437,-150.1793816820988,-150.4921866376174,-150.5395689195744,-150.807604573787,-150.9433502442321,-151.1262651965829,-151.2933800228753,-151.449018573885,-151.588683695959,-151.777476480379,-151.8461681337818,-152.0847446322608,-152.112675432443,-152.2661387795086,-152.4162232770858,-152.4718607054581,-152.4743699807863,-152.4998694738958],"lat":[71.14918943039019,71.18743020328657,71.25862623655014,71.37038064323191,71.40837721941585,71.48345429839158,71.50185433593232,71.56708750718275,71.59907675285379,71.5999402872628,71.62679663564546,71.6325869495671,71.62427995586563,71.60495035489375,71.60313871628237,71.59221490198379,71.57098880776114,71.55697748208605,71.54795770106671,71.54244254618177,71.53219479890669,71.50962782934877,71.47914384541514,71.47001372266716,71.44990857433623,71.4159524109879,71.38216134780069,71.37636567637169,71.40741145278645,71.43102711943159,71.44411246616092,71.486329446333,71.49585449186205,71.47037380886607,71.41451435396618,71.38136478628883,71.34557230756057,71.25447052042766,71.25078490979844,71.1534499159159,71.12980426904922,71.04235412791684,71.00643012925002,70.93125876866533,70.88176476081813,70.82856892501378,70.75411562495187,70.73143098701679,70.65055857126443,70.61975129512828,70.57725959893064,70.49054699251222,70.48435591427018,70.39725547083184,70.35359767213552,70.26541173776232,70.23123418260907,70.11310026868865,70.00146168879081,69.98739238133622,69.89173821110016,69.814571798304,69.78659528658861,69.68489950312562,69.59708770348335,69.58950814362279,69.52704287634845,69.50784451051416,69.49786567919892,69.48945776113352,69.49922172017889,69.52939150660622,69.56459209133116,69.58358277786871,69.59578399376701,69.62729615851404,69.64185913346417,69.64750827124388,69.65158964959173,69.65619913820348,69.66418694179643,69.67610414130024,69.68723373814308,69.70035984079006,69.71504880439325,69.73372738113193,69.76092883488944,69.7916677069249,69.82714987543442,69.83311689629879,69.84670354321644,69.86254306337426,69.87349181177221,69.88677230718028,69.90428829673152,69.92660602540663,69.96001483685502,69.96545201646556,69.99073781736774,70.04625670128716,70.07617576025237,70.10099325281662,70.1734033557305,70.18449110140743,70.25395864288875,70.29185878210599,70.34617842032114,70.39867166136764,70.45318324348428,70.50528708633513,70.58383586431144,70.61181247569441,70.71819001801036,70.73545696542091,70.82501871873029,70.93210896457799,71.04046137704569,71.05200442679343,71.14918943039019]},{"lng":[-150.0799322776081,-149.8653763408546,-149.7740675088843,-149.5495378737533,-149.3526702731985,-149.2357787133261,-148.9231609521961,-148.6104057180912,-148.3054178136651,-148.2973652414936,-148.2537884076209,-147.9834218104764,-147.6683499570523,-147.3533624304402,-147.0382289270426,-146.7257895988381,-146.4156669360431,-146.2521594712861,-146.1059952659424,-145.7941909368214,-145.4832549657562,-145.1738146650685,-144.8675585916943,-144.5605092002239,-144.2525807923678,-143.939076173616,-143.6190765634142,-143.5164581781497,-143.2784495942609,-143.1802147828693,-143.1248981192834,-143.20616622387,-143.2570663847153,-143.4760560159014,-143.5298214275409,-143.7693291706398,-144.0770916715329,-144.3949972318713,-144.7214479981673,-145.048374343932,-145.3741925851378,-145.6947784685368,-146.0114761289517,-146.3259298124099,-146.6391826454207,-146.6688271777187,-146.9512239674185,-147.2504287213068,-147.2663989005282,-147.5839621219346,-147.9051080009487,-148.1814256429736,-148.2290396160171,-148.5541818439809,-148.8804082071011,-149.2071570251549,-149.5342893746045,-149.8615366273435,-150.1730749378913,-150.188323413111,-150.449975170485,-150.4419803167558,-150.3143653366271,-150.1846215118546,-150.0799322776081],"lat":[70.62196187042886,70.5457512888247,70.51270627278772,70.44851397703479,70.402454618193,70.37726977319963,70.32602138647378,70.29934119885863,70.28584427612219,70.28531583188307,70.28530496497974,70.28406653134641,70.29227557242817,70.29736631153234,70.30181739169873,70.28850627127879,70.2641027748781,70.25187094637565,70.24073316871649,70.23038063588179,70.21706780072303,70.19872871405346,70.16964980418587,70.14621456502753,70.12779277513113,70.12911699890689,70.15010105545413,70.16634217813709,70.22972968049535,70.26257903263303,70.37022262131302,70.44133295692676,70.48559198888474,70.58800533250103,70.60628552531992,70.67407550742368,70.72070260852479,70.73678474081166,70.72277206215114,70.70437578803259,70.68737037389265,70.69080866991312,70.71312266643207,70.75049995425228,70.801144776832,70.80740881443188,70.869218199432,70.9270535075551,70.93011271507925,70.98724672366509,71.02827799300337,71.04863781250548,71.05340303529259,71.07303472739994,71.0847828421207,71.09274334204454,71.09509807781188,71.0906444929922,71.05819056229949,71.05542304843929,70.9486383566185,70.83959114854035,70.73079041504778,70.67167633688048,70.62196187042886]}]],[[{"lng":[-150.1846215118546,-150.3143653366271,-150.4419803167558,-150.449975170485,-150.188323413111,-150.1730749378913,-149.8615366273435,-149.5342893746045,-149.2071570251549,-148.8804082071011,-148.5541818439809,-148.2290396160171,-148.1814256429736,-147.9051080009487,-147.5839621219346,-147.2663989005282,-147.2504287213068,-146.9512239674185,-146.6688271777187,-146.6391826454207,-146.3259298124099,-146.0114761289517,-145.6947784685368,-145.3741925851378,-145.048374343932,-144.7214479981673,-144.3949972318713,-144.0770916715329,-143.7693291706398,-143.5298214275409,-143.4760560159014,-143.2570663847153,-143.20616622387,-143.1248981192834,-143.1802147828693,-143.2784495942609,-143.5164581781497,-143.6190765634142,-143.939076173616,-144.2525807923678,-144.5605092002239,-144.8675585916943,-145.1738146650685,-145.4832549657562,-145.7941909368214,-146.1059952659424,-146.2521594712861,-146.4156669360431,-146.7257895988381,-147.0382289270426,-147.3533624304402,-147.6683499570523,-147.9834218104764,-148.2537884076209,-148.2973652414936,-148.3054178136651,-148.6104057180912,-148.9231609521961,-149.2357787133261,-149.3526702731985,-149.5495378737533,-149.7740675088843,-149.8653763408546,-150.0799322776081,-150.1846215118546,-150.1846215118546],"lat":[70.67167633688048,70.73079041504778,70.83959114854035,70.9486383566185,71.05542304843929,71.05819056229949,71.0906444929922,71.09509807781188,71.09274334204454,71.0847828421207,71.07303472739994,71.05340303529259,71.04863781250548,71.02827799300337,70.98724672366509,70.93011271507925,70.9270535075551,70.869218199432,70.80740881443188,70.801144776832,70.75049995425228,70.71312266643207,70.69080866991312,70.68737037389265,70.70437578803259,70.72277206215114,70.73678474081166,70.72070260852479,70.67407550742368,70.60628552531992,70.58800533250103,70.48559198888474,70.44133295692676,70.37022262131302,70.26257903263303,70.22972968049535,70.16634217813709,70.15010105545413,70.12911699890689,70.12779277513113,70.14621456502753,70.16964980418587,70.19872871405346,70.21706780072303,70.23038063588179,70.24073316871649,70.25187094637565,70.2641027748781,70.28850627127879,70.30181739169873,70.29736631153234,70.29227557242817,70.28406653134641,70.28530496497974,70.28531583188307,70.28584427612219,70.29934119885863,70.32602138647378,70.37726977319963,70.402454618193,70.44851397703479,70.51270627278772,70.5457512888247,70.62196187042886,70.67167633688048,70.67167633688048]}]]],["X1","X2","X3","X4"],"Kernel levels",{"interactive":true,"className":"","pane":"tmap401","stroke":true,"color":["#404040","#404040","#404040","#404040"],"weight":[1,1,1,1],"opacity":[1,1,1,1],"fill":true,"fillColor":["#77AADD","#FF9D9A","#2CA02C","#F1CE63"],"fillOpacity":[0.5,0.5,0.5,0.5],"dashArray":["","","",""],"smoothFactor":1,"noClip":false},["<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>id<\/nobr><\/td><td align=\"right\"><nobr>145<\/nobr><\/td><\/tr><tr><td style=\"color: #888888;\"><nobr>level<\/nobr><\/td><td align=\"right\"><nobr>50-95<\/nobr><\/td><\/tr><tr><td style=\"color: #888888;\"><nobr>group<\/nobr><\/td><td align=\"right\"><nobr>145:50-95<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>id<\/nobr><\/td><td align=\"right\"><nobr>145<\/nobr><\/td><\/tr><tr><td style=\"color: #888888;\"><nobr>level<\/nobr><\/td><td align=\"right\"><nobr>0-50<\/nobr><\/td><\/tr><tr><td style=\"color: #888888;\"><nobr>group<\/nobr><\/td><td align=\"right\"><nobr>145:0-50<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>id<\/nobr><\/td><td align=\"right\"><nobr>168<\/nobr><\/td><\/tr><tr><td style=\"color: #888888;\"><nobr>level<\/nobr><\/td><td align=\"right\"><nobr>50-95<\/nobr><\/td><\/tr><tr><td style=\"color: #888888;\"><nobr>group<\/nobr><\/td><td align=\"right\"><nobr>168:50-95<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>id<\/nobr><\/td><td align=\"right\"><nobr>168<\/nobr><\/td><\/tr><tr><td style=\"color: #888888;\"><nobr>level<\/nobr><\/td><td align=\"right\"><nobr>0-50<\/nobr><\/td><\/tr><tr><td style=\"color: #888888;\"><nobr>group<\/nobr><\/td><td align=\"right\"><nobr>168:0-50<\/nobr><\/td><\/tr><\/table><\/div>"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addControl","args":["<div>\n  <div style=\"font-size: 14px; text-align: left; margin-bottom: 5px; color: #000000;\">group<\/div>\n<\/div>\n<div>\n  <img src=\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20width%3D%2216%22%20height%3D%2216%22%3E%0A%20%20%3Crect%20id%3D%22stadium%22%20x%3D%221%22%20y%3D%221%22%20height%3D%2214%22%20width%3D%2214%22%20rx%3D%2225%25%22%20stroke%3D%22%23404040%22%20fill%3D%22%23FF9D9A%22%20stroke-opacity%3D%221%22%20fill-opacity%3D%220.5%22%20stroke-width%3D%221%22%20stroke-dash%3D%22%22%20baseSize%3D%2220%22%3E%3C%2Frect%3E%0A%3C%2Fsvg%3E\" style=\"vertical-align: middle; margin: 5px; margin-right: 0px; margin-left: 0px\" height=\"16\" width=\"16\"/>\n  <span style=\"font-size: 14px; vertical-align: middle; margin: 0px;\">145:0-50<\/span>\n<\/div>\n<div>\n  <img src=\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20width%3D%2216%22%20height%3D%2216%22%3E%0A%20%20%3Crect%20id%3D%22stadium%22%20x%3D%221%22%20y%3D%221%22%20height%3D%2214%22%20width%3D%2214%22%20rx%3D%2225%25%22%20stroke%3D%22%23404040%22%20fill%3D%22%2377AADD%22%20stroke-opacity%3D%221%22%20fill-opacity%3D%220.5%22%20stroke-width%3D%221%22%20stroke-dash%3D%22%22%20baseSize%3D%2220%22%3E%3C%2Frect%3E%0A%3C%2Fsvg%3E\" style=\"vertical-align: middle; margin: 5px; margin-right: 0px; margin-left: 0px\" height=\"16\" width=\"16\"/>\n  <span style=\"font-size: 14px; vertical-align: middle; margin: 0px;\">145:50-95<\/span>\n<\/div>\n<div>\n  <img src=\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20width%3D%2216%22%20height%3D%2216%22%3E%0A%20%20%3Crect%20id%3D%22stadium%22%20x%3D%221%22%20y%3D%221%22%20height%3D%2214%22%20width%3D%2214%22%20rx%3D%2225%25%22%20stroke%3D%22%23404040%22%20fill%3D%22%23F1CE63%22%20stroke-opacity%3D%221%22%20fill-opacity%3D%220.5%22%20stroke-width%3D%221%22%20stroke-dash%3D%22%22%20baseSize%3D%2220%22%3E%3C%2Frect%3E%0A%3C%2Fsvg%3E\" style=\"vertical-align: middle; margin: 5px; margin-right: 0px; margin-left: 0px\" height=\"16\" width=\"16\"/>\n  <span style=\"font-size: 14px; vertical-align: middle; margin: 0px;\">168:0-50<\/span>\n<\/div>\n<div>\n  <img src=\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20width%3D%2216%22%20height%3D%2216%22%3E%0A%20%20%3Crect%20id%3D%22stadium%22%20x%3D%221%22%20y%3D%221%22%20height%3D%2214%22%20width%3D%2214%22%20rx%3D%2225%25%22%20stroke%3D%22%23404040%22%20fill%3D%22%232CA02C%22%20stroke-opacity%3D%221%22%20fill-opacity%3D%220.5%22%20stroke-width%3D%221%22%20stroke-dash%3D%22%22%20baseSize%3D%2220%22%3E%3C%2Frect%3E%0A%3C%2Fsvg%3E\" style=\"vertical-align: middle; margin: 5px; margin-right: 0px; margin-left: 0px\" height=\"16\" width=\"16\"/>\n  <span style=\"font-size: 14px; vertical-align: middle; margin: 0px;\">168:50-95<\/span>\n<\/div>","bottomright","legend01","info legend Kernellevels leaflegend-group-Kernellevels"]}],"fitBounds":[69.28863904817977,-153.600758517356,76.286725975493,-127.7909673181692,[]],"limits":{"lat":[69.4232176429358,76.15214738073698],"lng":[-153.1044163789101,-128.2873094566151]}},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\nfunction(el, x) {\n  var updateLeafLegend = function() {\n    var controlGroups = document.querySelectorAll(\n      'input.leaflet-control-layers-selector');\n    controlGroups.forEach(g => {\n      var groupName = g.nextSibling.innerText.substr(1);\n      var className = 'leaflegend-group-' +\n        groupName.replace(/[^a-zA-Z0-9]/g, '');\n      var checked = g.checked;\n      document.querySelectorAll('.legend.' + className).forEach(l => {\n        l.hidden = !checked;\n      })\n    })\n  }\n\n  updateLeafLegend();\n  this.on('baselayerchange', el => updateLeafLegend())\n  this.on('overlayadd', el => updateLeafLegend());\n  this.on('overlayremove', el => updateLeafLegend());\n}\n                        ).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>



]
]
---

name: H60b25

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25) <span class="bullet bullet-active">[&#8226;](#H60b25)</span><span class="bullet mslide13m">[&#8226;](#H508a2)</span>.fg[].bg[]
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[



.header.h2.broad[
Валидность
]

.fixprecode[





``` r
sf::st_is_valid(hr2)
```

```
[1]  TRUE FALSE  TRUE FALSE
```

``` r
if (length(ind <- which(!sf::st_is_valid(hr2))))
   hr2[ind,] <- sf::st_make_valid(hr2[ind,])
sf::st_is_valid(hr2)
```

```
[1] TRUE TRUE TRUE TRUE
```

``` r
hr2
```

```
Simple feature collection with 4 features and 3 fields
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -153.1044 ymin: 69.42322 xmax: -128.2873 ymax: 76.15215
Geodetic CRS:  WGS 84
   id level                       geometry     group
1 145 50-95 MULTIPOLYGON (((-153.1044 7... 145:50-95
2 145  0-50 POLYGON ((-138.281 70.63453...  145:0-50
3 168 50-95 POLYGON ((-152.4999 71.1491... 168:50-95
4 168  0-50 POLYGON ((-150.1846 70.6716...  168:0-50
```


]
]
---

name: H508a2

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25) <span class="bullet bullet">[&#8226;](#H60b25)</span><span class="bullet bullet-active">[&#8226;](#H508a2)</span>.fg[].bg[]
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Валидность
]

.fixprecode[



``` r
m1v <- tm_shape(hr2)+tm_polygons("group",fill_alpha=0.5,group="Kernel levels")
```

``` r
m1v
```
<div class="figure">
<div class="framed" style="height:535px; width=100%">
<iframe src="assets/lesson08/widget_wm1v.html" width="100%" height="535" class="ursa-widgetize"></iframe>
</div>
</div>


.indent[
]

]
]
---

name: H8ff48

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48).fg[].bg[]
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Связь "Атрибут-геометрия"
]

.fixprecode[




``` r
sf::st_agr(hr2) <- "constant"
attr(hr2,"agr")
```

```
      id    level    group 
constant constant constant 
Levels: constant aggregate identity
```

``` r
levels(attr(hr2,"agr"))
```

```
[1] "constant"  "aggregate" "identity" 
```

+ `"constant"` - атрибут постоянны по всей геометрии (землепользование)  
+ `"aggregate"` - атрибут агрегированы по геометрии (плотность населения)
+ `"identity"` - однозначное идентифицирование (название города)


]
]



---

name: H7000f

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f).fg[]
### [В полигоны ](#H7000f).fg[].bg[]
### [В мультиполигоны ](#Hfb73c)
### [В линии ](#Heba92)
### [В точки ](#Ha0db6)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h3.broad[
В полигоны .parent[.grand[Преобразование]]
]

.fixprecode[




``` r
(hr_poly <- sf::st_cast(hr,"POLYGON"))
```

```
Simple feature collection with 5 features and 3 fields
Attribute-geometry relationships: constant (3)
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -109626 ymin: -2254479 xmax: 779252.1 ymax: -1438563
Projected CRS: WGS 84 / North Pole LAEA Alaska
     id      area level                       geometry
1   145 200163.21    95 POLYGON ((-108821 -2033301,...
1.1 145 200163.21    95 POLYGON ((543191.4 -1457301...
2   145  35748.68    50 POLYGON ((437079.1 -2107065...
3   168  73098.40    95 POLYGON ((-90920.86 -210402...
4   168  17253.45    50 POLYGON ((-6920.856 -214782...
```

``` r
units::set_units(sum(sf::st_area(hr_poly)),km^2)
```

```
326263.7 [km^2]
```


]
]
---

name: Hfb73c

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f).fg[]
### [В полигоны ](#H7000f)
### [В мультиполигоны ](#Hfb73c).fg[].bg[]
### [В линии ](#Heba92)
### [В точки ](#Ha0db6)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h3.broad[
В мультиполигоны .parent[.grand[Преобразование]]
]

.fixprecode[




``` r
(hr_mpoly <- sf::st_cast(hr,"MULTIPOLYGON"))
```

```
Simple feature collection with 4 features and 3 fields
Attribute-geometry relationships: constant (3)
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -109626 ymin: -2254479 xmax: 779252.1 ymax: -1438563
Projected CRS: WGS 84 / North Pole LAEA Alaska
   id      area level                       geometry
1 145 200163.21    95 MULTIPOLYGON (((-108821 -20...
2 145  35748.68    50 MULTIPOLYGON (((437079.1 -2...
3 168  73098.40    95 MULTIPOLYGON (((-90920.86 -...
4 168  17253.45    50 MULTIPOLYGON (((-6920.856 -...
```

``` r
units::set_units(sum(sf::st_area(hr_mpoly)),km^2)
```

```
326263.7 [km^2]
```

``` r
units::set_units(sum(sf::st_length(hr_mpoly)),km)
```

```
0 [km]
```


]
]
---

name: Heba92

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f).fg[]
### [В полигоны ](#H7000f)
### [В мультиполигоны ](#Hfb73c)
### [В линии ](#Heba92) <span class="bullet bullet-active">[&#8226;](#Heba92)</span><span class="bullet mslide20m">[&#8226;](#He2ae2)</span>.fg[].bg[]
### [В точки ](#Ha0db6)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[



.header.h3.broad[
В линии .parent[.grand[Преобразование]]
]

.fixprecode[




``` r
(hr_mline <- sf::st_cast(hr2,"MULTILINESTRING")) ## sf::st_boundary()
```

```
Simple feature collection with 4 features and 3 fields
Attribute-geometry relationships: constant (3)
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: -153.1044 ymin: 69.42322 xmax: -128.2873 ymax: 76.15215
Geodetic CRS:  WGS 84
   id level     group                       geometry
1 145 50-95 145:50-95 MULTILINESTRING ((-153.1044...
2 145  0-50  145:0-50 MULTILINESTRING ((-138.281 ...
3 168 50-95 168:50-95 MULTILINESTRING ((-152.4999...
4 168  0-50  168:0-50 MULTILINESTRING ((-150.1846...
```

``` r
units::set_units(sum(sf::st_area(hr_mline)),km^2)
```

```
0 [km^2]
```

``` r
units::set_units(sum(sf::st_length(hr_mline)),km)
```

```
6748.012 [km]
```


]
]
---

name: He2ae2

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f).fg[]
### [В полигоны ](#H7000f)
### [В мультиполигоны ](#Hfb73c)
### [В линии ](#Heba92) <span class="bullet bullet">[&#8226;](#Heba92)</span><span class="bullet bullet-active">[&#8226;](#He2ae2)</span>.fg[].bg[]
### [В точки ](#Ha0db6)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h3.broad[
В линии .parent[.grand[Преобразование]]
]

.fixprecode[



``` r
m3 <- tm_shape(hr_mline)+tm_lines("group",col_alpha=1,lwd=3,group="Contour levels")
```

``` r
m3
```
<div class="figure">
<div class="framed" style="height:485px; width=100%">
<iframe src="assets/lesson08/widget_w3.html" width="100%" height="485" class="ursa-widgetize"></iframe>
</div>
</div>


]
]
---

name: Ha0db6

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f).fg[]
### [В полигоны ](#H7000f)
### [В мультиполигоны ](#Hfb73c)
### [В линии ](#Heba92)
### [В точки ](#Ha0db6) <span class="bullet bullet-active">[&#8226;](#Ha0db6)</span><span class="bullet mslide22m">[&#8226;](#H0ca04)</span>.fg[].bg[]
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h3.broad[
В точки .parent[.grand[Преобразование]]
]

.fixprecode[




``` r
(hr_mpoint <- sf::st_cast(hr2,"MULTIPOINT"))
```

```
Simple feature collection with 4 features and 3 fields
Attribute-geometry relationships: constant (3)
Geometry type: MULTIPOINT
Dimension:     XY
Bounding box:  xmin: -153.1044 ymin: 69.42322 xmax: -128.2873 ymax: 76.15215
Geodetic CRS:  WGS 84
   id level     group                       geometry
1 145 50-95 145:50-95 MULTIPOINT ((-153.1044 71.7...
2 145  0-50  145:0-50 MULTIPOINT ((-138.281 70.63...
3 168 50-95 168:50-95 MULTIPOINT ((-152.4999 71.1...
4 168  0-50  168:0-50 MULTIPOINT ((-150.1846 70.6...
```

``` r
tmap_mode("view")
```

```
ℹ tmap mode set to "view".
```

``` r
if (packageVersion("tmap")>'3') {
   sf::st_agr(hr_mpoint) <- "constant"
   hr_mpoint <- sf::st_cast(hr_mpoint,"POINT")
}
```


]
]
---

name: H0ca04

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f).fg[]
### [В полигоны ](#H7000f)
### [В мультиполигоны ](#Hfb73c)
### [В линии ](#Heba92)
### [В точки ](#Ha0db6) <span class="bullet bullet">[&#8226;](#Ha0db6)</span><span class="bullet bullet-active">[&#8226;](#H0ca04)</span>.fg[].bg[]
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h3.broad[
В точки .parent[.grand[Преобразование]]
]

.fixprecode[



``` r
m4 <- tm_shape(hr_mpoint)+tm_dots("group",size=0.4,group="Points")
```

``` r
m4
```

```
Registered S3 method overwritten by 'jsonify':
  method     from    
  print.json jsonlite
```

<div class="figure">
<div class="framed" style="height:485px; width=100%">
<iframe src="assets/lesson08/widget_w4.html" width="100%" height="485" class="ursa-widgetize"></iframe>
</div>
</div>


]
]
---

name: H87d0e

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e).fg[].bg[]
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Объединение
]

.fixprecode[




``` r
union <- sf::st_union(hr)
m2 <- tm_shape(hr2)+tm_polygons("group",fill_alpha=0.5,group="Kernel levels")+
   tm_shape(union)+tm_borders(col="black",lwd=3,lty="dashed",group="Join")
```

``` r
m2
```
<div class="figure">
<div class="framed" style="height:485px; width=100%">
<iframe src="assets/lesson08/widget_w2.html" width="100%" height="485" class="ursa-widgetize"></iframe>
</div>
</div>


]
]
---

name: Hb8e98

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98).fg[].bg[]
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Центроид
]

.fixprecode[




``` r
centroid <- sf::st_centroid(hr2)
m2 <- tm_shape(hr2)+tm_polygons("group",fill_alpha=0.5,group="Kernel levels")+
   tm_shape(centroid)+tm_dots(id="group",group="Centroid")
```

``` r
m2
```
<div class="figure">
<div class="framed" style="height:485px; width=100%">
<iframe src="assets/lesson08/widget_w2c.html" width="100%" height="485" class="ursa-widgetize"></iframe>
</div>
</div>


]
]
---

name: Hae516

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516).fg[].bg[]
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Буфер
]

.fixprecode[




``` r
buffer <- sf::st_buffer(centroid,units::set_units(150,km))
m5 <- tm_shape(hr2)+tm_polygons("group",fill_alpha=0.5,group="Kernel levels")+
   tm_shape(centroid)+tm_dots(id="group",group="Centroid")+
   tm_shape(buffer)+tm_borders(group="Buffer",lty="dashed",lwd=3)
```

``` r
m5
```
<div class="figure">
<div class="framed" style="height:460px; width=100%">
<iframe src="assets/lesson08/widget_w5.html" width="100%" height="460" class="ursa-widgetize"></iframe>
</div>
</div>


]
]



---

name: H7523e

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e).fg[]
### [Бинарное ](#H7523e) <span class="bullet bullet-active">[&#8226;](#H7523e)</span><span class="bullet mslide28m">[&#8226;](#Hec75a)</span><span class="bullet mslide29m">[&#8226;](#H9b729)</span><span class="bullet mslide30m">[&#8226;](#Hfbb51)</span>.fg[].bg[]
### [Унарное ](#Ha5bd4)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h3.broad[
Бинарное .parent[.grand[Пересечение]]
]

.fixprecode[




``` r
intersection <- sf::st_intersection(hr2,buffer)
m6 <- tm_shape(intersection)+tm_polygons("group",fill_alpha=0.5,group="Kernel levels")
```

``` r
m6
```
<div class="figure">
<div class="framed" style="height:460px; width=100%">
<iframe src="assets/lesson08/widget_w6.html" width="100%" height="460" class="ursa-widgetize"></iframe>
</div>
</div>


]
]
---

name: Hec75a

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e).fg[]
### [Бинарное ](#H7523e) <span class="bullet bullet">[&#8226;](#H7523e)</span><span class="bullet bullet-active">[&#8226;](#Hec75a)</span><span class="bullet mslide29m">[&#8226;](#H9b729)</span><span class="bullet mslide30m">[&#8226;](#Hfbb51)</span>.fg[].bg[]
### [Унарное ](#Ha5bd4)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h3.broad[
Бинарное .parent[.grand[Пересечение]]
]

.fixprecode[



``` r
print(intersection)
```

```
Simple feature collection with 11 features and 6 fields
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -151.0912 ymin: 69.42322 xmax: -130.283 ymax: 72.47304
Geodetic CRS:  WGS 84
First 10 features:
     id level     group id.1 level.1   group.1                       geometry
1   145 50-95 145:50-95  145   50-95 145:50-95 POLYGON ((-142.45 70.80287,...
2   145  0-50  145:0-50  145   50-95 145:50-95 POLYGON ((-135.7036 71.0320...
3   168 50-95 168:50-95  145   50-95 145:50-95 MULTIPOLYGON (((-143.4902 7...
1.1 145 50-95 145:50-95  145    0-50  145:0-50 MULTIPOLYGON (((-130.3065 7...
2.1 145  0-50  145:0-50  145    0-50  145:0-50 POLYGON ((-130.6021 71.0781...
1.2 145 50-95 145:50-95  168   50-95 168:50-95 POLYGON ((-149.9768 71.0956...
3.1 168 50-95 168:50-95  168   50-95 168:50-95 POLYGON ((-149.7604 70.0269...
4   168  0-50  168:0-50  168   50-95 168:50-95 POLYGON ((-150.168 70.6638,...
1.3 145 50-95 145:50-95  168    0-50  168:0-50 POLYGON ((-150.6205 71.2267...
3.2 168 50-95 168:50-95  168    0-50  168:0-50 POLYGON ((-150.896 70.27866...
```


]
]
---

name: H9b729

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e).fg[]
### [Бинарное ](#H7523e) <span class="bullet bullet">[&#8226;](#H7523e)</span><span class="bullet bullet">[&#8226;](#Hec75a)</span><span class="bullet bullet-active">[&#8226;](#H9b729)</span><span class="bullet mslide30m">[&#8226;](#Hfbb51)</span>.fg[].bg[]
### [Унарное ](#Ha5bd4)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h3.broad[
Бинарное .parent[.grand[Пересечение]]
]

.fixprecode[



``` r
(intersection <- intersection[intersection$group==intersection$group.1,])
```

```
Simple feature collection with 4 features and 6 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -150.45 ymin: 69.63394 xmax: -130.283 ymax: 72.47304
Geodetic CRS:  WGS 84
     id level     group id.1 level.1   group.1                       geometry
1   145 50-95 145:50-95  145   50-95 145:50-95 POLYGON ((-142.45 70.80287,...
2.1 145  0-50  145:0-50  145    0-50  145:0-50 POLYGON ((-130.6021 71.0781...
3.1 168 50-95 168:50-95  168   50-95 168:50-95 POLYGON ((-149.7604 70.0269...
4.1 168  0-50  168:0-50  168    0-50  168:0-50 POLYGON ((-150.1846 70.6716...
```


]
]
---

name: Hfbb51

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e).fg[]
### [Бинарное ](#H7523e) <span class="bullet bullet">[&#8226;](#H7523e)</span><span class="bullet bullet">[&#8226;](#Hec75a)</span><span class="bullet bullet">[&#8226;](#H9b729)</span><span class="bullet bullet-active">[&#8226;](#Hfbb51)</span>.fg[].bg[]
### [Унарное ](#Ha5bd4)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h3.broad[
Бинарное .parent[.grand[Пересечение]]
]

.fixprecode[



``` r
m7 <- tm_shape(intersection)+tm_polygons("group",fill_alpha=0.5,group="Kernel levels")+
   tm_shape(buffer)+tm_borders(group="Buffer",lty="dashed",lwd=3)
```

``` r
m7
```
<div class="figure">
<div class="framed" style="height:460px; width=100%">
<iframe src="assets/lesson08/widget_w7.html" width="100%" height="460" class="ursa-widgetize"></iframe>
</div>
</div>


]
]
---

name: Ha5bd4

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e).fg[]
### [Бинарное ](#H7523e)
### [Унарное ](#Ha5bd4) <span class="bullet bullet-active">[&#8226;](#Ha5bd4)</span><span class="bullet mslide32m">[&#8226;](#H15bb7)</span>.fg[].bg[]
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h3.broad[
Унарное .parent[.grand[Пересечение]]
]

.fixprecode[




``` r
overlaps <- hr2 |> sf::st_transform(3572) |> sf::st_intersection() |> 
   sf::st_collection_extract() |> sf::st_transform(4326)
if (length(ind <- which(!sf::st_is_valid(overlaps))))
   overlaps[ind,] <- sf::st_make_valid(overlaps[ind,])
overlaps <- overlaps[sf::st_is_valid(overlaps),]
overlaps <- overlaps[sf::st_area(overlaps)>units::set_units(100,m^2),]
overlaps
```

```
Simple feature collection with 11 features and 5 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -153.1044 ymin: 69.42322 xmax: -128.2873 ymax: 76.15215
Geodetic CRS:  WGS 84
First 10 features:
     id level     group n.overlaps origins                       geometry
1   145 50-95 145:50-95          1       1 MULTIPOLYGON (((-152.6013 7...
1.6 145 50-95 145:50-95          1       1 MULTIPOLYGON (((-149.2072 7...
1.7 145 50-95 145:50-95          1       1 MULTIPOLYGON (((-128.4342 7...
1.1 145 50-95 145:50-95          2    1, 2 MULTIPOLYGON (((-138.1358 7...
2   145  0-50  145:0-50          1       2 MULTIPOLYGON (((-138.2509 7...
1.2 145 50-95 145:50-95          2    1, 3 MULTIPOLYGON (((-142.4289 7...
3   168 50-95 168:50-95          1       3 MULTIPOLYGON (((-152.4775 7...
3.2 168 50-95 168:50-95          1       3 MULTIPOLYGON (((-146.6688 7...
3.1 168 50-95 168:50-95          2    3, 4 MULTIPOLYGON (((-149.9249 7...
1.4 145 50-95 145:50-95          2    1, 4 MULTIPOLYGON (((-143.8433 7...
```


]
]
---

name: H15bb7

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e).fg[]
### [Бинарное ](#H7523e)
### [Унарное ](#Ha5bd4) <span class="bullet bullet">[&#8226;](#Ha5bd4)</span><span class="bullet bullet-active">[&#8226;](#H15bb7)</span>.fg[].bg[]
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h3.broad[
Унарное .parent[.grand[Пересечение]]
]

.fixprecode[



``` r
m13 <- tm_shape(overlaps)+tm_polygons("n.overlaps",fill_alpha=0.5,group="Overlaps")
```

``` r
m13
```
<div class="figure">
<div class="framed" style="height:460px; width=100%">
<iframe src="assets/lesson08/widget_w13.html" width="100%" height="460" class="ursa-widgetize"></iframe>
</div>
</div>


]
]
---

name: H641b0

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0) <span class="bullet bullet-active">[&#8226;](#H641b0)</span><span class="bullet mslide34m">[&#8226;](#Hfcd8d)</span><span class="bullet mslide35m">[&#8226;](#H8bdfe)</span>.fg[].bg[]
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Охват
]

.fixprecode[




``` r
extent <- hr2 |> sf::st_bbox(hr2) |> sf::st_as_sfc()
m8 <- tm_shape(hr2)+tm_polygons("group",fill_alpha=0.5,group="Kernel levels")+
   tm_shape(extent)+tm_borders(group="Extent, boudary box",lty="dotted",lwd=2)
```

``` r
m8
```
<div class="figure">
<div class="framed" style="height:485px; width=100%">
<iframe src="assets/lesson08/widget_w8.html" width="100%" height="485" class="ursa-widgetize"></iframe>
</div>
</div>


]
]
---

name: Hfcd8d

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0) <span class="bullet bullet">[&#8226;](#H641b0)</span><span class="bullet bullet-active">[&#8226;](#Hfcd8d)</span><span class="bullet mslide35m">[&#8226;](#H8bdfe)</span>.fg[].bg[]
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Охват
]

.fixprecode[



``` r
inside <- extent |> sf::st_transform(3572) |> sf::st_buffer(-100*1e3)
m9 <- tm_shape(hr2)+tm_polygons("group",fill_alpha=0.5,group="Kernel levels")+
   tm_shape(extent)+tm_borders(group="Extent",lty="dotted",lwd=2)+
   tm_shape(inside)+tm_borders(group="Inside 100km",lty="dashed",lwd=3)
```

``` r
m9
```
<div class="figure">
<div class="framed" style="height:460px; width=100%">
<iframe src="assets/lesson08/widget_w9.html" width="100%" height="460" class="ursa-widgetize"></iframe>
</div>
</div>


]
]
---

name: H8bdfe

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0) <span class="bullet bullet">[&#8226;](#H641b0)</span><span class="bullet bullet">[&#8226;](#Hfcd8d)</span><span class="bullet bullet-active">[&#8226;](#H8bdfe)</span>.fg[].bg[]
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Охват
]

.fixprecode[



``` r
cutted <- sf::st_intersection(hr2,sf::st_transform(inside,sf::st_crs(hr2)))
m14 <- tm_shape(cutted)+tm_polygons("group",fill_alpha=0.5,group="Kernel levels")+
   tm_shape(inside)+tm_borders(group="Inside 100km",lty="dashed",lwd=3)
```

``` r
m14
```
<div class="figure">
<div class="framed" style="height:485px; width=100%">
<iframe src="assets/lesson08/widget_w14.html" width="100%" height="485" class="ursa-widgetize"></iframe>
</div>
</div>


]
]
---

name: H4253e

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e) <span class="bullet bullet-active">[&#8226;](#H4253e)</span><span class="bullet mslide37m">[&#8226;](#H65d18)</span>.fg[].bg[]
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Сегментация
]

.fixprecode[




``` r
bound <- sf::st_segmentize(inside,3000)
m10 <- tm_shape(bound)+tm_borders(col="red",group="Bound (n pts)",lty="dashed",lwd=2)+
   tm_shape(inside)+tm_borders(col="blue",group="Extent (4 pts)",lty="dashed",lwd=2)
```

``` r
m10
```
<div class="figure">
<div class="framed" style="height:485px; width=100%">
<iframe src="assets/lesson08/widget_w10.html" width="100%" height="485" class="ursa-widgetize"></iframe>
</div>
</div>


]
]
---

name: H65d18

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e) <span class="bullet bullet">[&#8226;](#H4253e)</span><span class="bullet bullet-active">[&#8226;](#H65d18)</span>.fg[].bg[]
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Сегментация
]

.fixprecode[



``` r
within <- sf::st_intersection(hr2,sf::st_transform(bound,sf::st_crs(hr2)))
m11 <- tm_shape(within)+tm_polygons("group",fill_alpha=0.5,group="Kernel levels")+
   tm_shape(bound)+tm_borders(group="Within 100km",lty="dashed",lwd=3)
```

``` r
m11
```
<div class="figure">
<div class="framed" style="height:485px; width=100%">
<iframe src="assets/lesson08/widget_w11.html" width="100%" height="485" class="ursa-widgetize"></iframe>
</div>
</div>


]
]
---
class: notable middle


.note[
Пересечение геометрически корректно, но отображение линий между точками по плоскости, а не по поверхности
]
---

name: Hdeb96

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96) <span class="bullet bullet-active">[&#8226;](#Hdeb96)</span><span class="bullet mslide40m">[&#8226;](#Hb4f48)</span>.fg[].bg[]
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Упрощение
]

.fixprecode[


Для ускорения скорости обработки и прорисовки


``` r
s1 <- hr2 |> sf::st_cast("MULTIPOLYGON")
s2 <- sf::st_simplify(hr2,3000,preserveTopology=TRUE) |>
   sf::st_cast("MULTIPOLYGON")
sf::st_agr(s1) <- "constant"
sf::st_agr(s2) <- "constant"
p1 <- sf::st_cast(s1,"POINT")
p2 <- sf::st_cast(s2,"POINT")
m12 <- NULL+
   tm_shape(s1)+tm_borders(group="Original border",col="grey60")+
   tm_shape(s2)+tm_borders(group="Simplified border",col="grey20")+
   tm_shape(p1)+tm_dots(size=0.2,group="Original vertexes",col="grey60")+
   tm_shape(p2)+tm_dots(size=0.4,group="Simplified vertexes",col="grey20")+
   NULL
```


]
]
---

name: Hb4f48

.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96) <span class="bullet bullet">[&#8226;](#Hdeb96)</span><span class="bullet bullet-active">[&#8226;](#Hb4f48)</span>.fg[].bg[]
]
]
.toc.mainbar.right-column.scrollable[


.header.h2.broad[
Упрощение
]

.fixprecode[



``` r
m12
```
<div class="figure">
<div class="framed" style="height:600px; width=100%">
<iframe src="assets/lesson08/widget_w12.html" width="100%" height="600" class="ursa-widgetize"></iframe>
</div>
</div>


<style type="text/css">
:root {--sidebar: 25%; --pointsize: 21.5pt;}
</style>

]
]
---
name: beforefinalizing


.toc.sidebar.left-column[
.outline[
## [Инструменты QGIS ](#difference)
## [Данные и методы ](#H90e56)
## [Валидность ](#H60b25)
## [Связь "Атрибут-геометрия" ](#H8ff48)
## [Преобразование ](#H7000f)
## [Объединение ](#H87d0e)
## [Центроид ](#Hb8e98)
## [Буфер ](#Hae516)
## [Пересечение ](#H7523e)
## [Охват ](#H641b0)
## [Сегментация ](#H4253e)
## [Упрощение ](#Hdeb96)
]
]
.toc.mainbar.right-column.scrollable[




]


---
name: endofslideshow
class: right bottom notable blackout
.endofslideshow[]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://nplatonov.github.io/site_libs/remark.js/remark-latest.min.js"></script>
<script src="https://nplatonov.github.io/site_libs/moon_reader-before.js"></script>
<script>var slideshow = remark.create({
  "countIncrementalSlides": false,
  "slideNumberFormat": "<div class=\"custom-slide-number\" data-total=\"%total%\" data-current=\"%current%\"></div>",
  "ratio": "29:18",
  "navigation": {
    "scroll": true,
    "click": false,
    "touch": true
  },
  "highlightLines": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
<script src="https://nplatonov.github.io/site_libs/moon_reader-after.js"></script>

  </body>
</html>
