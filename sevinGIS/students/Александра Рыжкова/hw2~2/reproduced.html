<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>reproduced.R</title>

<script src="https://nplatonov.github.io/site_libs/header-attrs-2.29/header-attrs.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="https://nplatonov.github.io/site_libs/common.css" type="text/css" />
<link rel="stylesheet" href="https://nplatonov.github.io/site_libs/html_vignette.css" type="text/css" />




</head>

<body>







<p>итог
предоперации</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code></pre></div>
<pre><code>Linking to GEOS 3.13.0, GDAL 3.10.1, PROJ 9.5.1; sf_use_s2() is TRUE</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>
Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>The following objects are masked from &#39;package:stats&#39;:

    filter, lag</code></pre>
<pre><code>The following objects are masked from &#39;package:base&#39;:

    intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="fu">library</span>(extrafont)</span></code></pre></div>
<pre><code>Registering fonts with R</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">library</span>(systemfonts)  <span class="co"># Для проверки шрифтов в системе</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">library</span>(showtext)     <span class="co"># Для загрузки шрифтов в R</span></span></code></pre></div>
<pre><code>Loading required package: sysfonts</code></pre>
<pre><code>Loading required package: showtextdb</code></pre>
<pre><code>
Attaching package: &#39;showtextdb&#39;</code></pre>
<pre><code>The following object is masked from &#39;package:extrafont&#39;:

    font_install</code></pre>
<p>Какие драйверы поддерживаются?</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">st_drivers</span>() <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;ESRI&quot;</span>, name))</span></code></pre></div>
<div class="kable-table">
<table>
<colgroup>
<col width="18%" />
<col width="18%" />
<col width="18%" />
<col width="7%" />
<col width="7%" />
<col width="12%" />
<col width="12%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">name</th>
<th align="left">long_name</th>
<th align="left">write</th>
<th align="left">copy</th>
<th align="left">is_raster</th>
<th align="left">is_vector</th>
<th align="left">vsi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ESRI Shapefile</td>
<td align="left">ESRI Shapefile</td>
<td align="left">ESRI Shapefile</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">ESRIJSON</td>
<td align="left">ESRIJSON</td>
<td align="left">ESRIJSON</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
</div>
<p>Проверка доступных шрифтов</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;Century Gothic&quot;</span> <span class="sc">%in%</span> <span class="fu">fonts</span>()) {</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;Шрифт Century Gothic не найден, попробуем загрузить... Очень нужно!&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>} <span class="cf">else</span> { <span class="fu">message</span>(<span class="st">&quot;Шрифт уже загружен. Наименование - &quot;</span>,</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>                 main_font <span class="ot">&lt;-</span> <span class="st">&quot;Century Gothic&quot;</span>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>Шрифт Century Gothic не найден, попробуем загрузить... Очень нужно!</code></pre>
<p>Функция проверки и загрузки Century Gothic</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>check_and_load_century_gothic <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  font_name <span class="ot">&lt;-</span> <span class="st">&quot;Century Gothic&quot;</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  </span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="co">#1. Проверка наличия в системе</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  <span class="cf">if</span> (font_name <span class="sc">%in%</span> <span class="fu">system_fonts</span>()<span class="sc">$</span>family) {</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;✅ Шрифт &quot;</span>, font_name, <span class="st">&quot;&#39; уже установлен&quot;</span>)</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">TRUE</span>))</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  }</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  </span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>  <span class="co">#2. Если нет - загружаем</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;⚠️ Шрифт &quot;</span>, font_name, <span class="st">&quot;&#39; не найден. Пробуем установить...&quot;</span>)</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>  </span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>  font_path <span class="ot">&lt;-</span> <span class="st">&quot;.CenturyGothic.ttf&quot;</span>  <span class="co"># Укажите правильный путь!</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>  </span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(font_path)) {</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;❌ Файл &quot;</span>, font_path, <span class="st">&quot;&#39; не найден&quot;</span>)</span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">invisible</span>(<span class="cn">FALSE</span>))</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>  }</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>  </span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>  <span class="co">#3. Установка шрифта</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>  <span class="fu">font_add</span>(font_name, font_path)</span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a>  <span class="fu">showtext_auto</span>()</span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a>  </span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a>  <span class="co"># 4. Подтверждение</span></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;✔ Шрифт успешно загружен из: &quot;</span>, <span class="fu">normalizePath</span>(font_path))</span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="cn">TRUE</span>)</span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a>}</span></code></pre></div>
<p>Вызов функции</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">check_and_load_century_gothic</span>()</span></code></pre></div>
<pre><code>✅ Шрифт Century Gothic&#39; уже установлен</code></pre>
<p>Иначе самое принудительное (долгая загрузка, импорт шрифтов)</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;Century Gothic&quot;</span> <span class="sc">%in%</span> <span class="fu">fonts</span>()) {</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>   <span class="do">## font_import(prompt = FALSE)</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>   <span class="do">## loadfonts(device = &quot;win&quot;)</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>NULL</code></pre>
<p>Путь к данным Natural Earth</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># root &lt;- &quot;C:/GIS/2 homework/data&quot;</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>root <span class="ot">&lt;-</span> <span class="st">&quot;D:/users/platt/shapefile/auxiliary/naturalearth/5.1.2&quot;</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="co">#&quot;</span></span></code></pre></div>
<p>Проверка доступных файлов</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>available_shapes <span class="ot">&lt;-</span> <span class="fu">list.files</span>(root, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.shp(</span><span class="sc">\\</span><span class="st">.zip)*$&quot;</span>,<span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">print</span>(available_shapes)</span></code></pre></div>
<pre><code>  [1] &quot;10m_cultural/ne_10m_admin_0_antarctic_claim_limit_lines.shp.zip&quot;              
  [2] &quot;10m_cultural/ne_10m_admin_0_antarctic_claims.shp.zip&quot;                         
  [3] &quot;10m_cultural/ne_10m_admin_0_boundary_lines_disputed_areas.shp.zip&quot;            
  [4] &quot;10m_cultural/ne_10m_admin_0_boundary_lines_land.shp.zip&quot;                      
  [5] &quot;10m_cultural/ne_10m_admin_0_boundary_lines_map_units.shp.zip&quot;                 
  [6] &quot;10m_cultural/ne_10m_admin_0_boundary_lines_maritime_indicator.shp.zip&quot;        
  [7] &quot;10m_cultural/ne_10m_admin_0_boundary_lines_maritime_indicator_chn.shp.zip&quot;    
  [8] &quot;10m_cultural/ne_10m_admin_0_countries.shp.zip&quot;                                
  [9] &quot;10m_cultural/ne_10m_admin_0_countries_arg.shp.zip&quot;                            
 [10] &quot;10m_cultural/ne_10m_admin_0_countries_bdg.shp.zip&quot;                            
 [11] &quot;10m_cultural/ne_10m_admin_0_countries_bra.shp.zip&quot;                            
 [12] &quot;10m_cultural/ne_10m_admin_0_countries_chn.shp.zip&quot;                            
 [13] &quot;10m_cultural/ne_10m_admin_0_countries_deu.shp.zip&quot;                            
 [14] &quot;10m_cultural/ne_10m_admin_0_countries_egy.shp.zip&quot;                            
 [15] &quot;10m_cultural/ne_10m_admin_0_countries_esp.shp.zip&quot;                            
 [16] &quot;10m_cultural/ne_10m_admin_0_countries_fra.shp.zip&quot;                            
 [17] &quot;10m_cultural/ne_10m_admin_0_countries_gbr.shp.zip&quot;                            
 [18] &quot;10m_cultural/ne_10m_admin_0_countries_grc.shp.zip&quot;                            
 [19] &quot;10m_cultural/ne_10m_admin_0_countries_idn.shp.zip&quot;                            
 [20] &quot;10m_cultural/ne_10m_admin_0_countries_ind.shp.zip&quot;                            
 [21] &quot;10m_cultural/ne_10m_admin_0_countries_iso.shp.zip&quot;                            
 [22] &quot;10m_cultural/ne_10m_admin_0_countries_isr.shp.zip&quot;                            
 [23] &quot;10m_cultural/ne_10m_admin_0_countries_ita.shp.zip&quot;                            
 [24] &quot;10m_cultural/ne_10m_admin_0_countries_jpn.shp.zip&quot;                            
 [25] &quot;10m_cultural/ne_10m_admin_0_countries_kor.shp.zip&quot;                            
 [26] &quot;10m_cultural/ne_10m_admin_0_countries_lakes.shp.zip&quot;                          
 [27] &quot;10m_cultural/ne_10m_admin_0_countries_mar.shp.zip&quot;                            
 [28] &quot;10m_cultural/ne_10m_admin_0_countries_nep.shp.zip&quot;                            
 [29] &quot;10m_cultural/ne_10m_admin_0_countries_nld.shp.zip&quot;                            
 [30] &quot;10m_cultural/ne_10m_admin_0_countries_pak.shp.zip&quot;                            
 [31] &quot;10m_cultural/ne_10m_admin_0_countries_pol.shp.zip&quot;                            
 [32] &quot;10m_cultural/ne_10m_admin_0_countries_prt.shp.zip&quot;                            
 [33] &quot;10m_cultural/ne_10m_admin_0_countries_pse.shp.zip&quot;                            
 [34] &quot;10m_cultural/ne_10m_admin_0_countries_rus.shp.zip&quot;                            
 [35] &quot;10m_cultural/ne_10m_admin_0_countries_sau.shp.zip&quot;                            
 [36] &quot;10m_cultural/ne_10m_admin_0_countries_swe.shp.zip&quot;                            
 [37] &quot;10m_cultural/ne_10m_admin_0_countries_tlc.shp.zip&quot;                            
 [38] &quot;10m_cultural/ne_10m_admin_0_countries_tur.shp.zip&quot;                            
 [39] &quot;10m_cultural/ne_10m_admin_0_countries_twn.shp.zip&quot;                            
 [40] &quot;10m_cultural/ne_10m_admin_0_countries_ukr.shp.zip&quot;                            
 [41] &quot;10m_cultural/ne_10m_admin_0_countries_usa.shp.zip&quot;                            
 [42] &quot;10m_cultural/ne_10m_admin_0_countries_vnm.shp.zip&quot;                            
 [43] &quot;10m_cultural/ne_10m_admin_0_disputed_areas.shp.zip&quot;                           
 [44] &quot;10m_cultural/ne_10m_admin_0_disputed_areas_scale_rank_minor_islands.shp.zip&quot;  
 [45] &quot;10m_cultural/ne_10m_admin_0_label_points.shp.zip&quot;                             
 [46] &quot;10m_cultural/ne_10m_admin_0_map_subunits.shp.zip&quot;                             
 [47] &quot;10m_cultural/ne_10m_admin_0_map_units.shp.zip&quot;                                
 [48] &quot;10m_cultural/ne_10m_admin_0_names.shp.zip&quot;                                    
 [49] &quot;10m_cultural/ne_10m_admin_0_pacific_groupings.shp.zip&quot;                        
 [50] &quot;10m_cultural/ne_10m_admin_0_scale_rank.shp.zip&quot;                               
 [51] &quot;10m_cultural/ne_10m_admin_0_scale_rank_minor_islands.shp.zip&quot;                 
 [52] &quot;10m_cultural/ne_10m_admin_0_seams.shp.zip&quot;                                    
 [53] &quot;10m_cultural/ne_10m_admin_0_sovereignty.shp.zip&quot;                              
 [54] &quot;10m_cultural/ne_10m_admin_1_label_points.shp.zip&quot;                             
 [55] &quot;10m_cultural/ne_10m_admin_1_label_points_details.shp.zip&quot;                     
 [56] &quot;10m_cultural/ne_10m_admin_1_seams.shp.zip&quot;                                    
 [57] &quot;10m_cultural/ne_10m_admin_1_states_provinces.shp.zip&quot;                         
 [58] &quot;10m_cultural/ne_10m_admin_1_states_provinces_lakes.shp.zip&quot;                   
 [59] &quot;10m_cultural/ne_10m_admin_1_states_provinces_lines.shp.zip&quot;                   
 [60] &quot;10m_cultural/ne_10m_admin_1_states_provinces_scale_rank.shp.zip&quot;              
 [61] &quot;10m_cultural/ne_10m_admin_1_states_provinces_scale_rank_minor_islands.shp.zip&quot;
 [62] &quot;10m_cultural/ne_10m_admin_2_counties.shp.zip&quot;                                 
 [63] &quot;10m_cultural/ne_10m_admin_2_counties_lakes.shp.zip&quot;                           
 [64] &quot;10m_cultural/ne_10m_admin_2_counties_lines.shp.zip&quot;                           
 [65] &quot;10m_cultural/ne_10m_admin_2_counties_scale_rank.shp.zip&quot;                      
 [66] &quot;10m_cultural/ne_10m_admin_2_counties_scale_rank_minor_islands.shp.zip&quot;        
 [67] &quot;10m_cultural/ne_10m_admin_2_counties_to_match.shp.zip&quot;                        
 [68] &quot;10m_cultural/ne_10m_admin_2_label_points.shp.zip&quot;                             
 [69] &quot;10m_cultural/ne_10m_admin_2_label_points_details.shp.zip&quot;                     
 [70] &quot;10m_cultural/ne_10m_airports.shp.zip&quot;                                         
 [71] &quot;10m_cultural/ne_10m_parks_and_protected_lands_area.shp.zip&quot;                   
 [72] &quot;10m_cultural/ne_10m_parks_and_protected_lands_line.shp.zip&quot;                   
 [73] &quot;10m_cultural/ne_10m_parks_and_protected_lands_point.shp.zip&quot;                  
 [74] &quot;10m_cultural/ne_10m_parks_and_protected_lands_scale_rank.shp.zip&quot;             
 [75] &quot;10m_cultural/ne_10m_populated_places.shp.zip&quot;                                 
 [76] &quot;10m_cultural/ne_10m_populated_places_simple.shp.zip&quot;                          
 [77] &quot;10m_cultural/ne_10m_ports.shp.zip&quot;                                            
 [78] &quot;10m_cultural/ne_10m_railroads.shp.zip&quot;                                        
 [79] &quot;10m_cultural/ne_10m_railroads_north_america.shp.zip&quot;                          
 [80] &quot;10m_cultural/ne_10m_roads.shp.zip&quot;                                            
 [81] &quot;10m_cultural/ne_10m_roads_north_america.shp.zip&quot;                              
 [82] &quot;10m_cultural/ne_10m_time_zones.shp.zip&quot;                                       
 [83] &quot;10m_cultural/ne_10m_urban_areas.shp.zip&quot;                                      
 [84] &quot;10m_cultural/ne_10m_urban_areas_landscan.shp.zip&quot;                             
 [85] &quot;10m_physical/ne_10m_antarctic_ice_shelves_lines.shp.zip&quot;                      
 [86] &quot;10m_physical/ne_10m_antarctic_ice_shelves_polys.shp.zip&quot;                      
 [87] &quot;10m_physical/ne_10m_bathymetry_A_10000.shp.zip&quot;                               
 [88] &quot;10m_physical/ne_10m_bathymetry_B_9000.shp.zip&quot;                                
 [89] &quot;10m_physical/ne_10m_bathymetry_C_8000.shp.zip&quot;                                
 [90] &quot;10m_physical/ne_10m_bathymetry_D_7000.shp.zip&quot;                                
 [91] &quot;10m_physical/ne_10m_bathymetry_E_6000.shp.zip&quot;                                
 [92] &quot;10m_physical/ne_10m_bathymetry_F_5000.shp.zip&quot;                                
 [93] &quot;10m_physical/ne_10m_bathymetry_G_4000.shp.zip&quot;                                
 [94] &quot;10m_physical/ne_10m_bathymetry_H_3000.shp.zip&quot;                                
 [95] &quot;10m_physical/ne_10m_bathymetry_I_2000.shp.zip&quot;                                
 [96] &quot;10m_physical/ne_10m_bathymetry_J_1000.shp.zip&quot;                                
 [97] &quot;10m_physical/ne_10m_bathymetry_K_200.shp.zip&quot;                                 
 [98] &quot;10m_physical/ne_10m_bathymetry_L_0.shp.zip&quot;                                   
 [99] &quot;10m_physical/ne_10m_coastline.shp.zip&quot;                                        
[100] &quot;10m_physical/ne_10m_geographic_lines.shp.zip&quot;                                 
[101] &quot;10m_physical/ne_10m_geography_marine_polys.shp.zip&quot;                           
[102] &quot;10m_physical/ne_10m_geography_regions_elevation_points.shp.zip&quot;               
[103] &quot;10m_physical/ne_10m_geography_regions_points.shp.zip&quot;                         
[104] &quot;10m_physical/ne_10m_geography_regions_polys.shp.zip&quot;                          
[105] &quot;10m_physical/ne_10m_glaciated_areas.shp.zip&quot;                                  
[106] &quot;10m_physical/ne_10m_graticules_1.shp.zip&quot;                                     
[107] &quot;10m_physical/ne_10m_graticules_10.shp.zip&quot;                                    
[108] &quot;10m_physical/ne_10m_graticules_15.shp.zip&quot;                                    
[109] &quot;10m_physical/ne_10m_graticules_20.shp.zip&quot;                                    
[110] &quot;10m_physical/ne_10m_graticules_30.shp.zip&quot;                                    
[111] &quot;10m_physical/ne_10m_graticules_5.shp.zip&quot;                                     
[112] &quot;10m_physical/ne_10m_lakes.shp.zip&quot;                                            
[113] &quot;10m_physical/ne_10m_lakes_australia.shp.zip&quot;                                  
[114] &quot;10m_physical/ne_10m_lakes_europe.shp.zip&quot;                                     
[115] &quot;10m_physical/ne_10m_lakes_historic.shp.zip&quot;                                   
[116] &quot;10m_physical/ne_10m_lakes_north_america.shp.zip&quot;                              
[117] &quot;10m_physical/ne_10m_lakes_pluvial.shp.zip&quot;                                    
[118] &quot;10m_physical/ne_10m_land.shp.zip&quot;                                             
[119] &quot;10m_physical/ne_10m_land_ocean_label_points.shp.zip&quot;                          
[120] &quot;10m_physical/ne_10m_land_ocean_seams.shp.zip&quot;                                 
[121] &quot;10m_physical/ne_10m_land_scale_rank.shp.zip&quot;                                  
[122] &quot;10m_physical/ne_10m_land_scale_rank2.shp.zip&quot;                                 
[123] &quot;10m_physical/ne_10m_minor_islands.shp.zip&quot;                                    
[124] &quot;10m_physical/ne_10m_minor_islands_coastline.shp.zip&quot;                          
[125] &quot;10m_physical/ne_10m_minor_islands_label_points.shp.zip&quot;                       
[126] &quot;10m_physical/ne_10m_minor_islands2.shp.zip&quot;                                   
[127] &quot;10m_physical/ne_10m_ocean.shp.zip&quot;                                            
[128] &quot;10m_physical/ne_10m_ocean_scale_rank.shp.zip&quot;                                 
[129] &quot;10m_physical/ne_10m_playas.shp.zip&quot;                                           
[130] &quot;10m_physical/ne_10m_reefs.shp.zip&quot;                                            
[131] &quot;10m_physical/ne_10m_rivers_australia.shp.zip&quot;                                 
[132] &quot;10m_physical/ne_10m_rivers_europe.shp.zip&quot;                                    
[133] &quot;10m_physical/ne_10m_rivers_lake_centerlines.shp.zip&quot;                          
[134] &quot;10m_physical/ne_10m_rivers_lake_centerlines_scale_rank.shp.zip&quot;               
[135] &quot;10m_physical/ne_10m_rivers_north_america.shp.zip&quot;                             
[136] &quot;10m_physical/ne_10m_wgs84_bounding_box.shp.zip&quot;                               
[137] &quot;110m_cultural/ne_110m_admin_0_boundary_lines_land.shp.zip&quot;                    
[138] &quot;110m_cultural/ne_110m_admin_0_countries.shp.zip&quot;                              
[139] &quot;110m_cultural/ne_110m_admin_0_countries_lakes.shp.zip&quot;                        
[140] &quot;110m_cultural/ne_110m_admin_0_map_units.shp.zip&quot;                              
[141] &quot;110m_cultural/ne_110m_admin_0_pacific_groupings.shp.zip&quot;                      
[142] &quot;110m_cultural/ne_110m_admin_0_scale_rank.shp.zip&quot;                             
[143] &quot;110m_cultural/ne_110m_admin_0_sovereignty.shp.zip&quot;                            
[144] &quot;110m_cultural/ne_110m_admin_0_tiny_countries.shp.zip&quot;                         
[145] &quot;110m_cultural/ne_110m_admin_1_states_provinces.shp.zip&quot;                       
[146] &quot;110m_cultural/ne_110m_admin_1_states_provinces_lakes.shp.zip&quot;                 
[147] &quot;110m_cultural/ne_110m_admin_1_states_provinces_lines.shp.zip&quot;                 
[148] &quot;110m_cultural/ne_110m_admin_1_states_provinces_scale_rank.shp.zip&quot;            
[149] &quot;110m_cultural/ne_110m_populated_places.shp.zip&quot;                               
[150] &quot;110m_cultural/ne_110m_populated_places_simple.shp.zip&quot;                        
[151] &quot;110m_physical/ne_110m_coastline.shp.zip&quot;                                      
[152] &quot;110m_physical/ne_110m_geographic_lines.shp.zip&quot;                               
[153] &quot;110m_physical/ne_110m_geography_marine_polys.shp.zip&quot;                         
[154] &quot;110m_physical/ne_110m_geography_regions_elevation_points.shp.zip&quot;             
[155] &quot;110m_physical/ne_110m_geography_regions_points.shp.zip&quot;                       
[156] &quot;110m_physical/ne_110m_geography_regions_polys.shp.zip&quot;                        
[157] &quot;110m_physical/ne_110m_glaciated_areas.shp.zip&quot;                                
[158] &quot;110m_physical/ne_110m_graticules_1.shp.zip&quot;                                   
[159] &quot;110m_physical/ne_110m_graticules_10.shp.zip&quot;                                  
[160] &quot;110m_physical/ne_110m_graticules_15.shp.zip&quot;                                  
[161] &quot;110m_physical/ne_110m_graticules_20.shp.zip&quot;                                  
[162] &quot;110m_physical/ne_110m_graticules_30.shp.zip&quot;                                  
[163] &quot;110m_physical/ne_110m_graticules_5.shp.zip&quot;                                   
[164] &quot;110m_physical/ne_110m_lakes.shp.zip&quot;                                          
[165] &quot;110m_physical/ne_110m_land.shp.zip&quot;                                           
[166] &quot;110m_physical/ne_110m_ocean.shp.zip&quot;                                          
[167] &quot;110m_physical/ne_110m_rivers_lake_centerlines.shp.zip&quot;                        
[168] &quot;110m_physical/ne_110m_wgs84_bounding_box.shp.zip&quot;                             
[169] &quot;50m_cultural/ne_10m_admin_1_sel.shp.zip&quot;                                      
[170] &quot;50m_cultural/ne_50m_admin_0_boundary_lines_disputed_areas.shp.zip&quot;            
[171] &quot;50m_cultural/ne_50m_admin_0_boundary_lines_land.shp.zip&quot;                      
[172] &quot;50m_cultural/ne_50m_admin_0_boundary_lines_maritime_indicator.shp.zip&quot;        
[173] &quot;50m_cultural/ne_50m_admin_0_boundary_lines_maritime_indicator_chn.shp.zip&quot;    
[174] &quot;50m_cultural/ne_50m_admin_0_boundary_map_units.shp.zip&quot;                       
[175] &quot;50m_cultural/ne_50m_admin_0_breakaway_disputed_areas.shp.zip&quot;                 
[176] &quot;50m_cultural/ne_50m_admin_0_breakaway_disputed_areas_scale_rank.shp.zip&quot;      
[177] &quot;50m_cultural/ne_50m_admin_0_countries.shp.zip&quot;                                
[178] &quot;50m_cultural/ne_50m_admin_0_countries_lakes.shp.zip&quot;                          
[179] &quot;50m_cultural/ne_50m_admin_0_map_subunits.shp.zip&quot;                             
[180] &quot;50m_cultural/ne_50m_admin_0_map_units.shp.zip&quot;                                
[181] &quot;50m_cultural/ne_50m_admin_0_pacific_groupings.shp.zip&quot;                        
[182] &quot;50m_cultural/ne_50m_admin_0_scale_rank.shp.zip&quot;                               
[183] &quot;50m_cultural/ne_50m_admin_0_sovereignty.shp.zip&quot;                              
[184] &quot;50m_cultural/ne_50m_admin_0_tiny_countries.shp.zip&quot;                           
[185] &quot;50m_cultural/ne_50m_admin_0_tiny_countries_scale_rank.shp.zip&quot;                
[186] &quot;50m_cultural/ne_50m_admin_1_seams.shp.zip&quot;                                    
[187] &quot;50m_cultural/ne_50m_admin_1_states_provinces.shp.zip&quot;                         
[188] &quot;50m_cultural/ne_50m_admin_1_states_provinces_lakes.shp.zip&quot;                   
[189] &quot;50m_cultural/ne_50m_admin_1_states_provinces_lines.shp.zip&quot;                   
[190] &quot;50m_cultural/ne_50m_admin_1_states_provinces_scale_rank.shp.zip&quot;              
[191] &quot;50m_cultural/ne_50m_airports.shp.zip&quot;                                         
[192] &quot;50m_cultural/ne_50m_populated_places.shp.zip&quot;                                 
[193] &quot;50m_cultural/ne_50m_populated_places_simple.shp.zip&quot;                          
[194] &quot;50m_cultural/ne_50m_ports.shp.zip&quot;                                            
[195] &quot;50m_cultural/ne_50m_urban_areas.shp.zip&quot;                                      
[196] &quot;50m_physical/ne_50m_antarctic_ice_shelves_lines.shp.zip&quot;                      
[197] &quot;50m_physical/ne_50m_antarctic_ice_shelves_polys.shp.zip&quot;                      
[198] &quot;50m_physical/ne_50m_coastline.shp.zip&quot;                                        
[199] &quot;50m_physical/ne_50m_geographic_lines.shp.zip&quot;                                 
[200] &quot;50m_physical/ne_50m_geography_marine_polys.shp.zip&quot;                           
[201] &quot;50m_physical/ne_50m_geography_regions_elevation_points.shp.zip&quot;               
[202] &quot;50m_physical/ne_50m_geography_regions_points.shp.zip&quot;                         
[203] &quot;50m_physical/ne_50m_geography_regions_polys.shp.zip&quot;                          
[204] &quot;50m_physical/ne_50m_glaciated_areas.shp.zip&quot;                                  
[205] &quot;50m_physical/ne_50m_graticules_1.shp.zip&quot;                                     
[206] &quot;50m_physical/ne_50m_graticules_10.shp.zip&quot;                                    
[207] &quot;50m_physical/ne_50m_graticules_15.shp.zip&quot;                                    
[208] &quot;50m_physical/ne_50m_graticules_20.shp.zip&quot;                                    
[209] &quot;50m_physical/ne_50m_graticules_30.shp.zip&quot;                                    
[210] &quot;50m_physical/ne_50m_graticules_5.shp.zip&quot;                                     
[211] &quot;50m_physical/ne_50m_lakes.shp.zip&quot;                                            
[212] &quot;50m_physical/ne_50m_lakes_historic.shp.zip&quot;                                   
[213] &quot;50m_physical/ne_50m_land.shp.zip&quot;                                             
[214] &quot;50m_physical/ne_50m_ocean.shp.zip&quot;                                            
[215] &quot;50m_physical/ne_50m_playas.shp.zip&quot;                                           
[216] &quot;50m_physical/ne_50m_rivers_lake_centerlines.shp.zip&quot;                          
[217] &quot;50m_physical/ne_50m_rivers_lake_centerlines_scale_rank.shp.zip&quot;               
[218] &quot;50m_physical/ne_50m_wgs84_bounding_box.shp.zip&quot;                               </code></pre>
<p>Береговая линия (для точного вычитания морей)</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>coastline <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">file.path</span>(root, <span class="st">&quot;10m_cultural&quot;</span>, <span class="st">&quot;ne_10m_admin_0_countries.shp.zip&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">==</span> <span class="st">&quot;Australia&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">&quot;POLYGON&quot;</span>)</span></code></pre></div>
<pre><code>Reading layer `ne_10m_admin_0_countries&#39; from data source 
  `C:\Users\platt\shapefile\auxiliary\naturalearth\5.1.2\10m_cultural\ne_10m_admin_0_countries.shp.zip&#39; 
  using driver `ESRI Shapefile&#39;
Simple feature collection with 258 features and 168 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -90 xmax: 180 ymax: 83.6341
Geodetic CRS:  WGS 84</code></pre>
<p>Загрузка данных административных границ (штаты)</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>aus_states <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">file.path</span>(root, <span class="st">&quot;10m_cultural&quot;</span>, <span class="st">&quot;ne_10m_admin_1_states_provinces.shp.zip&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>  <span class="fu">filter</span>(admin <span class="sc">==</span> <span class="st">&quot;Australia&quot;</span>)</span></code></pre></div>
<pre><code>Reading layer `ne_10m_admin_1_states_provinces&#39; from data source 
  `C:\Users\platt\shapefile\auxiliary\naturalearth\5.1.2\10m_cultural\ne_10m_admin_1_states_provinces.shp.zip&#39; 
  using driver `ESRI Shapefile&#39;
Simple feature collection with 4596 features and 121 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -90 xmax: 180 ymax: 83.6341
Geodetic CRS:  WGS 84</code></pre>
<p>Загрузка данных морей (обрезка по береговой линии)</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>marine_areas <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">file.path</span>(root, <span class="st">&quot;10m_physical&quot;</span>, <span class="st">&quot;ne_10m_geography_marine_polys.shp.zip&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Timor Sea&quot;</span>, <span class="st">&quot;Tasman Sea&quot;</span>, <span class="st">&quot;Coral Sea&quot;</span>, <span class="st">&quot;Arafura Sea&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>  <span class="fu">st_difference</span>(coastline) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>()</span></code></pre></div>
<pre><code>Reading layer `ne_10m_geography_marine_polys&#39; from data source 
  `C:\Users\platt\shapefile\auxiliary\naturalearth\5.1.2\10m_physical\ne_10m_geography_marine_polys.shp.zip&#39; 
  using driver `ESRI Shapefile&#39;
Simple feature collection with 306 features and 37 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -85.19206 xmax: 179.9999 ymax: 90
Geodetic CRS:  WGS 84</code></pre>
<p>Города</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>  cities <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">file.path</span>(root, <span class="st">&quot;10m_cultural&quot;</span>, <span class="st">&quot;ne_10m_populated_places.shp.zip&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>    <span class="fu">filter</span>(ADM0NAME <span class="sc">==</span> <span class="st">&quot;Australia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>      <span class="at">NAME_RU =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>        NAME <span class="sc">==</span> <span class="st">&quot;Sydney&quot;</span> <span class="sc">~</span> <span class="st">&quot;Сидней&quot;</span>,</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>        NAME <span class="sc">==</span> <span class="st">&quot;Melbourne&quot;</span> <span class="sc">~</span> <span class="st">&quot;Мельбурн&quot;</span>,</span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>        NAME <span class="sc">==</span> <span class="st">&quot;Brisbane&quot;</span> <span class="sc">~</span> <span class="st">&quot;Брисбен&quot;</span>,</span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>        NAME <span class="sc">==</span> <span class="st">&quot;Perth&quot;</span> <span class="sc">~</span> <span class="st">&quot;Перт&quot;</span>,</span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>        NAME <span class="sc">==</span> <span class="st">&quot;Adelaide&quot;</span> <span class="sc">~</span> <span class="st">&quot;Аделаида&quot;</span>,</span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>        NAME <span class="sc">==</span> <span class="st">&quot;Canberra&quot;</span> <span class="sc">~</span> <span class="st">&quot;Канберра&quot;</span>,</span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>        NAME <span class="sc">==</span> <span class="st">&quot;Hobart&quot;</span> <span class="sc">~</span> <span class="st">&quot;Хобарт&quot;</span>,</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a>        NAME <span class="sc">==</span> <span class="st">&quot;Darwin&quot;</span> <span class="sc">~</span> <span class="st">&quot;Дарвин&quot;</span>,</span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> NAME</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>      )</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>    <span class="fu">filter</span>(NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Sydney&quot;</span>, <span class="st">&quot;Melbourne&quot;</span>, <span class="st">&quot;Brisbane&quot;</span>, <span class="st">&quot;Perth&quot;</span>,</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>                       <span class="st">&quot;Adelaide&quot;</span>, <span class="st">&quot;Canberra&quot;</span>, <span class="st">&quot;Hobart&quot;</span>, <span class="st">&quot;Darwin&quot;</span>))</span></code></pre></div>
<pre><code>Reading layer `ne_10m_populated_places&#39; from data source 
  `C:\Users\platt\shapefile\auxiliary\naturalearth\5.1.2\10m_cultural\ne_10m_populated_places.shp.zip&#39; 
  using driver `ESRI Shapefile&#39;
Simple feature collection with 7342 features and 137 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -179.59 ymin: -90 xmax: 179.3833 ymax: 82.48332
Geodetic CRS:  WGS 84</code></pre>
<p>Определение оптимальной проекции Альберса для Австралии</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>albers_proj <span class="ot">&lt;-</span> <span class="st">&quot;+proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs&quot;</span></span></code></pre></div>
<p>Преобразование координат ————————————————-</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>aus_states_albers <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(aus_states, albers_proj)</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>marine_areas_albers <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(marine_areas, albers_proj)</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>cities_albers <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(cities, albers_proj)</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>coastline_albers <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(coastline, albers_proj)</span></code></pre></div>
<p>Подписи морей</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>marine_labels <span class="ot">&lt;-</span> marine_areas_albers <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>  <span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>    <span class="at">name_ru =</span> <span class="fu">case_when</span>(</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;Timor Sea&quot;</span> <span class="sc">~</span> <span class="st">&quot;Тиморское</span><span class="sc">\n</span><span class="st">море&quot;</span>,</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;Tasman Sea&quot;</span> <span class="sc">~</span> <span class="st">&quot;Тасманово</span><span class="sc">\n</span><span class="st">море&quot;</span>,</span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;Coral Sea&quot;</span> <span class="sc">~</span> <span class="st">&quot;Коралловое</span><span class="sc">\n</span><span class="st">море&quot;</span>,</span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;Arafura Sea&quot;</span> <span class="sc">~</span> <span class="st">&quot;Арафурское</span><span class="sc">\n</span><span class="st">море&quot;</span>,</span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> name</span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>    )</span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>  )</span></code></pre></div>
<p>Создаем искусственный bounding box для всей карты</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>expanded_bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>  <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">3e6</span>,  <span class="co"># Расширяем на 30% за пределы карты</span></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>  <span class="at">xmax =</span> <span class="fl">4e6</span>,</span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>  <span class="at">ymin =</span> <span class="sc">-</span><span class="fl">10e6</span>,</span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>  <span class="at">ymax =</span> <span class="fl">0.5</span></span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a>), <span class="at">crs =</span> albers_proj) <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>  <span class="fu">st_as_sfc</span>()</span></code></pre></div>
<p>Создаем координатную сетку НА ОСНОВЕ ГРАНИЦ КАРТЫ (не Австралии)</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>graticule <span class="ot">&lt;-</span> <span class="fu">st_graticule</span>(</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>  <span class="co"># Создаем координатную сетку с шагом 10° по широте</span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>  graticule <span class="ot">&lt;-</span> <span class="fu">st_graticule</span>(expanded_bbox,</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>                            <span class="at">ndiscr =</span> <span class="dv">100</span>,  <span class="co"># Количество точек для smooth-линий</span></span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>                            <span class="at">lon =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">180</span>, <span class="at">by =</span> <span class="dv">10</span>),  <span class="co"># Шаг 10° по долготе</span></span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>                            <span class="at">lat =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">10</span>)      <span class="co"># Фиксированный шаг 10° по широте</span></span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>    <span class="fu">st_transform</span>(albers_proj) <span class="sc">%&gt;%</span> </span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>    <span class="fu">suppressWarnings</span>({  <span class="co"># Подавляем предупреждение для st_intersection</span></span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>      <span class="fu">st_intersection</span>(<span class="fu">st_as_sfc</span>(<span class="fu">st_bbox</span>(<span class="fu">c</span>(</span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a>        <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">3e6</span>, <span class="at">xmax =</span> <span class="fl">3.5e6</span>, </span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a>        <span class="at">ymin =</span> <span class="sc">-</span><span class="fl">5e6</span>, <span class="at">ymax =</span> <span class="fl">0.5e6</span></span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a>      ), <span class="at">crs =</span> albers_proj)))</span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a>    })</span></code></pre></div>
<p>Создаем полигон суши для исключения подписей морей</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>land_polygon <span class="ot">&lt;-</span> coastline_albers</span></code></pre></div>
<p>Фильтруем подписи морей, чтобы они не попадали на сушу</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>marine_labels_filtered <span class="ot">&lt;-</span> marine_labels <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>  <span class="co"># Сохраняем атрибуты перед операцией st_difference</span></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a>    <span class="at">original_name =</span> name,</span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a>    <span class="at">original_name_ru =</span> name_ru</span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a>  <span class="co"># Выполняем разность с полигоном суши</span></span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a>  <span class="fu">st_difference</span>(land_polygon) <span class="sc">%&gt;%</span> </span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a>  <span class="co"># Восстанавливаем атрибуты после операции</span></span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a>    <span class="at">name =</span> original_name,</span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a>    <span class="at">name_ru =</span> original_name_ru</span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">st_is_empty</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a>  </span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a>  <span class="co"># Ручная корректировка позиций для морей</span></span>
<span id="cb39-17"><a href="#cb39-17" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-18"><a href="#cb39-18" tabindex="-1"></a>    <span class="at">nudge_y =</span> <span class="fu">case_when</span>(</span>
<span id="cb39-19"><a href="#cb39-19" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;Timor Sea&quot;</span> <span class="sc">~</span> <span class="fl">1e5</span>,</span>
<span id="cb39-20"><a href="#cb39-20" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;Tasman Sea&quot;</span> <span class="sc">~</span> <span class="fl">3e5</span>,</span>
<span id="cb39-21"><a href="#cb39-21" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;Coral Sea&quot;</span> <span class="sc">~</span> <span class="fl">0.5e5</span>,</span>
<span id="cb39-22"><a href="#cb39-22" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;Arafura Sea&quot;</span> <span class="sc">~</span> <span class="sc">-</span><span class="fl">1e5</span>,</span>
<span id="cb39-23"><a href="#cb39-23" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb39-24"><a href="#cb39-24" tabindex="-1"></a>    ),</span>
<span id="cb39-25"><a href="#cb39-25" tabindex="-1"></a>    <span class="at">nudge_x =</span> <span class="fu">case_when</span>(</span>
<span id="cb39-26"><a href="#cb39-26" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;Timor Sea&quot;</span> <span class="sc">~</span> <span class="sc">-</span><span class="fl">2e5</span>,</span>
<span id="cb39-27"><a href="#cb39-27" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;Coral Sea&quot;</span> <span class="sc">~</span> <span class="sc">-</span><span class="fl">2e5</span>,</span>
<span id="cb39-28"><a href="#cb39-28" tabindex="-1"></a>      name <span class="sc">==</span> <span class="st">&quot;Arafura Sea&quot;</span> <span class="sc">~</span> <span class="fl">3.5e5</span>,</span>
<span id="cb39-29"><a href="#cb39-29" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb39-30"><a href="#cb39-30" tabindex="-1"></a>    )</span>
<span id="cb39-31"><a href="#cb39-31" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb39-32"><a href="#cb39-32" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>()</span>
<span id="cb39-33"><a href="#cb39-33" tabindex="-1"></a></span>
<span id="cb39-34"><a href="#cb39-34" tabindex="-1"></a>a <span class="ot">&lt;-</span></span>
<span id="cb39-35"><a href="#cb39-35" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-36"><a href="#cb39-36" tabindex="-1"></a>  <span class="co"># 1. Фон (подложка)</span></span>
<span id="cb39-37"><a href="#cb39-37" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> aus_states_albers, <span class="at">fill =</span> <span class="st">&quot;#E6F2FF&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb39-38"><a href="#cb39-38" tabindex="-1"></a>  <span class="co"># 2. Добавление морей (прозрачными)</span></span>
<span id="cb39-39"><a href="#cb39-39" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> marine_areas_albers, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb39-40"><a href="#cb39-40" tabindex="-1"></a>  <span class="co"># 3. Добавление штатов с ручной раскраской</span></span>
<span id="cb39-41"><a href="#cb39-41" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> aus_states_albers, <span class="fu">aes</span>(<span class="at">fill =</span> name), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb39-42"><a href="#cb39-42" tabindex="-1"></a>  <span class="co"># 4. Береговая линия (контур)</span></span>
<span id="cb39-43"><a href="#cb39-43" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> coastline_albers, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb39-44"><a href="#cb39-44" tabindex="-1"></a>  <span class="co"># 5. Города (точки с белой обводкой)</span></span>
<span id="cb39-45"><a href="#cb39-45" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb39-46"><a href="#cb39-46" tabindex="-1"></a>    <span class="at">data =</span> cities, </span>
<span id="cb39-47"><a href="#cb39-47" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;white&quot;</span>,       </span>
<span id="cb39-48"><a href="#cb39-48" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.5</span>,           </span>
<span id="cb39-49"><a href="#cb39-49" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>,           </span>
<span id="cb39-50"><a href="#cb39-50" tabindex="-1"></a>    <span class="at">stroke =</span> <span class="fl">1.2</span>          </span>
<span id="cb39-51"><a href="#cb39-51" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-52"><a href="#cb39-52" tabindex="-1"></a>  <span class="co"># 6. Основные точки городов (красные)</span></span>
<span id="cb39-53"><a href="#cb39-53" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb39-54"><a href="#cb39-54" tabindex="-1"></a>    <span class="at">data =</span> cities, </span>
<span id="cb39-55"><a href="#cb39-55" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;red3&quot;</span>,     </span>
<span id="cb39-56"><a href="#cb39-56" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,            </span>
<span id="cb39-57"><a href="#cb39-57" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">16</span>           </span>
<span id="cb39-58"><a href="#cb39-58" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-59"><a href="#cb39-59" tabindex="-1"></a>  <span class="co"># 7. Подписи городов с белой обводкой</span></span>
<span id="cb39-60"><a href="#cb39-60" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(</span>
<span id="cb39-61"><a href="#cb39-61" tabindex="-1"></a>    <span class="at">data =</span> cities_albers,</span>
<span id="cb39-62"><a href="#cb39-62" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> NAME_RU, <span class="at">geometry =</span> geometry),</span>
<span id="cb39-63"><a href="#cb39-63" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;Century Gothic&quot;</span>,</span>
<span id="cb39-64"><a href="#cb39-64" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">3.5</span>,</span>
<span id="cb39-65"><a href="#cb39-65" tabindex="-1"></a>    <span class="at">point.padding =</span> <span class="fl">0.3</span>,</span>
<span id="cb39-66"><a href="#cb39-66" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb39-67"><a href="#cb39-67" tabindex="-1"></a>    <span class="at">min.segment.length =</span> <span class="dv">0</span>,</span>
<span id="cb39-68"><a href="#cb39-68" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="cn">Inf</span>,</span>
<span id="cb39-69"><a href="#cb39-69" tabindex="-1"></a>    <span class="at">label.padding =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb39-70"><a href="#cb39-70" tabindex="-1"></a>    <span class="at">label.size =</span> <span class="dv">0</span>,</span>
<span id="cb39-71"><a href="#cb39-71" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">&quot;white&quot;</span>, <span class="fl">0.7</span>),</span>
<span id="cb39-72"><a href="#cb39-72" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb39-73"><a href="#cb39-73" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;sf_coordinates&quot;</span></span>
<span id="cb39-74"><a href="#cb39-74" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-75"><a href="#cb39-75" tabindex="-1"></a>  <span class="co"># 8. Подписи морей</span></span>
<span id="cb39-76"><a href="#cb39-76" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>(</span>
<span id="cb39-77"><a href="#cb39-77" tabindex="-1"></a>    <span class="at">data =</span> marine_labels_filtered, </span>
<span id="cb39-78"><a href="#cb39-78" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> name_ru), </span>
<span id="cb39-79"><a href="#cb39-79" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">&quot;Century Gothic&quot;</span>, </span>
<span id="cb39-80"><a href="#cb39-80" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">3.5</span>, </span>
<span id="cb39-81"><a href="#cb39-81" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb39-82"><a href="#cb39-82" tabindex="-1"></a>    <span class="at">nudge_y =</span> marine_labels_filtered<span class="sc">$</span>nudge_y,</span>
<span id="cb39-83"><a href="#cb39-83" tabindex="-1"></a>    <span class="at">nudge_x =</span> marine_labels_filtered<span class="sc">$</span>nudge_x</span>
<span id="cb39-84"><a href="#cb39-84" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-85"><a href="#cb39-85" tabindex="-1"></a>  <span class="co"># 9. Координатная сетка</span></span>
<span id="cb39-86"><a href="#cb39-86" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb39-87"><a href="#cb39-87" tabindex="-1"></a>    <span class="at">data =</span> graticule,</span>
<span id="cb39-88"><a href="#cb39-88" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>,</span>
<span id="cb39-89"><a href="#cb39-89" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb39-90"><a href="#cb39-90" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.2</span>,</span>
<span id="cb39-91"><a href="#cb39-91" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb39-92"><a href="#cb39-92" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-93"><a href="#cb39-93" tabindex="-1"></a>  <span class="co"># 10. Настройка внешнего вида</span></span>
<span id="cb39-94"><a href="#cb39-94" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb39-95"><a href="#cb39-95" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb39-96"><a href="#cb39-96" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Century Gothic&quot;</span>),</span>
<span id="cb39-97"><a href="#cb39-97" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),  <span class="co"># Убираем технические x и y</span></span>
<span id="cb39-98"><a href="#cb39-98" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),  <span class="co"># Добавляем оси</span></span>
<span id="cb39-99"><a href="#cb39-99" tabindex="-1"></a>    <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;cm&quot;</span>),  <span class="co"># Длина засечек</span></span>
<span id="cb39-100"><a href="#cb39-100" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#E6F2FF&quot;</span>, <span class="at">color =</span> <span class="cn">NA</span>),  <span class="co"># Фон карты</span></span>
<span id="cb39-101"><a href="#cb39-101" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),  <span class="co"># Отключаем стандартную сетку ggplot</span></span>
<span id="cb39-102"><a href="#cb39-102" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>),</span>
<span id="cb39-103"><a href="#cb39-103" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb39-104"><a href="#cb39-104" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb39-105"><a href="#cb39-105" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb39-106"><a href="#cb39-106" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-107"><a href="#cb39-107" tabindex="-1"></a>  <span class="co"># 11. Цвета для штатов</span></span>
<span id="cb39-108"><a href="#cb39-108" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb39-109"><a href="#cb39-109" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Штаты Австралии&quot;</span>,</span>
<span id="cb39-110"><a href="#cb39-110" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb39-111"><a href="#cb39-111" tabindex="-1"></a>      <span class="st">&quot;New South Wales&quot;</span> <span class="ot">=</span> <span class="st">&quot;#FFD700&quot;</span>,       <span class="co"># Новый Южный Уэльс</span></span>
<span id="cb39-112"><a href="#cb39-112" tabindex="-1"></a>      <span class="st">&quot;Western Australia&quot;</span> <span class="ot">=</span> <span class="st">&quot;#F4A460&quot;</span>,     <span class="co"># Западная Австралия</span></span>
<span id="cb39-113"><a href="#cb39-113" tabindex="-1"></a>      <span class="st">&quot;South Australia&quot;</span> <span class="ot">=</span> <span class="st">&quot;#DAA520&quot;</span>,       <span class="co"># Южная Австралия</span></span>
<span id="cb39-114"><a href="#cb39-114" tabindex="-1"></a>      <span class="st">&quot;Queensland&quot;</span> <span class="ot">=</span> <span class="st">&quot;#CD853F&quot;</span>,            <span class="co"># Квинсленд</span></span>
<span id="cb39-115"><a href="#cb39-115" tabindex="-1"></a>      <span class="st">&quot;Victoria&quot;</span> <span class="ot">=</span> <span class="st">&quot;#B8860B&quot;</span>,              <span class="co"># Виктория</span></span>
<span id="cb39-116"><a href="#cb39-116" tabindex="-1"></a>      <span class="st">&quot;Tasmania&quot;</span> <span class="ot">=</span> <span class="st">&quot;#A0522D&quot;</span>,              <span class="co"># Тасмания</span></span>
<span id="cb39-117"><a href="#cb39-117" tabindex="-1"></a>      <span class="st">&quot;Northern Territory&quot;</span> <span class="ot">=</span> <span class="st">&quot;#8B4513&quot;</span>     <span class="co"># Северная Территория</span></span>
<span id="cb39-118"><a href="#cb39-118" tabindex="-1"></a>    ),</span>
<span id="cb39-119"><a href="#cb39-119" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb39-120"><a href="#cb39-120" tabindex="-1"></a>      <span class="st">&quot;New South Wales&quot;</span> <span class="ot">=</span> <span class="st">&quot; </span><span class="sc">\n</span><span class="st">Новый Южный</span><span class="sc">\n</span><span class="st">Уэльс</span><span class="sc">\n</span><span class="st"> &quot;</span>,</span>
<span id="cb39-121"><a href="#cb39-121" tabindex="-1"></a>      <span class="st">&quot;Western Australia&quot;</span> <span class="ot">=</span> <span class="st">&quot; </span><span class="sc">\n</span><span class="st">Западная</span><span class="sc">\n</span><span class="st">Австралия</span><span class="sc">\n</span><span class="st"> &quot;</span>,</span>
<span id="cb39-122"><a href="#cb39-122" tabindex="-1"></a>      <span class="st">&quot;South Australia&quot;</span> <span class="ot">=</span> <span class="st">&quot; </span><span class="sc">\n</span><span class="st">Южная</span><span class="sc">\n</span><span class="st">Австралия</span><span class="sc">\n</span><span class="st"> &quot;</span>,</span>
<span id="cb39-123"><a href="#cb39-123" tabindex="-1"></a>      <span class="st">&quot;Queensland&quot;</span> <span class="ot">=</span> <span class="st">&quot; </span><span class="sc">\n</span><span class="st">Квинсленд</span><span class="sc">\n</span><span class="st"> &quot;</span>,</span>
<span id="cb39-124"><a href="#cb39-124" tabindex="-1"></a>      <span class="st">&quot;Victoria&quot;</span> <span class="ot">=</span> <span class="st">&quot; </span><span class="sc">\n</span><span class="st">Виктория</span><span class="sc">\n</span><span class="st"> &quot;</span>,</span>
<span id="cb39-125"><a href="#cb39-125" tabindex="-1"></a>      <span class="st">&quot;Tasmania&quot;</span> <span class="ot">=</span> <span class="st">&quot; </span><span class="sc">\n</span><span class="st">Тасмания</span><span class="sc">\n</span><span class="st"> &quot;</span>,</span>
<span id="cb39-126"><a href="#cb39-126" tabindex="-1"></a>      <span class="st">&quot;Northern Territory&quot;</span> <span class="ot">=</span> <span class="st">&quot; </span><span class="sc">\n</span><span class="st">Северная</span><span class="sc">\n</span><span class="st">Территория</span><span class="sc">\n</span><span class="st"> &quot;</span></span>
<span id="cb39-127"><a href="#cb39-127" tabindex="-1"></a>    ),</span>
<span id="cb39-128"><a href="#cb39-128" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb39-129"><a href="#cb39-129" tabindex="-1"></a>      <span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="fl">1.2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb39-130"><a href="#cb39-130" tabindex="-1"></a>      <span class="at">keywidth =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">&quot;lines&quot;</span>)</span>
<span id="cb39-131"><a href="#cb39-131" tabindex="-1"></a>    )</span>
<span id="cb39-132"><a href="#cb39-132" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-133"><a href="#cb39-133" tabindex="-1"></a>  <span class="co"># 12. Настройка подписей координат</span></span>
<span id="cb39-134"><a href="#cb39-134" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="fu">abs</span>(x)), <span class="st">&quot;° в.д.&quot;</span>)) <span class="sc">+</span></span>
<span id="cb39-135"><a href="#cb39-135" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(y) <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="fu">abs</span>(y)), <span class="st">&quot;° ю.ш.&quot;</span>)) <span class="sc">+</span></span>
<span id="cb39-136"><a href="#cb39-136" tabindex="-1"></a>  </span>
<span id="cb39-137"><a href="#cb39-137" tabindex="-1"></a>  <span class="co"># 13. Обрезка карты</span></span>
<span id="cb39-138"><a href="#cb39-138" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb39-139"><a href="#cb39-139" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.3e6</span>, <span class="fl">3e6</span>),</span>
<span id="cb39-140"><a href="#cb39-140" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">4.9e6</span>, <span class="sc">-</span><span class="fl">0.5e6</span>),</span>
<span id="cb39-141"><a href="#cb39-141" tabindex="-1"></a>    <span class="at">expand =</span> <span class="cn">FALSE</span>,</span>
<span id="cb39-142"><a href="#cb39-142" tabindex="-1"></a>    <span class="at">clip =</span> <span class="st">&quot;on&quot;</span></span>
<span id="cb39-143"><a href="#cb39-143" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-144"><a href="#cb39-144" tabindex="-1"></a>  <span class="co"># 14. Добавление подписи океана</span></span>
<span id="cb39-145"><a href="#cb39-145" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="sc">-</span><span class="fl">1.3e6</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">4.5e6</span>, <span class="at">label =</span> <span class="st">&quot;Индийский океан&quot;</span>, </span>
<span id="cb39-146"><a href="#cb39-146" tabindex="-1"></a>           <span class="at">family =</span> <span class="st">&quot;Century Gothic&quot;</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-147"><a href="#cb39-147" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Административное деление</span><span class="sc">\n</span><span class="st">Австралии&quot;</span>)</span>
<span id="cb39-148"><a href="#cb39-148" tabindex="-1"></a></span>
<span id="cb39-149"><a href="#cb39-149" tabindex="-1"></a>fileout <span class="ot">&lt;-</span> <span class="st">&quot;./Australia.png&quot;</span></span>
<span id="cb39-150"><a href="#cb39-150" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">dirname</span>(fileout)))</span>
<span id="cb39-151"><a href="#cb39-151" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">dirname</span>(fileout),<span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-152"><a href="#cb39-152" tabindex="-1"></a><span class="fu">png</span>(fileout, <span class="at">res=</span><span class="dv">300</span>, <span class="at">width=</span><span class="dv">3000</span>, <span class="at">height=</span><span class="dv">1500</span>,</span>
<span id="cb39-153"><a href="#cb39-153" tabindex="-1"></a>    <span class="at">type=</span><span class="st">&quot;cairo&quot;</span>, <span class="at">pointsize=</span><span class="dv">12</span>, <span class="at">family=</span><span class="st">&quot;Century Gothic&quot;</span>)</span>
<span id="cb39-154"><a href="#cb39-154" tabindex="-1"></a><span class="fu">print</span>(a)</span>
<span id="cb39-155"><a href="#cb39-155" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>devSVG 
     2 </code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="co"># browseURL(fileout)</span></span></code></pre></div>
<p>опционально</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;Australia_ggsaved.png&quot;</span>, a, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;Australia_ggsaved.png&quot;</span>)</span></code></pre></div>
<p class="centered-image"><img src="Australia_ggsaved.png" width="1500" /></p>



<!-- code folding -->



</body>
</html>
