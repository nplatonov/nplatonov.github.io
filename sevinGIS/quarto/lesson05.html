<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.514">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Никита Платонов">

<title>ГИС 05</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://nplatonov.github.io/quarto_libs/clipboard/clipboard.min.js"></script>
<script src="https://nplatonov.github.io/quarto_libs/quarto-html/quarto.js"></script>
<script src="https://nplatonov.github.io/quarto_libs/quarto-html/popper.min.js"></script>
<script src="https://nplatonov.github.io/quarto_libs/quarto-html/tippy.umd.min.js"></script>
<script src="https://nplatonov.github.io/quarto_libs/quarto-html/anchor.min.js"></script>
<link href="https://nplatonov.github.io/quarto_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="https://nplatonov.github.io/quarto_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="https://nplatonov.github.io/quarto_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="https://nplatonov.github.io/quarto_libs/bootstrap/bootstrap.min.js"></script>
<link href="https://nplatonov.github.io/quarto_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="https://nplatonov.github.io/quarto_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="https://nplatonov.github.io/quarto_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="https://nplatonov.github.io/quarto_libs/common.css">
<link rel="stylesheet" href="https://nplatonov.github.io/quarto_libs/html.css">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Возможности R для работы с пространственными данными</h1>
            <p class="subtitle lead">ГИС технологии в биологических исследованиях</p>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Автор</div>
    <div class="quarto-title-meta-heading">Организация</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Никита Платонов </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              с.н.с. ИПЭЭ РАН
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
    
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      Демонстрация основ работы с интерфейсом командной строки в R, позволяющей создавать скрипты и получать воспроизводимые результаты. Показано, как пространственные векторные и растровые данные могут попасть в R и как они выглядят в R. С возможностью сделать обработку, анализ и визуализацию пространственных данных.
    </div>
  </div>
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Содержание</h2>
   
  <ul>
  <li><a href="#основы-r" id="toc-основы-r" class="nav-link active" data-scroll-target="#основы-r">Основы R</a>
  <ul>
  <li><a href="#установка-r" id="toc-установка-r" class="nav-link" data-scroll-target="#установка-r">Установка R</a>
  <ul>
  <li><a href="#oперационные-системы" id="toc-oперационные-системы" class="nav-link" data-scroll-target="#oперационные-системы">Oперационные системы</a></li>
  <li><a href="#базовый-r" id="toc-базовый-r" class="nav-link" data-scroll-target="#базовый-r">Базовый R</a></li>
  <li><a href="#библиотеки" id="toc-библиотеки" class="nav-link" data-scroll-target="#библиотеки">Библиотеки</a></li>
  <li><a href="#дополнительное-по" id="toc-дополнительное-по" class="nav-link" data-scroll-target="#дополнительное-по">Дополнительное ПО</a>
  <ul class="collapse">
  <li><a href="#rstudio-ide" id="toc-rstudio-ide" class="nav-link" data-scroll-target="#rstudio-ide">RStudio IDE</a></li>
  <li><a href="#pandoc" id="toc-pandoc" class="nav-link" data-scroll-target="#pandoc">Pandoc</a></li>
  <li><a href="#jupyter" id="toc-jupyter" class="nav-link" data-scroll-target="#jupyter">Jupyter</a></li>
  </ul></li>
  <li><a href="#как-использовать-материал" id="toc-как-использовать-материал" class="nav-link" data-scroll-target="#как-использовать-материал">Как использовать материал</a></li>
  </ul></li>
  <li><a href="#начало-работы" id="toc-начало-работы" class="nav-link" data-scroll-target="#начало-работы">Начало работы</a></li>
  <li><a href="#представление-данных" id="toc-представление-данных" class="nav-link" data-scroll-target="#представление-данных">Представление данных</a>
  <ul>
  <li><a href="#простые-типы" id="toc-простые-типы" class="nav-link" data-scroll-target="#простые-типы">Простые типы</a>
  <ul class="collapse">
  <li><a href="#числа-и-имена-значений" id="toc-числа-и-имена-значений" class="nav-link" data-scroll-target="#числа-и-имена-значений">Числа и имена значений</a></li>
  <li><a href="#целые-числа-числа-с-плавающей-точкой" id="toc-целые-числа-числа-с-плавающей-точкой" class="nav-link" data-scroll-target="#целые-числа-числа-с-плавающей-точкой">Целые числа, числа с плавающей точкой</a></li>
  <li><a href="#логические-значения-строки" id="toc-логические-значения-строки" class="nav-link" data-scroll-target="#логические-значения-строки">Логические значения, строки</a></li>
  </ul></li>
  <li><a href="#составные-типы" id="toc-составные-типы" class="nav-link" data-scroll-target="#составные-типы">Составные типы</a>
  <ul class="collapse">
  <li><a href="#списки-одинаковой-длины" id="toc-списки-одинаковой-длины" class="nav-link" data-scroll-target="#списки-одинаковой-длины">Списки одинаковой длины</a></li>
  <li><a href="#таблицы" id="toc-таблицы" class="nav-link" data-scroll-target="#таблицы">Таблицы</a></li>
  <li><a href="#списки-различной-длины" id="toc-списки-различной-длины" class="nav-link" data-scroll-target="#списки-различной-длины">Списки различной длины</a></li>
  </ul></li>
  <li><a href="#матрицы" id="toc-матрицы" class="nav-link" data-scroll-target="#матрицы">Матрицы</a></li>
  <li><a href="#массивы" id="toc-массивы" class="nav-link" data-scroll-target="#массивы">Массивы</a></li>
  <li><a href="#факторы" id="toc-факторы" class="nav-link" data-scroll-target="#факторы">Факторы</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#r-как-гис" id="toc-r-как-гис" class="nav-link" data-scroll-target="#r-как-гис">R как ГИС?</a>
  <ul>
  <li><a href="#средства-визуализации" id="toc-средства-визуализации" class="nav-link" data-scroll-target="#средства-визуализации">Средства визуализации</a>
  <ul>
  <li><a href="#пример-путешествия-мимочерез-спб" id="toc-пример-путешествия-мимочерез-спб" class="nav-link" data-scroll-target="#пример-путешествия-мимочерез-спб">Пример путешествия мимо/через Спб</a></li>
  <li><a href="#datavolcano" id="toc-datavolcano" class="nav-link" data-scroll-target="#datavolcano"><code>data(volcano)</code></a></li>
  </ul></li>
  <li><a href="#пространственные-данные" id="toc-пространственные-данные" class="nav-link" data-scroll-target="#пространственные-данные">Пространст­вен­ные данные</a>
  <ul>
  <li><a href="#векторы" id="toc-векторы" class="nav-link" data-scroll-target="#векторы">Векторы</a></li>
  <li><a href="#растры" id="toc-растры" class="nav-link" data-scroll-target="#растры">Растры</a></li>
  <li><a href="#визуализация" id="toc-визуализация" class="nav-link" data-scroll-target="#визуализация">Визуализация</a></li>
  </ul></li>
  <li><a href="#по-форматам" id="toc-по-форматам" class="nav-link" data-scroll-target="#по-форматам">По форматам</a>
  <ul>
  <li><a href="#растры-1" id="toc-растры-1" class="nav-link" data-scroll-target="#растры-1">Растры</a></li>
  <li><a href="#векторы-1" id="toc-векторы-1" class="nav-link" data-scroll-target="#векторы-1">Векторы</a></li>
  <li><a href="#sf-или-sp" id="toc-sf-или-sp" class="nav-link" data-scroll-target="#sf-или-sp"><code>sf</code> или <code>sp</code>?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#манипуляции-с-пространственными-данными" id="toc-манипуляции-с-пространственными-данными" class="nav-link" data-scroll-target="#манипуляции-с-пространственными-данными">Манипуляции с пространст­вен­ными данными</a>
  <ul>
  <li><a href="#импорт" id="toc-импорт" class="nav-link" data-scroll-target="#импорт">Импорт</a>
  <ul>
  <li><a href="#источники-для-примера" id="toc-источники-для-примера" class="nav-link" data-scroll-target="#источники-для-примера">Источники для примера</a></li>
  <li><a href="#векторные-данные" id="toc-векторные-данные" class="nav-link" data-scroll-target="#векторные-данные">Векторные данные</a>
  <ul class="collapse">
  <li><a href="#rgdalsp" id="toc-rgdalsp" class="nav-link" data-scroll-target="#rgdalsp"><code>rgdal/sp</code></a></li>
  <li><a href="#importExample" id="toc-importExample" class="nav-link" data-scroll-target="#importExample"><code>sf</code></a></li>
  </ul></li>
  <li><a href="#растровые-данные" id="toc-растровые-данные" class="nav-link" data-scroll-target="#растровые-данные">Растровые данные</a>
  <ul class="collapse">
  <li><a href="#rgdalsp-1" id="toc-rgdalsp-1" class="nav-link" data-scroll-target="#rgdalsp-1"><code>rgdal/sp</code></a></li>
  <li><a href="#raster" id="toc-raster" class="nav-link" data-scroll-target="#raster"><code>raster</code></a></li>
  <li><a href="#terra" id="toc-terra" class="nav-link" data-scroll-target="#terra"><code>terra</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#характеристики" id="toc-характеристики" class="nav-link" data-scroll-target="#характеристики">Характеристики</a>
  <ul>
  <li><a href="#sp" id="toc-sp" class="nav-link" data-scroll-target="#sp"><code>sp</code></a></li>
  <li><a href="#sf" id="toc-sf" class="nav-link" data-scroll-target="#sf"><code>sf</code></a></li>
  <li><a href="#таблица-атрибутов" id="toc-таблица-атрибутов" class="nav-link" data-scroll-target="#таблица-атрибутов">Таблица атрибутов</a>
  <ul class="collapse">
  <li><a href="#sp-1" id="toc-sp-1" class="nav-link" data-scroll-target="#sp-1"><code>sp</code></a></li>
  <li><a href="#sf-1" id="toc-sf-1" class="nav-link" data-scroll-target="#sf-1"><code>sf</code></a></li>
  </ul></li>
  <li><a href="#геометрия" id="toc-геометрия" class="nav-link" data-scroll-target="#геометрия">Геометрия</a>
  <ul class="collapse">
  <li><a href="#sp-2" id="toc-sp-2" class="nav-link" data-scroll-target="#sp-2"><code>sp</code></a></li>
  <li><a href="#sf-2" id="toc-sf-2" class="nav-link" data-scroll-target="#sf-2"><code>sf</code></a></li>
  </ul></li>
  <li><a href="#проекция" id="toc-проекция" class="nav-link" data-scroll-target="#проекция">Проекция</a>
  <ul class="collapse">
  <li><a href="#sp-3" id="toc-sp-3" class="nav-link" data-scroll-target="#sp-3"><code>sp</code></a></li>
  <li><a href="#sf-3" id="toc-sf-3" class="nav-link" data-scroll-target="#sf-3"><code>sf</code></a></li>
  </ul></li>
  <li><a href="#пространственный-охват" id="toc-пространственный-охват" class="nav-link" data-scroll-target="#пространственный-охват">Пространственный охват</a>
  <ul class="collapse">
  <li><a href="#sp-4" id="toc-sp-4" class="nav-link" data-scroll-target="#sp-4"><code>sp</code></a></li>
  <li><a href="#sf-4" id="toc-sf-4" class="nav-link" data-scroll-target="#sf-4"><code>sf</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#создание" id="toc-создание" class="nav-link" data-scroll-target="#создание">Создание</a></li>
  <li><a href="#визуализация-1" id="toc-визуализация-1" class="nav-link" data-scroll-target="#визуализация-1">Визуализация</a>
  <ul>
  <li><a href="#статическая" id="toc-статическая" class="nav-link" data-scroll-target="#статическая">Статическая</a>
  <ul class="collapse">
  <li><a href="#ggplot2" id="toc-ggplot2" class="nav-link" data-scroll-target="#ggplot2"><code>ggplot2</code></a></li>
  <li><a href="#tmap" id="toc-tmap" class="nav-link" data-scroll-target="#tmap"><code>tmap</code></a></li>
  <li><a href="#для-публикаций" id="toc-для-публикаций" class="nav-link" data-scroll-target="#для-публикаций">Для публикаций</a></li>
  </ul></li>
  <li><a href="#интерактивная" id="toc-интерактивная" class="nav-link" data-scroll-target="#интерактивная">Интерактивная</a>
  <ul class="collapse">
  <li><a href="#mapview" id="toc-mapview" class="nav-link" data-scroll-target="#mapview"><code>mapview</code></a></li>
  <li><a href="#leaflet" id="toc-leaflet" class="nav-link" data-scroll-target="#leaflet"><code>leaflet</code></a></li>
  <li><a href="#tmap-1" id="toc-tmap-1" class="nav-link" data-scroll-target="#tmap-1"><code>tmap</code></a></li>
  <li><a href="#примеры" id="toc-примеры" class="nav-link" data-scroll-target="#примеры">Примеры</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#экспорт" id="toc-экспорт" class="nav-link" data-scroll-target="#экспорт">Экспорт</a>
  <ul>
  <li><a href="#sprgdal" id="toc-sprgdal" class="nav-link" data-scroll-target="#sprgdal"><code>sp/rgdal</code></a></li>
  <li><a href="#sf-5" id="toc-sf-5" class="nav-link" data-scroll-target="#sf-5"><code>sf</code></a></li>
  </ul></li>
  <li><a href="#рисование" id="toc-рисование" class="nav-link" data-scroll-target="#рисование">Рисование</a></li>
  </ul></li>
  <li><a href="#дополнительно-по-r" id="toc-дополнительно-по-r" class="nav-link" data-scroll-target="#дополнительно-по-r">Дополнительно по R</a>
  <ul>
  <li><a href="#воспроизводимость" id="toc-воспроизводимость" class="nav-link" data-scroll-target="#воспроизводимость">Воспроизво­ди­мость</a>
  <ul>
  <li><a href="#параметры-сессии" id="toc-параметры-сессии" class="nav-link" data-scroll-target="#параметры-сессии">Параметры сессии</a></li>
  </ul></li>
  <li><a href="#узнать-больше-об-r" id="toc-узнать-больше-об-r" class="nav-link" data-scroll-target="#узнать-больше-об-r">Узнать больше об R</a>
  <ul>
  <li><a href="#книги" id="toc-книги" class="nav-link" data-scroll-target="#книги">Книги</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="основы-r" class="level2">
<h2 class="anchored" data-anchor-id="основы-r">Основы R</h2>
<section id="установка-r" class="level3">
<h3 class="anchored" data-anchor-id="установка-r">Установка R</h3>
<section id="oперационные-системы" class="level4">
<h4 class="anchored" data-anchor-id="oперационные-системы">Oперационные системы</h4>
<p>Не для всех операционных систем есть скомпилированные модули (ядро R, библиотеки). В таком случае модули компилируются, и на это уходит какое-то время. Поэтому если ОС не OS Windows, то этот этап нужно пройти заранее.</p>
</section>
<section id="базовый-r" class="level4">
<h4 class="anchored" data-anchor-id="базовый-r">Базовый R</h4>
<p>Установить или обновить R, например, <a href="https://cran.rstudio.org/">отсюда</a>. Актуальная версия 4.2.3. Не ниже версии 4.0.</p>
</section>
<section id="библиотеки" class="level4">
<h4 class="anchored" data-anchor-id="библиотеки">Библиотеки</h4>
<div class="scrollable">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pkgList <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sf"</span>,<span class="st">"terra"</span>,<span class="st">"raster"</span>,<span class="st">"ggplot2"</span>,<span class="st">"leaflet"</span>,<span class="st">"mapview"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>            ,<span class="st">"mapedit"</span>,<span class="st">"knitr"</span>,<span class="st">"rmarkdown"</span>,<span class="st">"jpeg"</span>,<span class="st">"png"</span>,<span class="st">"tmap"</span>,<span class="st">"ursa"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>whoisready <span class="ot">&lt;-</span> <span class="fu">sapply</span>(pkgList,<span class="cf">function</span>(pkg) {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">requireNamespace</span>(pkg))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">install.packages</span>(pkg,<span class="at">repos=</span><span class="st">"https://cran.rstudio.com"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">requireNamespace</span>(pkg)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: sf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: terra</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: raster</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: ggplot2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: leaflet</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: mapview</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: mapedit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: jpeg</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: tmap</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: ursa</code></pre>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>whoisready</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##        sf     terra    raster   ggplot2   leaflet   mapview   mapedit     knitr 
##      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE 
## rmarkdown      jpeg       png      tmap      ursa 
##      TRUE      TRUE      TRUE      TRUE      TRUE</code></pre>
</div>
</div>
<p>Если отображается <code>TRUE</code> для всех библиотек, то подготовка к занятию осуществлена успешно.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">'Everything is ready?'</span><span class="ot">=</span><span class="fu">all</span>(whoisready))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Everything is ready? 
##                 TRUE</code></pre>
</div>
</div>
<p>Если где-то выскочило <code>FALSE</code> (например, для библиотеки “foo”), то можно попробовать его установить заново функцией <code>install.packages("foo")</code>.</p>
</section>
<section id="дополнительное-по" class="level4">
<h4 class="anchored" data-anchor-id="дополнительное-по">Дополнительное ПО</h4>
<section id="rstudio-ide" class="level5 middle center">
<h5 class="middle center anchored" data-anchor-id="rstudio-ide">RStudio IDE</h5>
<p><sup>факультативно</sup></p>
</section>
<section id="pandoc" class="level5">
<h5 class="anchored" data-anchor-id="pandoc">Pandoc</h5>
<div class="font90">
<p>Pandoc необходим для создания воспроизводимого результата. Этот шаг опциональный, и может быть пропущен, но в этом случае на занятии будет пропущен раздел по <a href="#report1">публикации результатов</a>.</p>
<p><a href="https://pandoc.org/installing.html">Ссылка</a> на страницу для скачивания. Для пользователей Windows достаточно перейти к <a href="https://github.com/jgm/pandoc/releases/latest">скачиванию актуального релиза</a>, и выбрать либо установщик (<code>*.msi</code>), либо архив (<code>*.zip</code>). Запомнить путь, куда произведена установка и где находится файл <code>pandoc.exe</code> и добавить этот путь в переменную окружения <code>%PATH%</code>, например: WindowsKey+Q, ввести “Переменные среды/Environment Variables”, попасть в окошко “Свойства Системы/System Properties”, нажать на кнопку “Переменные среды/Environment Variables” и отредактировать пользовательскую или системную переменную PATH, добавив путь к <code>pandoc.exe</code>.</p>
<p>Чтобы проверить правильно ли установлен Pandoc, в новой R-сессии:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">pandoc_available</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] TRUE</code></pre>
</div>
</div>
</div>
</section>
<section id="jupyter" class="level5">
<h5 class="anchored" data-anchor-id="jupyter">Jupyter</h5>
<p>Jupyter Notebook для работы с R кодом в браузере.</p>
<ol type="1">
<li><p><a href="https://docs.conda.io/en/latest/miniconda.html">Загрузить</a> и установить менеджер Miniconda (проверено на Windows 64bit Python 3.7).</p></li>
<li><p>Запустить <code>conda</code> (На Windows попробовать WinKey+Q и начать вводить “Anaconda”)</p></li>
<li><p>Последовательно выполнить команды (в среде Conda, не в среде R):</p></li>
</ol>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Команда</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>conda install jupyter</code></td>
<td>установка Jupyter Notebook</td>
</tr>
<tr class="even">
<td><code>conda install -c r r-recommended r-irkernel</code></td>
<td>Установка R, базовых библиотек и библиотеки для использования R в Jupyter Notebook</td>
</tr>
<tr class="odd">
<td><code>conda install -c conda-forge jupytext</code></td>
<td>Установка преобразователя кода R в формат Jupyter Notebook</td>
</tr>
</tbody>
</table>
<!--
Предварительно скачайте [`main.R`](./main.R) или только код [`codeOnly.R`](./codeOnly.R), если будете использовать на занятии Jupyter Notebook. Если проблема с кодировкой остается, попробуйте взять 
[`codeOnly1251.R`](./codeOnly1251.R)
Предупреждение: описательный текст (markdown) местами не отформатирован, в частности, не будут отображаться таблицы; также не будут отображаться html-виджеты.
-->
</section>
</section>
<section id="как-использовать-материал" class="level4">
<h4 class="anchored" data-anchor-id="как-использовать-материал">Как использовать материал</h4>
<p>Предполагается, что во время занятий будет использоваться интерактивный режим: либо простая среда R (R, запущенный без команд), либо графическая среда R GUI, либо RStudio.</p>
<p>Блок исходного кода выделен моноширинным шрифтом с подсветкой синтаксиса, после которого либо приведен текстовый вывод (более бледный цвет шрифта), либо графический вывод (рисунок, таблица). В среде R нужно вводить код из верхнего блока и сравнивать полученный вывод с содержимым нижнего блока.</p>
<p>К примеру, ниже приведен пример вывода числа <span class="math inline">\(\pi\)</span>: сверху – команда, снизу – выход.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>pi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 3.141593</code></pre>
</div>
</div>
</section>
</section>
<section id="начало-работы" class="level3">
<h3 class="anchored" data-anchor-id="начало-работы">Начало работы</h3>
<p>Текущий путь, где мы находимся. Здесь появятся файлы, созданные в процессе занятия.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "C:/platt/education/202204-GIS"</code></pre>
</div>
</div>
<p>Его можно поменять через меню RGui/RStudio или с помощью <code>setwd()</code>.</p>
<p>Зафиксируем генератор псевдослучайных чисел на определенную последовательность</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">353</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  [1]  2  7 10  6  4  1  3  9  5  8</code></pre>
</div>
</div>
<div class="font90">
<p>Команда для проверки кириллицы:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(<span class="st">'Здесь кириллица?'</span><span class="ot">=</span><span class="st">"Да!"</span>),<span class="at">quote=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Здесь кириллица? 
##              Да!</code></pre>
</div>
</div>
<p>Если вывод не читаемый, то возможные пути решения:</p>
<p>1. Задать кириллицу для символьной локали:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (.Platform<span class="sc">$</span>OS.type<span class="sc">==</span><span class="st">"windows"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">Sys.setlocale</span>(<span class="st">"LC_CTYPE"</span>,<span class="st">"Russian"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning in Sys.setlocale("LC_CTYPE", "Russian"): using locale code page other
## than 65001 ("UTF-8") may cause problems</code></pre>
</div>
</div>
<p>2. Если скрипты подключаются через <code>source()</code>, то можно настроить запуск R через конфигурационные файлы. Например, скачать <a href="./.Rprofile">.Rprofile</a>, разместить в рабочей директории, перегрузить R. Файл имеет следующую структуру:</p>
<pre><code> local({
    options(encoding="UTF-8")
    Sys.setlocale("LC_CTYPE","Russian")
 })</code></pre>
<p>3. Если скрипт <code>bar.R</code> с кириллицей в кодировке UTF-8 запускается из командной строки, то использовать следующие параметры запуска.</p>
<pre><code> R --encoding UTF-8 -f bar.R</code></pre>
</div>
</section>
<section id="представление-данных" class="level3">
<h3 class="anchored" data-anchor-id="представление-данных">Представление данных</h3>
<section id="простые-типы" class="level4">
<h4 class="anchored" data-anchor-id="простые-типы">Простые типы</h4>
<section id="числа-и-имена-значений" class="level5">
<h5 class="anchored" data-anchor-id="числа-и-имена-значений">Числа и имена значений</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>(a1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 1 2 3 4 5 6 7</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  int [1:7] 1 2 3 4 5 6 7</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> a1</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(a2) <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>()<span class="sc">+</span>a1<span class="dv">-1</span>,<span class="st">"%A"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>a2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##    Sunday    Monday   Tuesday Wednesday  Thursday    Friday  Saturday 
##         1         2         3         4         5         6         7</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Named int [1:7] 1 2 3 4 5 6 7
##  - attr(*, "names")= chr [1:7] "Sunday" "Monday" "Tuesday" "Wednesday" ...</code></pre>
</div>
</div>
</section>
<section id="целые-числа-числа-с-плавающей-точкой" class="level5">
<h5 class="anchored" data-anchor-id="целые-числа-числа-с-плавающей-точкой">Целые числа, числа с плавающей точкой</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a2<span class="sc">+</span><span class="dv">0</span>L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Named int [1:7] 1 2 3 4 5 6 7
##  - attr(*, "names")= chr [1:7] "Sunday" "Monday" "Tuesday" "Wednesday" ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a2<span class="sc">+</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Named num [1:7] 1 2 3 4 5 6 7
##  - attr(*, "names")= chr [1:7] "Sunday" "Monday" "Tuesday" "Wednesday" ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(a2<span class="sc">+</span><span class="dv">0</span>L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "integer"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(a2<span class="sc">+</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "double"</code></pre>
</div>
</div>
</section>
<section id="логические-значения-строки" class="level5">
<h5 class="anchored" data-anchor-id="логические-значения-строки">Логические значения, строки</h5>
<h5 class="toc-ignore unnumbered unlisted anchored">
Логические значения
</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>(a3 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">FALSE</span>),<span class="fu">length</span>(a2),<span class="at">replace=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] FALSE FALSE  TRUE FALSE FALSE  TRUE  TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "logical"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  logi [1:7] FALSE FALSE TRUE FALSE FALSE TRUE ...</code></pre>
</div>
</div>
<h5 class="toc-ignore unnumbered unlisted anchored">
Строки
</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>(a4 <span class="ot">&lt;-</span> <span class="fu">names</span>(a2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "Sunday"    "Monday"    "Tuesday"   "Wednesday" "Thursday"  "Friday"   
## [7] "Saturday"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "character"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  chr [1:7] "Sunday" "Monday" "Tuesday" "Wednesday" "Thursday" "Friday" ...</code></pre>
</div>
</div>
</section>
</section>
<section id="составные-типы" class="level4">
<h4 class="anchored" data-anchor-id="составные-типы">Составные типы</h4>
<section id="списки-одинаковой-длины" class="level5">
<h5 class="anchored" data-anchor-id="списки-одинаковой-длины">Списки одинаковой длины</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>(a5 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">num=</span>a1[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>)],<span class="at">char=</span>a4[<span class="sc">-</span><span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## $num
## [1] 1 3 4 5 6 7
## 
## $char
## [1] "Sunday"    "Tuesday"   "Wednesday" "Thursday"  "Friday"    "Saturday"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## List of 2
##  $ num : int [1:6] 1 3 4 5 6 7
##  $ char: chr [1:6] "Sunday" "Tuesday" "Wednesday" "Thursday" ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "list"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(a5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(a5,length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  num char 
##    6    6</code></pre>
</div>
</div>
</section>
<section id="таблицы" class="level5">
<h5 class="anchored" data-anchor-id="таблицы">Таблицы</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>(a6 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">num=</span>a1[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>)],<span class="at">char=</span>a4[<span class="sc">-</span><span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">num</th>
<th style="text-align: left;">char</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Sunday</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Tuesday</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Wednesday</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Thursday</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">Friday</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: left;">Saturday</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 'data.frame':    6 obs. of  2 variables:
##  $ num : int  1 3 4 5 6 7
##  $ char: chr  "Sunday" "Tuesday" "Wednesday" "Thursday" ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "data.frame"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(a6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 6 2</code></pre>
</div>
</div>
</section>
<section id="списки-различной-длины" class="level5">
<h5 class="anchored" data-anchor-id="списки-различной-длины">Списки различной длины</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>(a7 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x=</span><span class="fu">sample</span>(a1,<span class="dv">3</span>),<span class="at">y=</span><span class="fu">sample</span>(a1,<span class="dv">5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## $x
## [1] 7 2 3
## 
## $y
## [1] 7 3 2 4 6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## List of 2
##  $ x: int [1:3] 7 2 3
##  $ y: int [1:5] 7 3 2 4 6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "list"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(a7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(a7,length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## x y 
## 3 5</code></pre>
</div>
</div>
</section>
</section>
<section id="матрицы" class="level4">
<h4 class="anchored" data-anchor-id="матрицы">Матрицы</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>(a11 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">24</span>)),<span class="at">ncol=</span><span class="dv">4</span>,<span class="at">nrow=</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning in matrix(sample(seq(24)), ncol = 4, nrow = 3): data length differs
## from size of matrix: [24 != 3 x 4]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]   20   24    6   17
## [2,]    8   23    2   13
## [3,]   22    1   21   10</code></pre>
</div>
</div>
<p>Размерность массива</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(a11)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 3 4</code></pre>
</div>
</div>
<p>Структура данных массива</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a11)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  int [1:3, 1:4] 20 8 22 24 23 1 6 2 21 17 ...</code></pre>
</div>
</div>
</section>
<section id="массивы" class="level4">
<h4 class="anchored" data-anchor-id="массивы">Массивы</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>(a8 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">sample</span>(<span class="dv">24</span>),<span class="at">dim=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## , , 1
## 
##      [,1] [,2] [,3] [,4]
## [1,]   10    4    2   17
## [2,]    9    5   16   19
## [3,]   14   15   18   22
## 
## , , 2
## 
##      [,1] [,2] [,3] [,4]
## [1,]   20   23    7   21
## [2,]   11    6   13   12
## [3,]    3    8   24    1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  int [1:3, 1:4, 1:2] 10 9 14 4 5 15 2 16 18 17 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "array"</code></pre>
</div>
</div>
</section>
<section id="факторы" class="level4">
<h4 class="anchored" data-anchor-id="факторы">Факторы</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>(a9 <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(a4),<span class="at">levels=</span>a4))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] Monday    Sunday    Tuesday   Thursday  Wednesday Saturday  Friday   
## Levels: Sunday Monday Tuesday Wednesday Thursday Friday Saturday</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a9)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Factor w/ 7 levels "Sunday","Monday",..: 2 1 3 5 4 7 6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a9)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "factor"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>(a10 <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(a4),<span class="at">levels=</span>a4,<span class="at">ordered=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] Wednesday Thursday  Saturday  Sunday    Tuesday   Friday    Monday   
## 7 Levels: Sunday &lt; Monday &lt; Tuesday &lt; Wednesday &lt; Thursday &lt; ... &lt; Saturday</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Ord.factor w/ 7 levels "Sunday"&lt;"Monday"&lt;..: 4 5 7 1 3 6 2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "ordered" "factor"</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="r-как-гис" class="level2">
<h2 class="anchored" data-anchor-id="r-как-гис">R как ГИС?</h2>
<ul>
<li><p>R устроен так, что можно реализовать сложные структуры данных, со средствами их инспектирования, что вполне применимо для пространственных данных и их метаданных</p></li>
<li><p>В R есть инструменты для анализа данных</p></li>
<li><p>В R есть инструменты для визуализации</p></li>
<li><p><em>Как особенность развития до текущего момента</em>: воспроизводимость реализована лучше интерактивности</p></li>
<li><p>В R уже многое сделано по манипуляции с пространственными данными: пользователю не обязательно быть разработчиком</p></li>
</ul>
<section id="средства-визуализации" class="level3">
<h3 class="anchored" data-anchor-id="средства-визуализации">Средства визуализации</h3>
<p>Базовые средства R для визуализации (библиотека <code>graphics</code>) пространственных данных:</p>
<ul>
<li><p><code>points()</code> – отображение точек (геометрия POINT)</p></li>
<li><p><code>lines()</code>, <code>segments()</code>, <code>contour()</code> – отображение линий (геометрия LINESTRING)</p></li>
<li><p><code>polygon()</code>, <code>polypath()</code> – отображение полигонов (геометрия POLYGON)</p></li>
<li><p><code>image()</code>, <code>rasterImage()</code> – растровые изображения</p></li>
<li><p><code>text()</code>, <code>legend()</code> – аннотациии</p></li>
<li><p><code>axis()</code>, <code>mtext()</code> – рамочное оформление</p></li>
</ul>
<section id="пример-путешествия-мимочерез-спб" class="level4">
<h4 class="anchored" data-anchor-id="пример-путешествия-мимочерез-спб">Пример путешествия мимо/через Спб</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>seqx <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">20</span>,<span class="dv">40</span>,<span class="at">by=</span><span class="dv">5</span>)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>seqy <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">55</span>,<span class="dv">65</span>,<span class="at">by=</span><span class="dv">2</span>)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">runif</span>(n,<span class="at">min=</span><span class="fu">min</span>(seqx),<span class="at">max=</span><span class="fu">max</span>(seqx)))</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">runif</span>(n,<span class="at">min=</span><span class="fu">min</span>(seqy),<span class="at">max=</span><span class="fu">max</span>(seqy)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y,<span class="at">type=</span><span class="st">"n"</span>,<span class="at">asp=</span><span class="cn">NA</span>,<span class="at">axes=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="st">""</span>,<span class="at">ylab=</span><span class="st">""</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x,y,<span class="at">lwd=</span><span class="dv">4</span>,<span class="at">col=</span><span class="st">"black"</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x,y,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>()</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>,<span class="at">at=</span>seqx,<span class="at">lab=</span><span class="fu">paste0</span>(seqx,<span class="st">"°E"</span>),<span class="at">lwd=</span><span class="dv">0</span>,<span class="at">lwd.ticks=</span><span class="dv">1</span>,<span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>,<span class="at">at=</span>seqy,<span class="at">lab=</span><span class="fu">paste0</span>(seqy,<span class="st">"°N"</span>),<span class="at">lwd=</span><span class="dv">0</span>,<span class="at">lwd.ticks=</span><span class="dv">1</span>,<span class="at">las=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05/spb1-1.svg" width="600" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sfc</span>(sf<span class="sc">::</span><span class="fu">st_linestring</span>(<span class="fu">cbind</span>(x,y)),<span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">session_grid</span>(<span class="cn">NULL</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">glance</span>(e,<span class="at">blank=</span><span class="st">"white"</span>,<span class="at">coast.fill=</span><span class="st">"#00000010"</span>,<span class="at">pointsize=</span><span class="dv">12</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">col=</span><span class="st">"black"</span>,<span class="at">plot.lwd=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## grid as is</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05//ursa01_spb2.png" width="293" height="500" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="datavolcano" class="level4">
<h4 class="anchored" data-anchor-id="datavolcano"><code>data(volcano)</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(volcano)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05/imgvolcano-1.svg" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Это вулкан Maunga Whau (Mt Eden).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">:::</span><span class="fu">spatialize</span>(<span class="st">"Mount Eden"</span>,<span class="at">place=</span><span class="st">"park"</span>,<span class="at">style=</span><span class="st">"web"</span>) <span class="sc">|&gt;</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>   ursa<span class="sc">::</span><span class="fu">glance</span>(<span class="at">basemap.alpha=</span><span class="dv">1</span>,<span class="at">style=</span><span class="st">"mapnik"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05//ursa03_glancevolcano.png" width="229" height="550" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="пространственные-данные" class="level3">
<h3 class="anchored" data-anchor-id="пространственные-данные">Пространст­вен­ные данные</h3>
<section id="векторы" class="level4">
<h4 class="anchored" data-anchor-id="векторы">Векторы</h4>
<table class="table">
<thead>
<tr class="header">
<th>Библиотека</th>
<th>Формат</th>
<th>Импорт</th>
<th>Экспорт</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>sp</code></td>
<td><a href="https://gdal.org/drivers/vector/index.html">GDAL vector drivers</a></td>
<td><strong><code>rgdal</code></strong><code>::readOGR()</code> <sup>1</sup></td>
<td><strong><code>rgdal</code></strong><code>::writeOGR()</code></td>
</tr>
<tr class="even">
<td><a href="https://r-spatial.github.io/sf/"><code>sf</code></a></td>
<td><a href="https://gdal.org/drivers/vector/index.html">GDAL vector drivers</a></td>
<td><code>st_read()</code></td>
<td><code>st_write()</code></td>
</tr>
<tr class="odd">
<td><a href="https://cran.rstudio.com/web/packages/gdalUtils/"><code>gdalUtuls</code></a><sup><em>факультативно</em><sup></sup></sup></td>
<td><a href="https://gdal.org/drivers/vector/index.html">GDAL vector drivers</a></td>
<td></td>
<td>оболочка системного GDAL</td>
</tr>
</tbody>
</table>
<p>1: <code>sf::as_Spatial(sf::st_read())</code><br><br><code>ursa::spatial_read(fname,engine="sp")</code></p>
</section>
<section id="растры" class="level4">
<h4 class="anchored" data-anchor-id="растры">Растры</h4>
<table class="table">
<thead>
<tr class="header">
<th>Библиотека</th>
<th>Формат</th>
<th>Импорт</th>
<th>Экспорт</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>sp</code></td>
<td><a href="https://gdal.org/drivers/raster/index.html">GDAL raster drivers</a></td>
<td><strong><code>rgdal</code></strong><code>::readGDAL()</code></td>
<td><strong><code>rgdal</code></strong><code>::writeGDAL()</code></td>
</tr>
<tr class="even">
<td><code>raster</code></td>
<td><a href="https://gdal.org/drivers/raster/rraster.html">RRASTER – R Raster</a></td>
<td><code>raster()</code>, <code>brick()</code>, <code>stack()</code></td>
<td><code>writeRaster()</code></td>
</tr>
<tr class="odd">
<td><code>terra</code></td>
<td><a href="https://gdal.org/drivers/raster/index.html">GDAL raster drivers</a></td>
<td><code>rast()</code></td>
<td><code>writeRaster()</code></td>
</tr>
<tr class="even">
<td><code>stars</code></td>
<td><a href="https://gdal.org/drivers/raster/index.html">GDAL raster drivers</a></td>
<td><code>read_stars()</code></td>
<td><code>write_stars()</code></td>
</tr>
<tr class="odd">
<td><a href="https://cran.rstudio.com/web/packages/ncdf4/"><code>ncdf4</code></a></td>
<td><a href="https://gdal.org/drivers/raster/netcdf.html">NetCDF</a></td>
<td><code>nc_open()</code></td>
<td><code>nc_create()</code></td>
</tr>
<tr class="even">
<td><code>ursa</code></td>
<td><a href="https://gdal.org/drivers/raster/envi.html">ENVI - ENVI .hdr Labelled Raster</a></td>
<td><code>read_envi()</code></td>
<td><code>write_envi()</code></td>
</tr>
</tbody>
</table>
</section>
<section id="визуализация" class="level4">
<h4 class="anchored" data-anchor-id="визуализация">Визуализация</h4>
<p>Статическая, экспортируемая в обычные форматы изображений. PNG, JPG поддерживают DPI.</p>
<ul>
<li><p><code>ggplot2</code> и надстройки (префикс <code>gg*</code>)</p></li>
<li><p><code>ursa</code></p></li>
</ul>
<p>Интерактивная, отображаемая в браузере</p>
<ul>
<li><p><code>leaflet</code></p></li>
<li><p><code>mapview</code></p></li>
<li><p><code>tmap</code></p></li>
</ul>
</section>
</section>
<section id="по-форматам" class="level3">
<h3 class="anchored" data-anchor-id="по-форматам">По форматам</h3>
<section id="растры-1" class="level4">
<h4 class="anchored" data-anchor-id="растры-1">Растры</h4>
<ul>
<li>Для хранения многослойные растров используется BSQ/BIL/BIP чередование слоев/строк/пикелей. Самый неэффективный - это BIP. При пространственно-временном анализе можно выбрать BIL, для большинства случаев - BSQ.</li>
<li>Целочисленный GeoTIFF быстро пишется и читается при использовании функций из библиотеки <code>rgdal</code></li>
</ul>
</section>
<section id="векторы-1" class="level4">
<h4 class="anchored" data-anchor-id="векторы-1">Векторы</h4>
<ul>
<li><p>Хорошую скорость чтения и записи демонстрирует формат “SpatiaLite” при использовании библиотеки <code>sf</code>.</p></li>
<li><p>“GeoJSON” не очень быстрый, но можно использовать библиотеку <a href="https://cran.rstudio.com/web/packages/geojsonsf/"><code>geojsonf</code></a>.</p></li>
<li><p>При записи использовать опции, предусмотренные для выбранного формата данных</p></li>
<li><p>При записи “ESRI Shapefile” обращать внимания на *.prj, так как у QGIS и ESRI-продуктов разные восприятия файлов проекций.</p></li>
</ul>
</section>
<section id="sf-или-sp" class="level4">
<h4 class="anchored" data-anchor-id="sf-или-sp"><code>sf</code> или <code>sp</code>?</h4>
<ul>
<li><p>В пользу <span class="large"><code>sf</code></span> больше аргументов:</p>
<ul>
<li><p>удобнее, активно развивается, поддерживается</p></li>
<li><p>в <code>sf</code> объекты класса S3, в <code>sp</code> объекты класса S4 (строже, но медленнее)</p></li>
<li><p>есть <code>sf::as_Spatial()</code> для преобразования в объекты <code>sp</code>. Обратное преобразование: <code>sf::st_as_sf()</code>.</p></li>
</ul></li>
<li><p>Эффективность с геометрией POINT выше у <code>sp</code> из-за представления атрибутивной таблицы и геометрии в одной таблице.</p></li>
<li><p>Ряд библиотек завязаны на формат данных <code>sp</code>, например <a href="https://cran.rstudio.com/web/packages/adehabitatHR/"><code>adehabitatHR</code></a>, <a href="https://cran.rstudio.com/web/packages/dismo/"><code>dismo</code></a>, <a href="https://cran.rstudio.com/web/packages/sdm/"><code>sdm</code></a>.</p></li>
</ul>
</section>
</section>
</section>
<section id="манипуляции-с-пространственными-данными" class="level2">
<h2 class="anchored" data-anchor-id="манипуляции-с-пространственными-данными">Манипуляции с пространст­вен­ными данными</h2>
<section id="импорт" class="level3 middle">
<h3 class="middle anchored" data-anchor-id="импорт">Импорт</h3>
<p>Загрузить пространственные данные из файла</p>
<section id="источники-для-примера" class="level4">
<h4 class="anchored" data-anchor-id="источники-для-примера">Источники для примера</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>(shpname <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"vectors"</span>,<span class="st">"scot_BNG.shp"</span>,<span class="at">package=</span><span class="st">"rgdal"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "C:/Software/Rlibs43/rgdal/vectors/scot_BNG.shp"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.exists</span>(shpname)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>(tifname <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"pictures/cea.tif"</span>,<span class="at">package=</span><span class="st">"rgdal"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "C:/Software/Rlibs43/rgdal/pictures/cea.tif"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.exists</span>(tifname)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">session_grid</span>(<span class="cn">NULL</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">glance</span>(shpname,<span class="at">coast=</span><span class="cn">FALSE</span>,<span class="at">field=</span><span class="st">"(NAME|AFF)"</span>,<span class="at">blank=</span><span class="st">"white"</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">legend=</span><span class="fu">list</span>(<span class="st">"left"</span>,<span class="st">"right"</span>),<span class="at">dpi=</span><span class="dv">88</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## grid as is</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05//ursa05_scotBNG.png" class="img-fluid figure-img">{width=1980 height=500 bound}</p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">session_grid</span>(<span class="cn">NULL</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">glance</span>(tifname,<span class="at">coast=</span><span class="cn">FALSE</span>,<span class="at">pal.from=</span><span class="dv">0</span>,<span class="at">pal=</span><span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"white"</span>),<span class="at">dpi=</span><span class="dv">96</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05//ursa07_cea.png" class="img-fluid figure-img">{width=1341 height=550 bound}</p>
</figure>
</div>
</div>
</div>
</section>
<section id="векторные-данные" class="level4">
<h4 class="anchored" data-anchor-id="векторные-данные">Векторные данные</h4>
<section id="rgdalsp" class="level5">
<h5 class="anchored" data-anchor-id="rgdalsp"><code>rgdal/sp</code></h5>
<div class="oversize h650">
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>rgdal<span class="sc">::</span><span class="fu">ogrInfo</span>(shpname)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Please note that rgdal will be retired during October 2023,
## plan transition to sf/stars/terra functions using GDAL and PROJ
## at your earliest convenience.
## See https://r-spatial.org/r/2023/05/15/evolution4.html and https://github.com/r-spatial/evolution
## rgdal: version: 1.6-7, (SVN revision 1203)
## Geospatial Data Abstraction Library extensions to R successfully loaded
## Loaded GDAL runtime: GDAL 3.6.2, released 2023/01/02
## Path to GDAL shared files: C:/Software/Rlibs43/rgdal/gdal
##  GDAL does not use iconv for recoding strings.
## GDAL binary built with GEOS: TRUE 
## Loaded PROJ runtime: Rel. 9.2.0, March 1st, 2023, [PJ_VERSION: 920]
## Path to PROJ shared files: C:/Software/Rlibs43/rgdal/proj
## PROJ CDN enabled: FALSE
## Linking to sp version:1.6-1
## To mute warnings of possible GDAL/OSR exportToProj4() degradation,
## use options("rgdal_show_exportToProj4_warnings"="none") before loading sp or rgdal.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## Source: "C:\Software\Rlibs43\rgdal\vectors\scot_BNG.shp", layer: "scot_BNG"
## Driver: ESRI Shapefile; number of rows: 56 
## Feature type: wkbPolygon with 2 dimensions
## Extent: (7094.552 529495) - (468285.5 1218342)
## CRS: +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs 
## LDID: 0 
## Number of fields: 13 
##      name type length typeName
## 1   SP_ID    4      5   String
## 2    NAME    4     13   String
## 3    ID_x    2     19     Real
## 4   COUNT    2     19     Real
## 5     SMR    2     19     Real
## 6    LONG    2     19     Real
## 7     LAT    2     19     Real
## 8      PY    2     19     Real
## 9    EXP_    2     19     Real
## 10    AFF    2     19     Real
## 11 X_COOR    2     19     Real
## 12 Y_COOR    2     19     Real
## 13   ID_y    2     19     Real</code></pre>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>b.sp <span class="ot">&lt;-</span> rgdal<span class="sc">::</span><span class="fu">readOGR</span>(shpname)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: "C:\Software\Rlibs43\rgdal\vectors\scot_BNG.shp", layer: "scot_BNG"
## with 56 features
## It has 13 fields</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">isS4</span>(b.sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slotNames</span>(b.sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "data"        "polygons"    "plotOrder"   "bbox"        "proj4string"</code></pre>
</div>
</div>
<div class="oversize">
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">head</span>(b.sp,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Formal class 'SpatialPolygonsDataFrame' [package "sp"] with 5 slots
##   ..@ data       :'data.frame':  2 obs. of  13 variables:
##   .. ..$ SP_ID : chr [1:2] "0" "1"
##   .. ..$ NAME  : chr [1:2] "Sutherland" "Nairn"
##   .. ..$ ID_x  : num [1:2] 12 13
##   .. ..$ COUNT : num [1:2] 5 3
##   .. ..$ SMR   : num [1:2] 279 278
##   .. ..$ LONG  : num [1:2] 58.1 57.5
##   .. ..$ LAT   : num [1:2] 4.64 3.98
##   .. ..$ PY    : num [1:2] 37521 29374
##   .. ..$ EXP_  : num [1:2] 1.8 1.1
##   .. ..$ AFF   : num [1:2] 16 10
##   .. ..$ X_COOR: num [1:2] 247757 289592
##   .. ..$ Y_COOR: num [1:2] 924954 842305
##   .. ..$ ID_y  : num [1:2] 12 13
##   ..@ polygons   :List of 2
##   .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
##   .. .. .. ..@ Polygons :List of 1
##   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
##   .. .. .. .. .. .. ..@ labpt  : num [1:2] 247754 924885
##   .. .. .. .. .. .. ..@ area   : num 3.92e+09
##   .. .. .. .. .. .. ..@ hole   : logi FALSE
##   .. .. .. .. .. .. ..@ ringDir: int 1
##   .. .. .. .. .. .. ..@ coords : num [1:73, 1:2] 254218 254359 252991 244974 259133 ...
##   .. .. .. ..@ plotOrder: int 1
##   .. .. .. ..@ labpt    : num [1:2] 247754 924885
##   .. .. .. ..@ ID       : chr "0"
##   .. .. .. ..@ area     : num 3.92e+09
##   .. .. .. ..$ comment: chr "0"
##   .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
##   .. .. .. ..@ Polygons :List of 1
##   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
##   .. .. .. .. .. .. ..@ labpt  : num [1:2] 289590 842235
##   .. .. .. .. .. .. ..@ area   : num 4.7e+08
##   .. .. .. .. .. .. ..@ hole   : logi FALSE
##   .. .. .. .. .. .. ..@ ringDir: int 1
##   .. .. .. .. .. .. ..@ coords : num [1:9, 1:2] 292542 301399 301520 289304 288882 ...
##   .. .. .. ..@ plotOrder: int 1
##   .. .. .. ..@ labpt    : num [1:2] 289590 842235
##   .. .. .. ..@ ID       : chr "1"
##   .. .. .. ..@ area     : num 4.7e+08
##   .. .. .. ..$ comment: chr "0"
##   ..@ plotOrder  : int [1:2] 1 2
##   ..@ bbox       : num [1:2, 1:2] 204670 825310 306671 974566
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:2] "x" "y"
##   .. .. ..$ : chr [1:2] "min" "max"
##   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot
##   .. .. ..@ projargs: chr "+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs"
##   .. .. ..$ comment: chr "PROJCRS[\"OSGB36 / British National Grid\",\n    BASEGEOGCRS[\"OSGB36\",\n        DATUM[\"Ordnance Survey of Gr"| __truncated__
##   ..$ comment: chr "TRUE"</code></pre>
</div>
</div>
</div>
</section>
<section id="importExample" class="level5">
<h5 class="anchored" data-anchor-id="importExample"><code>sf</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>b.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(shpname)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Reading layer `scot_BNG' from data source 
##   `C:\Software\Rlibs43\rgdal\vectors\scot_BNG.shp' using driver `ESRI Shapefile'
## Simple feature collection with 56 features and 13 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 7094.552 ymin: 529495 xmax: 468285.5 ymax: 1218342
## Projected CRS: OSGB36 / British National Grid</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(b.sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Classes 'sf' and 'data.frame':   56 obs. of  14 variables:
##  $ SP_ID   : chr  "0" "1" "2" "3" ...
##  $ NAME    : chr  "Sutherland" "Nairn" "Inverness" "Banff-Buchan" ...
##  $ ID_x    : num  12 13 19 2 17 16 21 50 15 25 ...
##  $ COUNT   : num  5 3 9 39 2 9 16 6 17 19 ...
##  $ SMR     : num  279 278 163 450 187 ...
##  $ LONG    : num  58.1 57.5 57.2 57.6 57.1 ...
##  $ LAT     : num  4.64 3.98 4.73 2.36 4.09 3 2.98 3.2 3.1 3.3 ...
##  $ PY      : num  37521 29374 162867 231337 27075 ...
##  $ EXP_    : num  1.8 1.1 5.5 8.7 1.1 4.6 10.5 19.6 7.8 15.5 ...
##  $ AFF     : num  16 10 7 16 10 16 7 1 7 1 ...
##  $ X_COOR  : num  247757 289592 249685 385776 280492 ...
##  $ Y_COOR  : num  924954 842305 825855 852378 801036 ...
##  $ ID_y    : num  12 13 19 2 17 16 21 50 15 25 ...
##  $ geometry:sfc_MULTIPOLYGON of length 56; first list element: List of 1
##   ..$ :List of 1
##   .. ..$ : num [1:73, 1:2] 254218 254359 252991 244974 259133 ...
##   ..- attr(*, "class")= chr [1:3] "XY" "MULTIPOLYGON" "sfg"
##  - attr(*, "sf_column")= chr "geometry"
##  - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
##   ..- attr(*, "names")= chr [1:13] "SP_ID" "NAME" "ID_x" "COUNT" ...</code></pre>
</div>
</div>
</section>
</section>
<section id="растровые-данные" class="level4">
<h4 class="anchored" data-anchor-id="растровые-данные">Растровые данные</h4>
<section id="rgdalsp-1" class="level5">
<h5 class="anchored" data-anchor-id="rgdalsp-1"><code>rgdal/sp</code></h5>
<div class="font92">
<p>Получение данных напрямую</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> rgdal<span class="sc">::</span><span class="fu">readGDAL</span>(tifname)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: GDAL support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## C:/Software/Rlibs43/rgdal/pictures/cea.tif has GDAL driver GTiff 
## and has 515 rows and 514 columns</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: GDAL support is provided by the sf and terra packages among others</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Formal class 'SpatialGridDataFrame' [package "sp"] with 4 slots
##   ..@ data       :'data.frame':  264710 obs. of  1 variable:
##   .. ..$ band1: int [1:264710] 0 0 0 0 0 0 0 0 0 0 ...
##   ..@ grid       :Formal class 'GridTopology' [package "sp"] with 3 slots
##   .. .. ..@ cellcentre.offset: Named num [1:2] -28463 4225003
##   .. .. .. ..- attr(*, "names")= chr [1:2] "x" "y"
##   .. .. ..@ cellsize         : num [1:2] 60 60
##   .. .. ..@ cells.dim        : int [1:2] 514 515
##   ..@ bbox       : num [1:2, 1:2] -28493 4224973 2358 4255885
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:2] "x" "y"
##   .. .. ..$ : chr [1:2] "min" "max"
##   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot
##   .. .. ..@ projargs: chr "+proj=cea +lat_ts=33.75 +lon_0=-117.333333333333 +x_0=0 +y_0=0 +datum=NAD27 +units=m +no_defs"
##   .. .. ..$ comment: chr "PROJCRS[\"unnamed\",\n    BASEGEOGCRS[\"NAD27\",\n        DATUM[\"North American Datum 1927\",\n            ELL"| __truncated__</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(d1<span class="sc">@</span>data[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     0.0    58.0    99.0   103.1   140.0   255.0</code></pre>
</div>
</div>
</div>
<p>Получение данных более гибким способом</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>md <span class="ot">&lt;-</span> rgdal<span class="sc">::</span><span class="fu">GDALinfo</span>(tifname)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: GDAL support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: GDAL support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning in rgdal::GDALinfo(tifname): statistics not supported by this driver</code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>mdname <span class="ot">&lt;-</span> <span class="fu">names</span>(md)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(md) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(md) <span class="ot">&lt;-</span> mdname</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>md</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##          rows       columns         bands          ll.x          ll.y 
##     515.00000     514.00000       1.00000  -28493.16678 4224973.14326 
##         res.x         res.y     oblique.x     oblique.y 
##      60.02214      60.02214       0.00000       0.00000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>dset <span class="ot">&lt;-</span> methods<span class="sc">::</span><span class="fu">new</span>(<span class="st">"GDALReadOnlyDataset"</span>,tifname)</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> rgdal<span class="sc">::</span><span class="fu">getRasterData</span>(dset,<span class="at">offset=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>                          ,<span class="at">region.dim=</span>md[<span class="fu">c</span>(<span class="st">"rows"</span>,<span class="st">"columns"</span>)])</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  int [1:514, 1:515] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">c</span>(d2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     0.0    58.0    99.0   103.1   140.0   255.0</code></pre>
</div>
</div>
</section>
<section id="raster" class="level5">
<h5 class="anchored" data-anchor-id="raster"><code>raster</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>(d3 <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">brick</span>(tifname))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## class      : RasterBrick 
## dimensions : 515, 514, 264710, 1  (nrow, ncol, ncell, nlayers)
## resolution : 60.02214, 60.02214  (x, y)
## extent     : -28493.17, 2358.212, 4224973, 4255885  (xmin, xmax, ymin, ymax)
## crs        : +proj=cea +lat_ts=33.75 +lon_0=-117.333333333333 +x_0=0 +y_0=0 +datum=NAD27 +units=m +no_defs 
## source     : cea.tif 
## names      : cea</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>v3 <span class="ot">&lt;-</span> d3[] <span class="do">## 'd3[]' то же, что и 'raster::getValues(d3)'</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">d3=</span><span class="fu">object.size</span>(d3),<span class="at">v3=</span><span class="fu">object.size</span>(v3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##      d3      v3 
##   13688 2118184</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(v3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  num [1:264710, 1] 0 0 0 0 0 0 0 0 0 0 ...
##  - attr(*, "dimnames")=List of 2
##   ..$ : NULL
##   ..$ : chr "cea"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">c</span>(v3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     0.0    58.0    99.0   103.1   140.0   255.0</code></pre>
</div>
</div>
</section>
<section id="terra" class="level5">
<h5 class="anchored" data-anchor-id="terra"><code>terra</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>(d4 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(tifname))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## class       : SpatRaster 
## dimensions  : 515, 514, 1  (nrow, ncol, nlyr)
## resolution  : 60.02214, 60.02214  (x, y)
## extent      : -28493.17, 2358.212, 4224973, 4255885  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=cea +lat_ts=33.75 +lon_0=-117.333333333333 +x_0=0 +y_0=0 +datum=NAD27 +units=m +no_defs 
## source      : cea.tif 
## name        : cea</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>v4 <span class="ot">&lt;-</span> d4[] <span class="do">## 'd4[]' то же, что и 'terra::values(d3)'</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">d4=</span><span class="fu">object.size</span>(d4),<span class="at">v3=</span><span class="fu">object.size</span>(v4))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##      d4      v3 
##    1304 1059344</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(v4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  int [1:264710, 1] 0 0 0 0 0 0 0 0 0 0 ...
##  - attr(*, "dimnames")=List of 2
##   ..$ : NULL
##   ..$ : chr "cea"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">c</span>(v4))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     0.0    58.0    99.0   103.1   140.0   255.0</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="характеристики" class="level3 middle">
<h3 class="middle anchored" data-anchor-id="характеристики">Характеристики</h3>
<h4 class="toc-ignore unnumbered unlisted anchored">
Характеристики, свойства и компоненты пространственных данных
</h4>
<section id="sp" class="level5">
<h5 class="anchored" data-anchor-id="sp"><code>sp</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(b.sp<span class="sc">$</span>NAME)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(b.sp[[<span class="st">"NAME"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(b.sp[<span class="st">"NAME"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "SpatialPolygonsDataFrame"
## attr(,"package")
## [1] "sp"</code></pre>
</div>
</div>
</section>
<section id="sf" class="level5">
<h5 class="anchored" data-anchor-id="sf"><code>sf</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(b.sf<span class="sc">$</span>NAME)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(b.sf[[<span class="st">"NAME"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(b.sf[<span class="st">"NAME"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "sf"         "data.frame"</code></pre>
</div>
</div>
</section>
<section id="таблица-атрибутов" class="level4">
<h4 class="anchored" data-anchor-id="таблица-атрибутов">Таблица атрибутов</h4>
<section id="sp-1" class="level5">
<h5 class="anchored" data-anchor-id="sp-1"><code>sp</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">slot</span>(b.sp,<span class="st">"data"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 14%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">SP_ID</th>
<th style="text-align: left;">NAME</th>
<th style="text-align: right;">ID_x</th>
<th style="text-align: right;">COUNT</th>
<th style="text-align: right;">SMR</th>
<th style="text-align: right;">LONG</th>
<th style="text-align: right;">LAT</th>
<th style="text-align: right;">PY</th>
<th style="text-align: right;">EXP_</th>
<th style="text-align: right;">AFF</th>
<th style="text-align: right;">X_COOR</th>
<th style="text-align: right;">Y_COOR</th>
<th style="text-align: right;">ID_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">Sutherland</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">279.3</td>
<td style="text-align: right;">58.06</td>
<td style="text-align: right;">4.64</td>
<td style="text-align: right;">37521</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">247756.6</td>
<td style="text-align: right;">924953.6</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Nairn</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">277.8</td>
<td style="text-align: right;">57.47</td>
<td style="text-align: right;">3.98</td>
<td style="text-align: right;">29374</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">289592.2</td>
<td style="text-align: right;">842305.2</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">Inverness</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">162.7</td>
<td style="text-align: right;">57.24</td>
<td style="text-align: right;">4.73</td>
<td style="text-align: right;">162867</td>
<td style="text-align: right;">5.5</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">249685.5</td>
<td style="text-align: right;">825854.5</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">Banff-Buchan</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">450.3</td>
<td style="text-align: right;">57.56</td>
<td style="text-align: right;">2.36</td>
<td style="text-align: right;">231337</td>
<td style="text-align: right;">8.7</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">385776.1</td>
<td style="text-align: right;">852378.2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Bedenoch</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">186.9</td>
<td style="text-align: right;">57.06</td>
<td style="text-align: right;">4.09</td>
<td style="text-align: right;">27075</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">280491.6</td>
<td style="text-align: right;">801035.6</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">Kincardine</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">197.8</td>
<td style="text-align: right;">57.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">111665</td>
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">351350.5</td>
<td style="text-align: right;">792161.7</td>
<td style="text-align: right;">16</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="sf-1" class="level5">
<h5 class="anchored" data-anchor-id="sf-1"><code>sf</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(b.sf,<span class="cn">NULL</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 15%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">SP_ID</th>
<th style="text-align: left;">NAME</th>
<th style="text-align: right;">ID_x</th>
<th style="text-align: right;">COUNT</th>
<th style="text-align: right;">SMR</th>
<th style="text-align: right;">LONG</th>
<th style="text-align: right;">LAT</th>
<th style="text-align: right;">PY</th>
<th style="text-align: right;">EXP_</th>
<th style="text-align: right;">AFF</th>
<th style="text-align: right;">X_COOR</th>
<th style="text-align: right;">Y_COOR</th>
<th style="text-align: right;">ID_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">Sutherland</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">279.3</td>
<td style="text-align: right;">58.06</td>
<td style="text-align: right;">4.64</td>
<td style="text-align: right;">37521</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">247756.6</td>
<td style="text-align: right;">924953.6</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Nairn</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">277.8</td>
<td style="text-align: right;">57.47</td>
<td style="text-align: right;">3.98</td>
<td style="text-align: right;">29374</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">289592.2</td>
<td style="text-align: right;">842305.2</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Inverness</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">162.7</td>
<td style="text-align: right;">57.24</td>
<td style="text-align: right;">4.73</td>
<td style="text-align: right;">162867</td>
<td style="text-align: right;">5.5</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">249685.5</td>
<td style="text-align: right;">825854.5</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">Banff-Buchan</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">450.3</td>
<td style="text-align: right;">57.56</td>
<td style="text-align: right;">2.36</td>
<td style="text-align: right;">231337</td>
<td style="text-align: right;">8.7</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">385776.1</td>
<td style="text-align: right;">852378.2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: left;">Bedenoch</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">186.9</td>
<td style="text-align: right;">57.06</td>
<td style="text-align: right;">4.09</td>
<td style="text-align: right;">27075</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">280491.6</td>
<td style="text-align: right;">801035.6</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: left;">Kincardine</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">197.8</td>
<td style="text-align: right;">57.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">111665</td>
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">351350.5</td>
<td style="text-align: right;">792161.7</td>
<td style="text-align: right;">16</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="геометрия" class="level4">
<h4 class="anchored" data-anchor-id="геометрия">Геометрия</h4>
<section id="sp-2" class="level5">
<h5 class="anchored" data-anchor-id="sp-2"><code>sp</code></h5>
<div class="oversize">
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>g.sp <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">geometry</span>(b.sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">head</span>(g.sp,<span class="dv">2</span>)) <span class="do">## много строк; выведем первые две записи</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Formal class 'SpatialPolygons' [package "sp"] with 4 slots
##   ..@ polygons   :List of 2
##   .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
##   .. .. .. ..@ Polygons :List of 1
##   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
##   .. .. .. .. .. .. ..@ labpt  : num [1:2] 247754 924885
##   .. .. .. .. .. .. ..@ area   : num 3.92e+09
##   .. .. .. .. .. .. ..@ hole   : logi FALSE
##   .. .. .. .. .. .. ..@ ringDir: int 1
##   .. .. .. .. .. .. ..@ coords : num [1:73, 1:2] 254218 254359 252991 244974 259133 ...
##   .. .. .. ..@ plotOrder: int 1
##   .. .. .. ..@ labpt    : num [1:2] 247754 924885
##   .. .. .. ..@ ID       : chr "0"
##   .. .. .. ..@ area     : num 3.92e+09
##   .. .. .. ..$ comment: chr "0"
##   .. ..$ :Formal class 'Polygons' [package "sp"] with 5 slots
##   .. .. .. ..@ Polygons :List of 1
##   .. .. .. .. ..$ :Formal class 'Polygon' [package "sp"] with 5 slots
##   .. .. .. .. .. .. ..@ labpt  : num [1:2] 289590 842235
##   .. .. .. .. .. .. ..@ area   : num 4.7e+08
##   .. .. .. .. .. .. ..@ hole   : logi FALSE
##   .. .. .. .. .. .. ..@ ringDir: int 1
##   .. .. .. .. .. .. ..@ coords : num [1:9, 1:2] 292542 301399 301520 289304 288882 ...
##   .. .. .. ..@ plotOrder: int 1
##   .. .. .. ..@ labpt    : num [1:2] 289590 842235
##   .. .. .. ..@ ID       : chr "1"
##   .. .. .. ..@ area     : num 4.7e+08
##   .. .. .. ..$ comment: chr "0"
##   ..@ plotOrder  : int [1:2] 1 2
##   ..@ bbox       : num [1:2, 1:2] 204670 825310 306671 974566
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:2] "x" "y"
##   .. .. ..$ : chr [1:2] "min" "max"
##   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot
##   .. .. ..@ projargs: chr "+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs"
##   .. .. ..$ comment: chr "PROJCRS[\"OSGB36 / British National Grid\",\n    BASEGEOGCRS[\"OSGB36\",\n        DATUM[\"Ordnance Survey of Gr"| __truncated__
##   ..$ comment: chr "TRUE"</code></pre>
</div>
</div>
</div>
</section>
<section id="sf-2" class="level5">
<h5 class="anchored" data-anchor-id="sf-2"><code>sf</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">head</span>(g.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_geometry</span>(b.sf),<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Geometry set for 2 features 
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 204669.7 ymin: 825310 xmax: 306671.2 ymax: 974566.2
## Projected CRS: OSGB36 / British National Grid</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## MULTIPOLYGON (((254218.3 967027, 254358.6 96696...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## MULTIPOLYGON (((292542.2 859596.3, 301398.8 836...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(g.sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## sfc_MULTIPOLYGON of length 56; first list element: List of 1
##  $ :List of 1
##   ..$ : num [1:73, 1:2] 254218 254359 252991 244974 259133 ...
##  - attr(*, "class")= chr [1:3] "XY" "MULTIPOLYGON" "sfg"</code></pre>
</div>
</div>
</section>
</section>
<section id="проекция" class="level4 middle">
<h4 class="middle anchored" data-anchor-id="проекция">Проекция</h4>
<p>В современных пакетах R данные проекции представляются в виде WKT; по возможножности, сохраняется связь с EPSG и PROJ.</p>
<section id="sp-3" class="level5">
<h5 class="anchored" data-anchor-id="sp-3"><code>sp</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">proj4string</span>(b.sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs"</code></pre>
</div>
</div>
</section>
<section id="sf-3" class="level5">
<h5 class="anchored" data-anchor-id="sf-3"><code>sf</code></h5>
<div class="oversize">
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_crs</span>(b.sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Coordinate Reference System:
##   User input: OSGB36 / British National Grid 
##   wkt:
## PROJCRS["OSGB36 / British National Grid",
##     BASEGEOGCRS["OSGB36",
##         DATUM["Ordnance Survey of Great Britain 1936",
##             ELLIPSOID["Airy 1830",6377563.396,299.3249646,
##                 LENGTHUNIT["metre",1]]],
##         PRIMEM["Greenwich",0,
##             ANGLEUNIT["degree",0.0174532925199433]],
##         ID["EPSG",4277]],
##     CONVERSION["British National Grid",
##         METHOD["Transverse Mercator",
##             ID["EPSG",9807]],
##         PARAMETER["Latitude of natural origin",49,
##             ANGLEUNIT["degree",0.0174532925199433],
##             ID["EPSG",8801]],
##         PARAMETER["Longitude of natural origin",-2,
##             ANGLEUNIT["degree",0.0174532925199433],
##             ID["EPSG",8802]],
##         PARAMETER["Scale factor at natural origin",0.9996012717,
##             SCALEUNIT["unity",1],
##             ID["EPSG",8805]],
##         PARAMETER["False easting",400000,
##             LENGTHUNIT["metre",1],
##             ID["EPSG",8806]],
##         PARAMETER["False northing",-100000,
##             LENGTHUNIT["metre",1],
##             ID["EPSG",8807]]],
##     CS[Cartesian,2],
##         AXIS["(E)",east,
##             ORDER[1],
##             LENGTHUNIT["metre",1]],
##         AXIS["(N)",north,
##             ORDER[2],
##             LENGTHUNIT["metre",1]],
##     USAGE[
##         SCOPE["Engineering survey, topographic mapping."],
##         AREA["United Kingdom (UK) - offshore to boundary of UKCS within 49В°45'N to 61В°N and 9В°W to 2В°E; onshore Great Britain (England, Wales and Scotland). Isle of Man onshore."],
##         BBOX[49.75,-9.01,61.01,2.01]],
##     ID["EPSG",27700]]</code></pre>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_crs</span>(b.sf)<span class="sc">$</span>proj4string</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs"</code></pre>
</div>
</div>
</section>
</section>
<section id="пространственный-охват" class="level4">
<h4 class="anchored" data-anchor-id="пространственный-охват">Пространственный охват</h4>
<section id="sp-4" class="level5">
<h5 class="anchored" data-anchor-id="sp-4"><code>sp</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">bbox</span>(b.sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##          min       max
## x   7094.552  468285.5
## y 529495.039 1218342.5</code></pre>
</div>
</div>
</section>
<section id="sf-4" class="level5">
<h5 class="anchored" data-anchor-id="sf-4"><code>sf</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_bbox</span>(b.sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##        xmin        ymin        xmax        ymax 
##    7094.552  529495.039  468285.495 1218342.493</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="создание" class="level3 middle">
<h3 class="middle anchored" data-anchor-id="создание">Создание</h3>
<p>Создание пространственных данных, например, новый слой ГИС</p>
<p>Выйдем из здания вокзала ст. Валдай и создадим точечный <code>Spatial</code>-объект:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>pt0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lon=</span><span class="fl">33.24529</span>,<span class="at">lat=</span><span class="fl">57.97012</span>)</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">coordinates</span>(pt0) <span class="ot">&lt;-</span> <span class="er">~</span>lon<span class="sc">+</span>lat</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">proj4string</span>(pt0) <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">CRS</span>(<span class="st">"+init=epsg:4326"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning in CPL_crs_from_input(x): GDAL Message 1: +init=epsg:XXXX syntax is
## deprecated. It might return a CRS with a non-EPSG compliant axis order.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">glance</span>(pt0,<span class="at">resetProj=</span><span class="cn">TRUE</span>,<span class="at">style=</span><span class="st">"mapnik"</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">basemap.order=</span><span class="st">"before"</span>,<span class="at">basemap.alpha=</span><span class="dv">1</span>,<span class="at">dpi=</span><span class="dv">91</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05//ursa08_Valdai.png" class="img-fluid figure-img" width="440"></p>
</figure>
</div>
</div>
</div>
<p>Смотрим на структуру данных:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pt0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Formal class 'SpatialPoints' [package "sp"] with 3 slots
##   ..@ coords     : num [1, 1:2] 33.2 58
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr "1"
##   .. .. ..$ : chr [1:2] "lon" "lat"
##   ..@ bbox       : num [1:2, 1:2] 33.2 58 33.2 58
##   .. ..- attr(*, "dimnames")=List of 2
##   .. .. ..$ : chr [1:2] "lon" "lat"
##   .. .. ..$ : chr [1:2] "min" "max"
##   ..@ proj4string:Formal class 'CRS' [package "sp"] with 1 slot
##   .. .. ..@ projargs: chr "+proj=longlat +datum=WGS84 +no_defs"
##   .. .. ..$ comment: chr "GEOGCRS[\"WGS 84\",\n    ENSEMBLE[\"World Geodetic System 1984 ensemble\",\n        MEMBER[\"World Geodetic Sys"| __truncated__</code></pre>
</div>
</div>
<p>Изменим проекцию для расчета расстояний по координатам:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>pt0 <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">spTransform</span>(pt0,<span class="st">"+proj=laea +lat_0=58 +lon_0=35 +datum=WGS84"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Извлечем координаты:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">coordinates</span>(pt0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Решаем перемещаться минутными сегментами в течение часа:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">60</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>На основе координат создаем таблицу перемещения. По умолчанию весь период стоим на месте и смотрим на север:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>loc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">step=</span><span class="fu">seq</span>(<span class="dv">0</span>,n),<span class="at">look=</span>pi<span class="sc">/</span><span class="dv">2</span>,<span class="at">x=</span>xy[,<span class="dv">1</span>],<span class="at">y=</span>xy[,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Скорость перемещений (в м&nbsp;мин<sup>-1</sup>) в течение минуты случайна:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>segment <span class="ot">&lt;-</span> <span class="fu">runif</span>(n,<span class="at">min=</span><span class="dv">5</span>,<span class="at">max=</span><span class="dv">80</span>)</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(segment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  num [1:60] 77.2 21.2 54.8 63.7 62.2 ...</code></pre>
</div>
</div>
<p>Задаем, что если следующий сегмент длинный, то отклонение направления от предыдущего сегмента будет меньше:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>angle <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">-</span>segment<span class="sc">/</span><span class="dv">100</span>,<span class="cf">function</span>(x) <span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span><span class="sc">-</span>x<span class="sc">*</span>pi,<span class="at">max=</span>x<span class="sc">*</span>pi))</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(angle)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  num [1:60] -0.157 1.512 0.088 0.755 0.991 ...</code></pre>
</div>
</div>
<p>Заполняем последующие шаги на основе предыдущих:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(n)) {</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>   loc<span class="sc">$</span>look[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (loc<span class="sc">$</span>look[i]<span class="sc">+</span>angle[i]) <span class="sc">%%</span> (<span class="dv">2</span><span class="sc">*</span>pi)</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>   loc<span class="sc">$</span>x[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> loc<span class="sc">$</span>x[i]<span class="sc">+</span>segment[i]<span class="sc">*</span><span class="fu">cos</span>(loc<span class="sc">$</span>look[i<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>   loc<span class="sc">$</span>y[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> loc<span class="sc">$</span>y[i]<span class="sc">+</span>segment[i]<span class="sc">*</span><span class="fu">sin</span>(loc<span class="sc">$</span>look[i<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(loc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">step</th>
<th style="text-align: right;">look</th>
<th style="text-align: right;">x</th>
<th style="text-align: right;">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.570796</td>
<td style="text-align: right;">-103834.6</td>
<td style="text-align: right;">-1982.122</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.414054</td>
<td style="text-align: right;">-103822.5</td>
<td style="text-align: right;">-1905.826</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.926200</td>
<td style="text-align: right;">-103843.2</td>
<td style="text-align: right;">-1901.306</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">3.014161</td>
<td style="text-align: right;">-103897.6</td>
<td style="text-align: right;">-1894.341</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">3.769009</td>
<td style="text-align: right;">-103949.2</td>
<td style="text-align: right;">-1931.751</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">4.759640</td>
<td style="text-align: right;">-103946.2</td>
<td style="text-align: right;">-1993.854</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Создадим линейный <code>sf</code>-объект</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>tr <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>,n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Матрица (с двумя столбцами) координат задается как LINESTRING:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(n))</span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>   tr[[i]] <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_linestring</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(loc<span class="sc">$</span>x[i],loc<span class="sc">$</span>y[i],loc<span class="sc">$</span>x[i<span class="sc">+</span><span class="dv">1</span>],loc<span class="sc">$</span>y[i<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>                               ,<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="oversize">
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## List of 60
##  $ : 'XY' num [1:2, 1:2] -103835 -103823 -1982 -1906
##  $ : 'XY' num [1:2, 1:2] -103823 -103843 -1906 -1901
##  $ : 'XY' num [1:2, 1:2] -103843 -103898 -1901 -1894
##  $ : 'XY' num [1:2, 1:2] -103898 -103949 -1894 -1932
##  $ : 'XY' num [1:2, 1:2] -103949 -103946 -1932 -1994
##  $ : 'XY' num [1:2, 1:2] -103946 -103973 -1994 -2041
##  $ : 'XY' num [1:2, 1:2] -103973 -103951 -2041 -2058
##  $ : 'XY' num [1:2, 1:2] -103951 -103963 -2058 -2079
##  $ : 'XY' num [1:2, 1:2] -103963 -103999 -2079 -2100
##  $ : 'XY' num [1:2, 1:2] -103999 -104010 -2100 -2170
##  $ : 'XY' num [1:2, 1:2] -104010 -104042 -2170 -2188
##  $ : 'XY' num [1:2, 1:2] -104042 -104033 -2188 -2192
##  $ : 'XY' num [1:2, 1:2] -104033 -104038 -2192 -2228
##  $ : 'XY' num [1:2, 1:2] -104038 -104040 -2228 -2280
##  $ : 'XY' num [1:2, 1:2] -104040 -104069 -2280 -2312
##  $ : 'XY' num [1:2, 1:2] -104069 -104052 -2312 -2369
##  $ : 'XY' num [1:2, 1:2] -104052 -104083 -2369 -2367
##  $ : 'XY' num [1:2, 1:2] -104083 -104130 -2367 -2323
##  $ : 'XY' num [1:2, 1:2] -104130 -104195 -2323 -2310
##  $ : 'XY' num [1:2, 1:2] -104195 -104240 -2310 -2346
##  $ : 'XY' num [1:2, 1:2] -104240 -104307 -2346 -2332
##  $ : 'XY' num [1:2, 1:2] -104307 -104358 -2332 -2301
##  $ : 'XY' num [1:2, 1:2] -104358 -104373 -2301 -2281
##  $ : 'XY' num [1:2, 1:2] -104373 -104367 -2281 -2278
##  $ : 'XY' num [1:2, 1:2] -104367 -104353 -2278 -2291
##  $ : 'XY' num [1:2, 1:2] -104353 -104301 -2291 -2311
##  $ : 'XY' num [1:2, 1:2] -104301 -104299 -2311 -2364
##  $ : 'XY' num [1:2, 1:2] -104299 -104300 -2364 -2373
##  $ : 'XY' num [1:2, 1:2] -104300 -104316 -2373 -2374
##  $ : 'XY' num [1:2, 1:2] -104316 -104328 -2374 -2426
##  $ : 'XY' num [1:2, 1:2] -104328 -104341 -2426 -2409
##  $ : 'XY' num [1:2, 1:2] -104341 -104361 -2409 -2389
##  $ : 'XY' num [1:2, 1:2] -104361 -104397 -2389 -2352
##  $ : 'XY' num [1:2, 1:2] -104397 -104389 -2352 -2288
##  $ : 'XY' num [1:2, 1:2] -104389 -104360 -2288 -2255
##  $ : 'XY' num [1:2, 1:2] -104360 -104298 -2255 -2206
##  $ : 'XY' num [1:2, 1:2] -104298 -104280 -2206 -2202
##  $ : 'XY' num [1:2, 1:2] -104280 -104213 -2202 -2183
##  $ : 'XY' num [1:2, 1:2] -104213 -104137 -2183 -2194
##  $ : 'XY' num [1:2, 1:2] -104137 -104079 -2194 -2150
##  $ : 'XY' num [1:2, 1:2] -104079 -104061 -2150 -2139
##  $ : 'XY' num [1:2, 1:2] -104061 -104001 -2139 -2146
##  $ : 'XY' num [1:2, 1:2] -104001 -103932 -2146 -2119
##  $ : 'XY' num [1:2, 1:2] -103932 -103913 -2119 -2070
##  $ : 'XY' num [1:2, 1:2] -103913 -103917 -2070 -2067
##  $ : 'XY' num [1:2, 1:2] -103917 -103994 -2067 -2055
##  $ : 'XY' num [1:2, 1:2] -103994 -104014 -2055 -2107
##  $ : 'XY' num [1:2, 1:2] -104014 -104064 -2107 -2152
##  $ : 'XY' num [1:2, 1:2] -104064 -104087 -2152 -2135
##  $ : 'XY' num [1:2, 1:2] -104087 -104094 -2135 -2129
##  $ : 'XY' num [1:2, 1:2] -104094 -104118 -2129 -2160
##  $ : 'XY' num [1:2, 1:2] -104118 -104175 -2160 -2197
##  $ : 'XY' num [1:2, 1:2] -104175 -104224 -2197 -2229
##  $ : 'XY' num [1:2, 1:2] -104224 -104211 -2229 -2270
##  $ : 'XY' num [1:2, 1:2] -104211 -104235 -2270 -2345
##  $ : 'XY' num [1:2, 1:2] -104235 -104198 -2345 -2406
##  $ : 'XY' num [1:2, 1:2] -104198 -104152 -2406 -2463
##  $ : 'XY' num [1:2, 1:2] -104152 -104152 -2463 -2475
##  $ : 'XY' num [1:2, 1:2] -104152 -104141 -2475 -2515
##  $ : 'XY' num [1:2, 1:2] -104141 -104078 -2515 -2552</code></pre>
</div>
</div>
</div>
<p>Набор сегментов объединяем в геометрию:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>tr <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sfc</span>(tr,<span class="at">crs=</span>sp<span class="sc">::</span><span class="fu">proj4string</span>(pt0))</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## sfc_LINESTRING of length 60; first list element:  'XY' num [1:2, 1:2] -103835 -103823 -1982 -1906</code></pre>
</div>
</div>
<p>С геометрией связываем атрибутивную таблицу.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>tr <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sf</span>(<span class="at">step=</span><span class="fu">seq</span>(n),<span class="at">segment=</span>segment,<span class="at">geometry=</span>tr)</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Classes 'sf' and 'data.frame':   60 obs. of  3 variables:
##  $ step    : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ segment : num  77.2 21.2 54.8 63.7 62.2 ...
##  $ geometry:sfc_LINESTRING of length 60; first list element:  'XY' num [1:2, 1:2] -103835 -103823 -1982 -1906
##  - attr(*, "sf_column")= chr "geometry"
##  - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA
##   ..- attr(*, "names")= chr [1:2] "step" "segment"</code></pre>
</div>
</div>
</section>
<section id="визуализация-1" class="level3">
<h3 class="anchored" data-anchor-id="визуализация-1">Визуализация</h3>
<section id="статическая" class="level4">
<h4 class="anchored" data-anchor-id="статическая">Статическая</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">session_grid</span>(<span class="cn">NULL</span>)</span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">glance</span>(tr,<span class="at">style=</span><span class="st">"mapnik"</span>,<span class="at">plot.lwd=</span><span class="dv">5</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">layout=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">legend=</span><span class="fu">list</span>(<span class="st">"left"</span>,<span class="fu">list</span>(<span class="st">"bottom"</span>,<span class="dv">2</span>)),<span class="at">las=</span><span class="dv">1</span>,<span class="at">dpi=</span><span class="dv">96</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05//ursa10_route.png" class="img-fluid figure-img">{width=1085 height=500 bound}</p>
</figure>
</div>
</div>
</div>
<div class="middle">
<p>Графическое отображение переопределенной под класс объекта функцией <code>plot()</code> средствами библиотеки <code>sp</code> и <code>sf</code> развито слабо…</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tr,<span class="at">lwd=</span><span class="dv">5</span>) <span class="do">## 'sf'-object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05/trplot-sf-1.svg" class="img-fluid figure-img">{width=646.08 bound}</p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">as_Spatial</span>(tr),<span class="at">lwd=</span><span class="dv">5</span>) <span class="do">## 'sp'-object ('SpatialPointsDataFrame')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05/trplot-sp-1.svg" class="img-fluid figure-img">{width=646.08 bound}</p>
</figure>
</div>
</div>
</div>
<p><a href="#importExample">Возвращаясь</a> к ранее загруженным данным</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b.sf[<span class="st">"AFF"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05/scotplot-1.svg" width="646" height="550" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_geometry</span>(b.sf),<span class="at">col=</span>sf<span class="sc">::</span><span class="fu">sf.colors</span>(<span class="dv">12</span>,<span class="at">categorical=</span><span class="cn">TRUE</span>)</span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">border=</span><span class="st">'grey'</span>,<span class="at">axes=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05/scotplotgeom-1.svg" width="646" height="550" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="middle">
<p>Для оформления карт можно использовать функционал других библиотек.</p>
</div>
<section id="ggplot2" class="level5">
<h5 class="anchored" data-anchor-id="ggplot2"><code>ggplot2</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required package: ggplot2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_sf</span>(<span class="at">data=</span>b.sf,<span class="fu">aes</span>(<span class="at">fill=</span>AFF))<span class="sc">+</span></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_sf</span>(<span class="at">crs=</span>sf<span class="sc">::</span><span class="fu">st_crs</span>(<span class="dv">3857</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05/geomsf-1.svg" width="646" height="420" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="tmap" class="level5">
<h5 class="anchored" data-anchor-id="tmap"><code>tmap</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(tmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required package: tmap</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Breaking News: tmap 3.x is retiring. Please test v4, e.g. with
## remotes::install_github('r-tmap/tmap')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## tmap mode set to plotting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>(tm1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(b.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="st">"COUNT"</span>) <span class="sc">+</span> <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">tm_compass</span>(<span class="at">position=</span><span class="fu">c</span>(<span class="st">"left"</span>,<span class="st">"bottom"</span>)) <span class="sc">+</span> <span class="fu">tm_graticules</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05/tmap-plot-1.svg" width="646" height="445" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="для-публикаций" class="level5">
<h5 class="anchored" data-anchor-id="для-публикаций">Для публикаций</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>fileout4 <span class="ot">&lt;-</span> <span class="st">"assets/general/firstmap.png"</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">dirname</span>(fileout4)))</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">dir.create</span>(<span class="fu">dirname</span>(fileout4),<span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(fileout4, <span class="at">res=</span><span class="dv">300</span>, <span class="at">width=</span><span class="dv">1600</span>, <span class="at">height=</span><span class="dv">1200</span>,</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">type=</span><span class="st">"cairo"</span>, <span class="at">pointsize=</span><span class="dv">12</span>, <span class="at">family=</span><span class="st">"sans"</span>)</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tm1)</span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## devSVG 
##      2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(fileout4) <span class="do">## try 'browseURL(fileout4)'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05/57762a52~chunk.png" class="img-fluid figure-img">{width=800 bound}</p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="интерактивная" class="level4">
<h4 class="anchored" data-anchor-id="интерактивная">Интерактивная</h4>
<section id="mapview" class="level5">
<h5 class="anchored" data-anchor-id="mapview"><code>mapview</code></h5>
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> mapview<span class="sc">::</span><span class="fu">mapview</span>(b.sf) <span class="do">## Не отобразится в Jupyter R Notebook.</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">:::</span><span class="fu">widgetize</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="leaflet" class="level5">
<h5 class="anchored" data-anchor-id="leaflet"><code>leaflet</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(leaflet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required package: leaflet</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(b.sf,<span class="dv">4326</span>)</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>b<span class="sc">$</span>category <span class="ot">&lt;-</span> <span class="fu">factor</span>(b<span class="sc">$</span>AFF,<span class="at">ordered=</span><span class="cn">TRUE</span>)</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>fpal <span class="ot">&lt;-</span> <span class="fu">colorFactor</span>(<span class="fu">topo.colors</span>(<span class="dv">5</span>),b<span class="sc">$</span>category)</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>provList <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CartoDB.Positron"</span>,<span class="st">"CartoDB.DarkMatter"</span>,<span class="st">"Esri.OceanBasemap"</span>)</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">leaflet</span>()</span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="fu">c</span>(provList)) m <span class="ot">&lt;-</span> <span class="fu">addProviderTiles</span>(m,providers[[p]],<span class="at">group=</span>p)</span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> m <span class="sc">%&gt;%</span> </span>
<span id="cb264-8"><a href="#cb264-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addPolygons</span>(<span class="at">data=</span>b,<span class="at">fillColor=</span><span class="sc">~</span><span class="fu">fpal</span>(category),<span class="at">fillOpacity=</span><span class="fl">0.5</span></span>
<span id="cb264-9"><a href="#cb264-9" aria-hidden="true" tabindex="-1"></a>              ,<span class="at">weight=</span><span class="fl">1.6</span>,<span class="at">color=</span><span class="sc">~</span><span class="fu">fpal</span>(category),<span class="at">opacity=</span><span class="fl">0.75</span></span>
<span id="cb264-10"><a href="#cb264-10" aria-hidden="true" tabindex="-1"></a>              ,<span class="at">label=</span><span class="sc">~</span><span class="fu">paste0</span>(<span class="st">"AFF: "</span>,AFF,<span class="st">" ("</span>,NAME,<span class="st">")"</span>)</span>
<span id="cb264-11"><a href="#cb264-11" aria-hidden="true" tabindex="-1"></a>              ,<span class="at">popup=</span><span class="sc">~</span><span class="fu">sprintf</span>(<span class="st">"Например, поле COUNT, равное %.1f"</span>,COUNT)</span>
<span id="cb264-12"><a href="#cb264-12" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">%&gt;%</span></span>
<span id="cb264-13"><a href="#cb264-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addMeasure</span>(<span class="st">"topright"</span>,<span class="at">primaryLengthUnit=</span><span class="st">"meters"</span></span>
<span id="cb264-14"><a href="#cb264-14" aria-hidden="true" tabindex="-1"></a>             ,<span class="at">primaryAreaUnit=</span><span class="st">"sqmeters"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb264-15"><a href="#cb264-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addScaleBar</span>(<span class="st">"bottomright"</span></span>
<span id="cb264-16"><a href="#cb264-16" aria-hidden="true" tabindex="-1"></a>             <span class="co"># ,options = scaleBarOptions(imperial=FALSE,maxWidth=400)</span></span>
<span id="cb264-17"><a href="#cb264-17" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">%&gt;%</span></span>
<span id="cb264-18"><a href="#cb264-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addLayersControl</span>(<span class="at">position=</span><span class="st">"topleft"</span></span>
<span id="cb264-19"><a href="#cb264-19" aria-hidden="true" tabindex="-1"></a>                   ,<span class="at">baseGroups=</span><span class="fu">c</span>(provList)</span>
<span id="cb264-20"><a href="#cb264-20" aria-hidden="true" tabindex="-1"></a>                   ,<span class="at">options=</span><span class="fu">layersControlOptions</span>(<span class="at">collapsed=</span><span class="cn">TRUE</span>)</span>
<span id="cb264-21"><a href="#cb264-21" aria-hidden="true" tabindex="-1"></a>                   ) <span class="sc">%&gt;%</span></span>
<span id="cb264-22"><a href="#cb264-22" aria-hidden="true" tabindex="-1"></a>   <span class="fu">addLegend</span>(<span class="st">"bottomright"</span>,<span class="at">pal=</span>fpal,<span class="at">values=</span>b<span class="sc">$</span>category,<span class="at">opacity=</span><span class="fl">0.6</span></span>
<span id="cb264-23"><a href="#cb264-23" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">title=</span><span class="st">"AFF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">:::</span><span class="fu">widgetize</span>(m) <span class="do">## Не отображается в Jupyter R Notebook.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="tmap-1" class="level5">
<h5 class="anchored" data-anchor-id="tmap-1"><code>tmap</code></h5>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## tmap mode set to interactive viewing</code></pre>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>tm <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(b.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="st">"COUNT"</span>)</span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>ursa<span class="sc">:::</span><span class="fu">widgetize</span>(<span class="fu">tmap_leaflet</span>(tm),<span class="at">height=</span><span class="dv">510</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><a href="https://cran.rstudio.com/web/packages/tmap/vignettes/tmap-getstarted.html"><code>tmap</code> “Get Started” vignette</a></p>
<div class="cell">
<iframe src="https://cran.rstudio.com/web/packages/tmap/vignettes/tmap-getstarted.html" width="646.08" height="610" data-external="1">
</iframe>
</div>
</section>
<section id="примеры" class="level5">
<h5 class="anchored" data-anchor-id="примеры">Примеры</h5>
<p><a href="https://bhaskarvk.github.io/user2017.geodataviz/">GeoSpatial Data Visualization in R</a></p>
<div class="cell">
<iframe src="https://bhaskarvk.github.io/user2017.geodataviz/" width="646.08" height="610" data-external="1">
</iframe>
</div>
</section>
</section>
</section>
<section id="экспорт" class="level3 middle">
<h3 class="middle anchored" data-anchor-id="экспорт">Экспорт</h3>
<p>Сохранить пространственные данные в файл</p>
<section id="sprgdal" class="level5">
<h5 class="anchored" data-anchor-id="sprgdal"><code>sp/rgdal</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> loc</span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">coordinates</span>(pt) <span class="ot">&lt;-</span> <span class="er">~</span>x<span class="sc">+</span>y</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">proj4string</span>(pt) <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">proj4string</span>(pt0)</span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">spTransform</span>(pt,<span class="st">"EPSG:4326"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: PROJ support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>fileout1 <span class="ot">&lt;-</span> <span class="st">"afterTrain.geojson"</span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>rgdal<span class="sc">::</span><span class="fu">writeOGR</span>(pt,fileout1,<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">..+"</span>,<span class="st">""</span>,<span class="fu">basename</span>(fileout1)),<span class="at">driver=</span><span class="st">"GeoJSON"</span></span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>                 ,<span class="at">overwrite_layer=</span><span class="cn">TRUE</span>,<span class="at">morphToESRI=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
</div>
</div>
<p>Проверим, появился ли файл:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir</span>(<span class="at">pattern=</span><span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">..+"</span>,<span class="st">""</span>,<span class="fu">basename</span>(fileout1),<span class="st">".*"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "afterTrain.geojson"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(ursa<span class="sc">::</span><span class="fu">glance</span>(fileout1,<span class="at">style=</span><span class="st">"mapnik"</span>,<span class="at">las=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">480</span>,<span class="at">dpi=</span><span class="dv">192</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05//ursa12_glancept.png" class="img-fluid figure-img">{width=203 bound}</p>
</figure>
</div>
</div>
</div>
</section>
<section id="sf-5" class="level5">
<h5 class="anchored" data-anchor-id="sf-5"><code>sf</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>b.sf <span class="ot">&lt;-</span> b.sf[,<span class="fu">c</span>(<span class="st">"NAME"</span>,<span class="st">"COUNT"</span>)]</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>b.sf<span class="sc">$</span><span class="st">'категория'</span> <span class="ot">&lt;-</span> b<span class="sc">$</span>category</span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>b.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(b.sf,<span class="dv">3857</span>)</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>fileout2 <span class="ot">&lt;-</span> <span class="st">"scotland.sqlite"</span></span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(b.sf,<span class="at">dsn=</span>fileout2,<span class="at">layer=</span><span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">..+"</span>,<span class="st">""</span>,<span class="fu">basename</span>(fileout2))</span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">driver=</span><span class="st">"SQLite"</span>,<span class="at">layer_options=</span><span class="fu">c</span>(<span class="st">"LAUNDER=NO"</span>),<span class="at">quiet=</span><span class="cn">TRUE</span></span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">delete_layer=</span><span class="fu">file.exists</span>(fileout2),<span class="at">delete_dsn=</span><span class="fu">file.exists</span>(fileout2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir</span>(<span class="at">pattern=</span><span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">..+"</span>,<span class="st">""</span>,<span class="fu">basename</span>(fileout2),<span class="st">".*"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "scotland.sqlite"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(ursa<span class="sc">::</span><span class="fu">glance</span>(fileout2,<span class="at">resetGrid=</span><span class="cn">TRUE</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">style=</span><span class="st">"mapnik"</span>,<span class="at">las=</span><span class="dv">1</span>,<span class="at">dpi=</span><span class="dv">192</span>,<span class="at">size=</span><span class="dv">480</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05//ursa14_glancescot.png" class="img-fluid figure-img">{width=377 bound}</p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>fileout3 <span class="ot">&lt;-</span> <span class="st">"track.shp"</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(tr,<span class="at">dsn=</span>fileout3,<span class="at">layer=</span><span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">..+"</span>,<span class="st">""</span>,<span class="fu">basename</span>(fileout2))</span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">driver=</span><span class="st">"ESRI Shapefile"</span>,<span class="at">quiet=</span><span class="cn">TRUE</span></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>            ,<span class="at">delete_layer=</span><span class="fu">file.exists</span>(fileout3),<span class="at">delete_dsn=</span><span class="fu">file.exists</span>(fileout3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir</span>(<span class="at">pattern=</span><span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">..+"</span>,<span class="st">""</span>,<span class="fu">basename</span>(fileout3),<span class="st">".*"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "track.dbf" "track.prj" "track.shp" "track.shx"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(ursa<span class="sc">::</span><span class="fu">glance</span>(fileout3,<span class="at">resetGrid=</span><span class="cn">TRUE</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">style=</span><span class="st">"mapnik"</span>,<span class="at">las=</span><span class="dv">1</span>,<span class="at">dpi=</span><span class="dv">192</span>,<span class="at">size=</span><span class="dv">480</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05//ursa16_glancetrack.png" class="img-fluid figure-img">{width=297 bound}</p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="рисование" class="level3">
<h3 class="anchored" data-anchor-id="рисование">Рисование</h3>
<p>Этот раздел предлагается пройти самостоятельно</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>track <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_linestring</span>(<span class="fu">cbind</span>(loc<span class="sc">$</span>x,loc<span class="sc">$</span>y))</span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>track <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sf</span>(<span class="fu">data.frame</span>(<span class="at">desc=</span><span class="st">"walk"</span></span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>                  ,sf<span class="sc">::</span><span class="fu">st_sfc</span>(track,<span class="at">crs=</span>sp<span class="sc">::</span><span class="fu">proj4string</span>(pt0))))</span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a>paint <span class="ot">&lt;-</span> mapview<span class="sc">::</span><span class="fu">viewExtent</span>(track,<span class="at">alpha=</span><span class="fl">0.01</span>) <span class="sc">%&gt;%</span> mapedit<span class="sc">::</span><span class="fu">editMap</span>(<span class="st">"track"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: leaflet.extras</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: miniUI</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required package: shiny</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## 
## Listening on http://127.0.0.1:4338</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: `select_()` was deprecated in dplyr 0.7.0.
## i Please use `select()` instead.
## i The deprecated feature was likely used in the mapedit package.
##   Please report the issue at &lt;https://github.com/r-spatial/mapedit/issues&gt;.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(paint<span class="sc">$</span>finished)) {</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a>   result <span class="ot">&lt;-</span> paint<span class="sc">$</span>finished</span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a>   mapview<span class="sc">::</span><span class="fu">mapview</span>(result)</span>
<span id="cb291-5"><a href="#cb291-5" aria-hidden="true" tabindex="-1"></a>   ursa<span class="sc">::</span><span class="fu">session_grid</span>(<span class="cn">NULL</span>)</span>
<span id="cb291-6"><a href="#cb291-6" aria-hidden="true" tabindex="-1"></a>   ursa<span class="sc">::</span><span class="fu">glance</span>(result,<span class="at">style=</span><span class="st">"mapnik"</span>)</span>
<span id="cb291-7"><a href="#cb291-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p class="centered-image"><img src="assets/lesson05//ursa18_mapedit.png" class="img-fluid figure-img" width="586"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="дополнительно-по-r" class="level2">
<h2 class="anchored" data-anchor-id="дополнительно-по-r">Дополнительно по R</h2>
<section id="воспроизводимость" class="level3">
<h3 class="anchored" data-anchor-id="воспроизводимость">Воспроизво­ди­мость</h3>
<p>Ниже приведены фрагмента кода, которые не были выполнены при составлении программы занятия. Их предлагается выполнить самостоятельно. Также необходимо <a href="#pandoc">установленный Pandoc</a>.</p>
<p>Содержимое занятия сгенерировано из файла <code>lesson04.R</code>. Загрузим его, переименовав:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a>sfile <span class="ot">&lt;-</span> <span class="st">"lesson05.R"</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>rfile <span class="ot">&lt;-</span> <span class="st">"lesson05-reproduced.R"</span></span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">file.exists</span>(sfile))</span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">file.copy</span>(sfile,rfile,<span class="at">overwrite=</span><span class="cn">TRUE</span>,<span class="at">copy.date=</span><span class="cn">TRUE</span>)</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span></span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(<span class="fu">file.path</span>(<span class="st">"https://nplatonov.github.io/sevinGIS"</span>,sfile)</span>
<span id="cb292-8"><a href="#cb292-8" aria-hidden="true" tabindex="-1"></a>                   ,rfile)</span>
<span id="cb292-9"><a href="#cb292-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- file.copy("main.R","lesson.R",overwrite=TRUE,copy.date=TRUE) -->
<p>На основе этого файла создадим markdown-документ:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>mdfile <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">spin</span>(rfile,<span class="at">knit=</span><span class="cn">FALSE</span>)</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>mdfile</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Затем из markdown-документа сформируем html-документ:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (rmarkdown<span class="sc">::</span><span class="fu">pandoc_available</span>()) {</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>   htmlfile <span class="ot">&lt;-</span> rmarkdown<span class="sc">::</span><span class="fu">render</span>(mdfile,<span class="at">output_format=</span><span class="st">"html_document"</span></span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>                                ,<span class="at">output_options=</span><span class="fu">list</span>(<span class="at">toc=</span><span class="cn">TRUE</span>))</span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="fu">basename</span>(htmlfile))</span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Полученный html-документ можно открыть в браузере.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> ((rmarkdown<span class="sc">::</span><span class="fu">pandoc_available</span>())<span class="sc">&amp;&amp;</span>(<span class="fu">file.exists</span>(htmlfile))) </span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">browseURL</span>(<span class="fu">basename</span>(htmlfile))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>И можно скопировать/переименовать/удалить</p>
<section id="параметры-сессии" class="level4">
<h4 class="anchored" data-anchor-id="параметры-сессии">Параметры сессии</h4>
<div class="oversize">
<div class="cell">
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## R version 4.3.2 Patched (2024-01-28 r85845 ucrt)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 19045)
## 
## Matrix products: default
## 
## 
## locale:
## [1] LC_COLLATE=English_United Kingdom.utf8 
## [2] LC_CTYPE=Russian_Russia.1251           
## [3] LC_MONETARY=English_United Kingdom.utf8
## [4] LC_NUMERIC=C                           
## [5] LC_TIME=English_United Kingdom.utf8    
## system code page: 65001
## 
## time zone: Europe/Moscow
## tzcode source: internal
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] shiny_1.8.0   leaflet_2.2.1 tmap_3.3-4    ggplot2_3.4.4
## 
## loaded via a namespace (and not attached):
##  [1] tidyselect_1.2.0        viridisLite_0.4.2       dplyr_1.1.4            
##  [4] farver_2.1.1            fastmap_1.1.1           mapview_2.11.2         
##  [7] promises_1.2.1          XML_3.99-0.16.1         digest_0.6.34          
## [10] mime_0.12               lifecycle_1.0.4         sf_1.0-15              
## [13] ellipsis_0.3.2          terra_1.7-71            magrittr_2.0.3         
## [16] compiler_4.3.2          sass_0.4.8              rlang_1.1.3            
## [19] tools_4.3.2             leafpop_0.1.0           utf8_1.2.4             
## [22] yaml_2.3.8              knitr_1.45              brew_1.0-10            
## [25] labeling_0.4.3          htmlwidgets_1.6.4       sp_2.1-3               
## [28] classInt_0.4-10         RColorBrewer_1.1-3      abind_1.4-5            
## [31] KernSmooth_2.23-22      miniUI_0.1.1.1          withr_3.0.0            
## [34] leafsync_0.1.0          grid_4.3.2              stats4_4.3.2           
## [37] ursa_3.11.1             fansi_1.0.6             mapedit_0.6.0          
## [40] xtable_1.8-4            e1071_1.7-14            leafem_0.2.3           
## [43] colorspace_2.1-0        scales_1.3.0            dichromat_2.0-0.1      
## [46] cli_3.6.2               rmarkdown_2.25          generics_0.1.3         
## [49] tmaptools_3.1-1         cachem_1.0.8            DBI_1.2.0              
## [52] proxy_0.4-27            stars_0.6-4             parallel_4.3.2         
## [55] s2_1.1.6                base64enc_0.1-3         vctrs_0.6.5            
## [58] jsonlite_1.8.8          geojsonsf_2.0.3         systemfonts_1.0.5      
## [61] jpeg_0.1-10             crosstalk_1.2.1         jquerylib_0.1.4        
## [64] units_0.8-5             rgdal_1.6-7             glue_1.7.0             
## [67] lwgeom_0.2-13           codetools_0.2-19        leaflet.providers_2.0.0
## [70] gtable_0.3.4            later_1.3.2             raster_3.6-26          
## [73] munsell_0.5.0           tibble_3.2.1            pillar_1.9.0           
## [76] htmltools_0.5.7         satellite_1.0.4         R6_2.5.1               
## [79] tcltk_4.3.2             wk_0.9.1                evaluate_0.23          
## [82] lattice_0.22-5          highr_0.10              leaflet.extras_1.0.0   
## [85] png_0.1-8               memoise_2.0.1           bslib_0.6.1            
## [88] httpuv_1.6.14           class_7.3-22            uuid_1.2-0             
## [91] Rcpp_1.0.12             svglite_2.1.3           xfun_0.41              
## [94] pkgconfig_2.0.3</code></pre>
</div>
</div>
</div>
</section>
</section>
<section id="узнать-больше-об-r" class="level3">
<h3 class="anchored" data-anchor-id="узнать-больше-об-r">Узнать больше об R</h3>
<ul>
<li><p><a href="https://www.r-bloggers.com/">R-Bloggers</a> – современные тенденции R</p></li>
<li><p>R’s <a href="https://cran.rstudio.com/web/views/Spatial.html">Spatial</a> and <a href="https://cran.rstudio.com/web/views/SpatioTemporal.html">SpatioTemporal</a> Task Views</p></li>
<li><p><a href="https://www.r-spatial.org/">R-Spatial</a> – веб-сайт и блог для интересующихся использованием R для анализа пространственных и пространственно-временных данных</p></li>
<li><p><a href="https://geocompr.github.io">Geocomputation with R</a> - book and relative</p></li>
<li><p><a href="https://stackoverflow.com/feeds/tag/r">Stackoverflow</a> с тегом #R.</p></li>
<li><p><a href="https://gis.stackexchange.com/questions">Stackexchange</a> о ГИС, в т.ч. с использованием R.</p></li>
<li><p>Package’s vignettes – обобщенное знакомство с библиотекой. Обычно содержат воспроизводимый код.</p></li>
</ul>
<section id="книги" class="level4">
<h4 class="anchored" data-anchor-id="книги">Книги</h4>
<ul>
<li><a href="https://bookdown.org/michael_bcalles/gis-crash-course-in-r/">A Crash Course in Geographic Information Systems (GIS) using R</a></li>
</ul>
</section>
</section>
</section>
<section id="section" class="level1 thankyou centre unlisted unnumbered" data-visibility="counted">
<h1 class="thankyou centre unlisted unnumbered" data-visibility="counted">&nbsp;</h1>
<div class="small bottom">
<p>Данные после занятия остались на диске. Если не нужны, выполнить следующее:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">dir</span>(<span class="at">pattern=</span><span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">..+"</span>,<span class="st">""</span>,<span class="fu">basename</span>(fileout1),<span class="st">".*"</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">dir</span>(<span class="at">pattern=</span><span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">..+"</span>,<span class="st">""</span>,<span class="fu">basename</span>(fileout2),<span class="st">".*"</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">dir</span>(<span class="at">pattern=</span><span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">..+"</span>,<span class="st">""</span>,<span class="fu">basename</span>(fileout3),<span class="st">".*"</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] TRUE TRUE TRUE TRUE</code></pre>
</div>
</div>
</div>
<div class="cell">
<style type="text/css">
:root {
   --pointsize: 20pt;
   --sidebar-pointsize: 78%;
   --sidebar: 25%;
}
</style>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
