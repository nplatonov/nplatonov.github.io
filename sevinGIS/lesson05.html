<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>ГИС 05</title>

<script src="https://nplatonov.github.io/site_libs/header-attrs-2.25/header-attrs.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>

<style type="text/css">
  p.abstract{
    text-align: center;
    font-weight: bold;
  }
  div.abstract{
    margin: auto;
    width: 90%;
  }
</style>



<link rel="stylesheet" href="https://nplatonov.github.io/site_libs/common.css" type="text/css" />
<link rel="stylesheet" href="https://nplatonov.github.io/site_libs/html_vignette.css" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Возможности R для работы с пространственными данными</h1>
<h3 class="subtitle">ГИС технологии в биологических исследованиях</h3>
<h4 class="author">Никита Платонов</h4>
<address class="author_afil">
с.н.с. ИПЭЭ РАН</address><br><h4 class="date"><span class="what">Занятие 05</span> <span class="when"> <span class="updated">Обновлено: 2024-02-28 19:44</span></span></h4>
<div class="abstract">
<p class="abstract">Abstract</p>
Демонстрация основ работы с интерфейсом командной строки в R, позволяющей создавать скрипты и получать воспроизводимые результаты. Показано, как пространственные векторные и растровые данные могут попасть в R и как они выглядят в R. С возможностью сделать обработку, анализ и визуализацию пространственных данных.
</div>



<div id="основы-r" class="section level2">
<h2>Основы R</h2>
<div id="установка-r" class="section level3">
<h3>Установка R</h3>
<div id="oперационные-системы" class="section level4">
<h4>Oперационные системы</h4>
<p>Не для всех операционных систем есть скомпилированные модули (ядро R, библиотеки). В таком случае модули компилируются, и на это уходит какое-то время. Поэтому если ОС не OS Windows, то этот этап нужно пройти заранее.</p>
</div>
<div id="базовый-r" class="section level4">
<h4>Базовый R</h4>
<p>Установить или обновить R, например, <a href="https://cran.rstudio.org/">отсюда</a>.</p>
<p>Актуальная версия 4.3.2. Нативные пайпы с версии 4.1. Пакеты не обновляются для старых версий R.</p>
<p>При переходе с версии 3.6 на версию 4.0 пришлось переустановить все пакеты (библиотеки, модули).</p>
</div>
<div id="библиотеки" class="section level4">
<h4>Библиотеки</h4>
<div class="scrollable">
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>pkgList <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sf&quot;</span>,<span class="st">&quot;terra&quot;</span>,<span class="st">&quot;raster&quot;</span>,<span class="st">&quot;ggplot2&quot;</span>,<span class="st">&quot;leaflet&quot;</span>,<span class="st">&quot;mapview&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>            ,<span class="st">&quot;mapedit&quot;</span>,<span class="st">&quot;knitr&quot;</span>,<span class="st">&quot;rmarkdown&quot;</span>,<span class="st">&quot;gdalUtils&quot;</span>,<span class="st">&quot;tmap&quot;</span>,<span class="st">&quot;ursa&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>whoisready <span class="ot">&lt;-</span> <span class="fu">sapply</span>(pkgList,<span class="cf">function</span>(pkg) {</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">requireNamespace</span>(pkg))</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>   <span class="fu">install.packages</span>(pkg,<span class="at">repos=</span><span class="st">&quot;https://cran.rstudio.com&quot;</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>   <span class="fu">requireNamespace</span>(pkg)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Loading required namespace: sf</code></pre>
<pre><code>## Loading required namespace: terra</code></pre>
<pre><code>## Loading required namespace: raster</code></pre>
<pre><code>## Loading required namespace: ggplot2</code></pre>
<pre><code>## Loading required namespace: leaflet</code></pre>
<pre><code>## Loading required namespace: mapview</code></pre>
<pre><code>## Loading required namespace: mapedit</code></pre>
<pre><code>## Loading required namespace: gdalUtils</code></pre>
<pre><code>## Please note that rgdal will be retired during October 2023,
## plan transition to sf/stars/terra functions using GDAL and PROJ
## at your earliest convenience.
## See https://r-spatial.org/r/2023/05/15/evolution4.html and https://github.com/r-spatial/evolution
## rgdal: version: 1.6-7, (SVN revision 1203)
## Geospatial Data Abstraction Library extensions to R successfully loaded
## Loaded GDAL runtime: GDAL 3.6.2, released 2023/01/02
## Path to GDAL shared files: C:/Software/Rlibs43/rgdal/gdal
##  GDAL does not use iconv for recoding strings.
## GDAL binary built with GEOS: TRUE 
## Loaded PROJ runtime: Rel. 9.2.0, March 1st, 2023, [PJ_VERSION: 920]
## Path to PROJ shared files: C:/Software/Rlibs43/rgdal/proj
## PROJ CDN enabled: FALSE
## Linking to sp version:1.6-1
## To mute warnings of possible GDAL/OSR exportToProj4() degradation,
## use options(&quot;rgdal_show_exportToProj4_warnings&quot;=&quot;none&quot;) before loading sp or rgdal.</code></pre>
<pre><code>## Loading required namespace: tmap</code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>whoisready</span></code></pre></div>
<pre><code>##        sf     terra    raster   ggplot2   leaflet   mapview   mapedit     knitr rmarkdown gdalUtils 
##      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE      TRUE 
##      tmap      ursa 
##      TRUE      TRUE</code></pre>
<p>Если отображается <code>TRUE</code> для всех библиотек, то подготовка к занятию осуществлена успешно.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&#39;Everything is ready?&#39;</span><span class="ot">=</span><span class="fu">all</span>(whoisready))</span></code></pre></div>
<pre><code>## Everything is ready? 
##                 TRUE</code></pre>
<p>Если где-то выскочило <code>FALSE</code> (например, для библиотеки “foo”), то можно попробовать его установить заново функцией <code>install.packages("foo")</code>.</p>
</div>
<div id="дополнительное-по" class="section level4">
<h4>Дополнительное ПО</h4>
<div id="rstudio-ide" class="section level5 middle center">
<h5 class="middle center">RStudio IDE</h5>
<p><sup>факультативно</sup></p>
</div>
<div id="pandoc" class="section level5">
<h5>Pandoc</h5>
<div class="font90">
<p>Pandoc необходим для создания воспроизводимого результата. Этот шаг опциональный, и может быть пропущен, но в этом случае на занятии будет пропущен раздел по <a href="#report1">публикации результатов</a>.</p>
<p><a href="https://pandoc.org/installing.html">Ссылка</a> на страницу для скачивания. Для пользователей Windows достаточно перейти к <a href="https://github.com/jgm/pandoc/releases/latest">скачиванию актуального релиза</a>, и выбрать либо установщик (<code>*.msi</code>), либо архив (<code>*.zip</code>). Запомнить путь, куда произведена установка и где находится файл <code>pandoc.exe</code> и добавить этот путь в переменную окружения <code>%PATH%</code>, например: WindowsKey+Q, ввести “Переменные среды/Environment Variables”, попасть в окошко “Свойства Системы/System Properties”, нажать на кнопку “Переменные среды/Environment Variables” и отредактировать пользовательскую или системную переменную PATH, добавив путь к <code>pandoc.exe</code>.</p>
<p>Чтобы проверить правильно ли установлен Pandoc, в новой R-сессии:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">pandoc_available</span>()</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
</div>
<div id="jupyter" class="section level5">
<h5>Jupyter</h5>
<p>Jupyter Notebook для работы с R кодом в браузере.</p>
<ol style="list-style-type: decimal">
<li><p><a href="https://docs.conda.io/en/latest/miniconda.html">Загрузить</a> и установить менеджер Miniconda (проверено на Windows 64bit Python 3.7).</p></li>
<li><p>Запустить <code>conda</code> (На Windows попробовать WinKey+Q и начать вводить “Anaconda”)</p></li>
<li><p>Последовательно выполнить команды (в среде Conda, не в среде R):</p></li>
</ol>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Команда</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>conda install jupyter</code></td>
<td>установка Jupyter Notebook</td>
</tr>
<tr class="even">
<td><code>conda install -c r r-recommended r-irkernel</code></td>
<td>Установка R, базовых библиотек и библиотеки для использования R в Jupyter Notebook</td>
</tr>
<tr class="odd">
<td><code>conda install -c conda-forge jupytext</code></td>
<td>Установка преобразователя кода R в формат Jupyter Notebook</td>
</tr>
</tbody>
</table>
<!--
Предварительно скачайте [`main.R`](./main.R) или только код [`codeOnly.R`](./codeOnly.R), если будете использовать на занятии Jupyter Notebook. Если проблема с кодировкой остается, попробуйте взять 
[`codeOnly1251.R`](./codeOnly1251.R)
Предупреждение: описательный текст (markdown) местами не отформатирован, в частности, не будут отображаться таблицы; также не будут отображаться html-виджеты.
-->
</div>
</div>
<div id="как-использовать-материал" class="section level4">
<h4>Как использовать материал</h4>
<p>Предполагается, что во время занятий будет использоваться интерактивный режим: либо простая среда R (R, запущенный без команд), либо графическая среда R GUI, либо RStudio.</p>
<p>Блок исходного кода выделен моноширинным шрифтом с подсветкой синтаксиса, после которого либо приведен текстовый вывод (более бледный цвет шрифта), либо графический вывод (рисунок, таблица). В среде R нужно вводить код из верхнего блока и сравнивать полученный вывод с содержимым нижнего блока.</p>
<p>К примеру, ниже приведен пример вывода числа <span class="math inline">\(\pi\)</span>: сверху – команда, снизу – выход.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>pi</span></code></pre></div>
<pre><code>## [1] 3.141593</code></pre>
</div>
</div>
<div id="начало-работы" class="section level3">
<h3>Начало работы</h3>
<p>Текущий путь, где мы находимся. Здесь появятся файлы, созданные в процессе занятия.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;C:/platt/education/202204-GIS&quot;</code></pre>
<p>Его можно поменять через меню RGui/RStudio или с помощью <code>setwd()</code>.</p>
<p>Зафиксируем генератор псевдослучайных чисел на определенную последовательность</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">353</span>)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1]  2  7 10  6  4  1  3  9  5  8</code></pre>
<div class="font90">
<p>Команда для проверки кириллицы:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(<span class="st">&#39;Здесь кириллица?&#39;</span><span class="ot">=</span><span class="st">&quot;Да!&quot;</span>),<span class="at">quote=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Здесь кириллица? 
##              Да!</code></pre>
<p>Если вывод не читаемый, то возможные пути решения:</p>
<p>1. Задать кириллицу для символьной локали:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="cf">if</span> (.Platform<span class="sc">$</span>OS.type<span class="sc">==</span><span class="st">&quot;windows&quot;</span>)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>   <span class="fu">Sys.setlocale</span>(<span class="st">&quot;LC_CTYPE&quot;</span>,<span class="st">&quot;Russian&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in Sys.setlocale(&quot;LC_CTYPE&quot;, &quot;Russian&quot;): using locale code page other than 65001 (&quot;UTF-8&quot;) may
## cause problems</code></pre>
<p>2. Если скрипты подключаются через <code>source()</code>, то можно настроить запуск R через конфигурационные файлы. Например, скачать <a href="./.Rprofile">.Rprofile</a>, разместить в рабочей директории, перегрузить R. Файл имеет следующую структуру:</p>
<pre><code> local({
    options(encoding=&quot;UTF-8&quot;)
    Sys.setlocale(&quot;LC_CTYPE&quot;,&quot;Russian&quot;)
 })</code></pre>
<p>3. Если скрипт <code>bar.R</code> с кириллицей в кодировке UTF-8 запускается из командной строки, то использовать следующие параметры запуска.</p>
<pre><code> R --encoding UTF-8 -f bar.R</code></pre>
</div>
</div>
<div id="представление-данных" class="section level3">
<h3>Представление данных</h3>
<div id="простые-типы" class="section level4">
<h4>Простые типы</h4>
<div id="числа-и-имена-значений" class="section level5">
<h5>Числа и имена значений</h5>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>(a1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">7</span>))</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6 7</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">str</span>(a1)</span></code></pre></div>
<pre><code>##  int [1:7] 1 2 3 4 5 6 7</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> a1</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="fu">names</span>(a2) <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>()<span class="sc">+</span>a1<span class="dv">-1</span>,<span class="st">&quot;%A&quot;</span>)</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>a2</span></code></pre></div>
<pre><code>## Wednesday  Thursday    Friday  Saturday    Sunday    Monday   Tuesday 
##         1         2         3         4         5         6         7</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">str</span>(a2)</span></code></pre></div>
<pre><code>##  Named int [1:7] 1 2 3 4 5 6 7
##  - attr(*, &quot;names&quot;)= chr [1:7] &quot;Wednesday&quot; &quot;Thursday&quot; &quot;Friday&quot; &quot;Saturday&quot; ...</code></pre>
</div>
<div id="целые-числа-числа-с-плавающей-точкой" class="section level5">
<h5>Целые числа, числа с плавающей точкой</h5>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="fu">str</span>(a2<span class="sc">+</span><span class="dv">0</span><span class="dt">L</span>)</span></code></pre></div>
<pre><code>##  Named int [1:7] 1 2 3 4 5 6 7
##  - attr(*, &quot;names&quot;)= chr [1:7] &quot;Wednesday&quot; &quot;Thursday&quot; &quot;Friday&quot; &quot;Saturday&quot; ...</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="fu">str</span>(a2<span class="sc">+</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>##  Named num [1:7] 1 2 3 4 5 6 7
##  - attr(*, &quot;names&quot;)= chr [1:7] &quot;Wednesday&quot; &quot;Thursday&quot; &quot;Friday&quot; &quot;Saturday&quot; ...</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="fu">typeof</span>(a2<span class="sc">+</span><span class="dv">0</span><span class="dt">L</span>)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="fu">typeof</span>(a2<span class="sc">+</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
</div>
<div id="логические-значения-строки" class="section level5">
<h5>Логические значения, строки</h5>
<h5 class="toc-ignore unnumbered unlisted">
Логические значения
</h5>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>(a3 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">FALSE</span>),<span class="fu">length</span>(a2),<span class="at">replace=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## [1] FALSE FALSE  TRUE FALSE FALSE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="fu">class</span>(a3)</span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="fu">str</span>(a3)</span></code></pre></div>
<pre><code>##  logi [1:7] FALSE FALSE TRUE FALSE FALSE TRUE ...</code></pre>
<h5 class="toc-ignore unnumbered unlisted">
Строки
</h5>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a>(a4 <span class="ot">&lt;-</span> <span class="fu">names</span>(a2))</span></code></pre></div>
<pre><code>## [1] &quot;Wednesday&quot; &quot;Thursday&quot;  &quot;Friday&quot;    &quot;Saturday&quot;  &quot;Sunday&quot;    &quot;Monday&quot;    &quot;Tuesday&quot;</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="fu">class</span>(a4)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="fu">str</span>(a4)</span></code></pre></div>
<pre><code>##  chr [1:7] &quot;Wednesday&quot; &quot;Thursday&quot; &quot;Friday&quot; &quot;Saturday&quot; &quot;Sunday&quot; &quot;Monday&quot; &quot;Tuesday&quot;</code></pre>
</div>
</div>
<div id="составные-типы" class="section level4">
<h4>Составные типы</h4>
<div id="списки-одинаковой-длины" class="section level5">
<h5>Списки одинаковой длины</h5>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>(a5 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">num=</span>a1[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>)],<span class="at">char=</span>a4[<span class="sc">-</span><span class="dv">2</span>]))</span></code></pre></div>
<pre><code>## $num
## [1] 1 3 4 5 6 7
## 
## $char
## [1] &quot;Wednesday&quot; &quot;Friday&quot;    &quot;Saturday&quot;  &quot;Sunday&quot;    &quot;Monday&quot;    &quot;Tuesday&quot;</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="fu">str</span>(a5)</span></code></pre></div>
<pre><code>## List of 2
##  $ num : int [1:6] 1 3 4 5 6 7
##  $ char: chr [1:6] &quot;Wednesday&quot; &quot;Friday&quot; &quot;Saturday&quot; &quot;Sunday&quot; ...</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a><span class="fu">class</span>(a5)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="fu">length</span>(a5)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="fu">sapply</span>(a5,length)</span></code></pre></div>
<pre><code>##  num char 
##    6    6</code></pre>
</div>
<div id="таблицы" class="section level5">
<h5>Таблицы</h5>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a>(a6 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">num=</span>a1[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>)],<span class="at">char=</span>a4[<span class="sc">-</span><span class="dv">2</span>]))</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">num</th>
<th align="left">char</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Wednesday</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">Friday</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">Saturday</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="left">Sunday</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="left">Monday</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="left">Tuesday</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="fu">str</span>(a6)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    6 obs. of  2 variables:
##  $ num : int  1 3 4 5 6 7
##  $ char: chr  &quot;Wednesday&quot; &quot;Friday&quot; &quot;Saturday&quot; &quot;Sunday&quot; ...</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="fu">class</span>(a6)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="fu">dim</span>(a6)</span></code></pre></div>
<pre><code>## [1] 6 2</code></pre>
</div>
<div id="списки-различной-длины" class="section level5">
<h5>Списки различной длины</h5>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a>(a7 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">x=</span><span class="fu">sample</span>(a1,<span class="dv">3</span>),<span class="at">y=</span><span class="fu">sample</span>(a1,<span class="dv">5</span>)))</span></code></pre></div>
<pre><code>## $x
## [1] 7 2 3
## 
## $y
## [1] 7 3 2 4 6</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="fu">str</span>(a7)</span></code></pre></div>
<pre><code>## List of 2
##  $ x: int [1:3] 7 2 3
##  $ y: int [1:5] 7 3 2 4 6</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a><span class="fu">class</span>(a7)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a><span class="fu">length</span>(a7)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="fu">sapply</span>(a7,length)</span></code></pre></div>
<pre><code>## x y 
## 3 5</code></pre>
</div>
</div>
<div id="матрицы" class="section level4">
<h4>Матрицы</h4>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a>(a11 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">24</span>)),<span class="at">ncol=</span><span class="dv">4</span>,<span class="at">nrow=</span><span class="dv">3</span>))</span></code></pre></div>
<pre><code>## Warning in matrix(sample(seq(24)), ncol = 4, nrow = 3): data length differs from size of matrix: [24 != 3
## x 4]</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]   20   24    6   17
## [2,]    8   23    2   13
## [3,]   22    1   21   10</code></pre>
<p>Размерность массива</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" tabindex="-1"></a><span class="fu">dim</span>(a11)</span></code></pre></div>
<pre><code>## [1] 3 4</code></pre>
<p>Структура данных массива</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" tabindex="-1"></a><span class="fu">str</span>(a11)</span></code></pre></div>
<pre><code>##  int [1:3, 1:4] 20 8 22 24 23 1 6 2 21 17 ...</code></pre>
</div>
<div id="массивы" class="section level4">
<h4>Массивы</h4>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" tabindex="-1"></a>(a8 <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">sample</span>(<span class="dv">24</span>),<span class="at">dim=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## , , 1
## 
##      [,1] [,2] [,3] [,4]
## [1,]   10    4    2   17
## [2,]    9    5   16   19
## [3,]   14   15   18   22
## 
## , , 2
## 
##      [,1] [,2] [,3] [,4]
## [1,]   20   23    7   21
## [2,]   11    6   13   12
## [3,]    3    8   24    1</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" tabindex="-1"></a><span class="fu">str</span>(a8)</span></code></pre></div>
<pre><code>##  int [1:3, 1:4, 1:2] 10 9 14 4 5 15 2 16 18 17 ...</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" tabindex="-1"></a><span class="fu">class</span>(a8)</span></code></pre></div>
<pre><code>## [1] &quot;array&quot;</code></pre>
</div>
<div id="факторы" class="section level4">
<h4>Факторы</h4>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" tabindex="-1"></a>(a9 <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(a4),<span class="at">levels=</span>a4))</span></code></pre></div>
<pre><code>## [1] Thursday  Wednesday Friday    Sunday    Saturday  Tuesday   Monday   
## Levels: Wednesday Thursday Friday Saturday Sunday Monday Tuesday</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" tabindex="-1"></a><span class="fu">str</span>(a9)</span></code></pre></div>
<pre><code>##  Factor w/ 7 levels &quot;Wednesday&quot;,&quot;Thursday&quot;,..: 2 1 3 5 4 7 6</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" tabindex="-1"></a><span class="fu">class</span>(a9)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" tabindex="-1"></a>(a10 <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(a4),<span class="at">levels=</span>a4,<span class="at">ordered=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## [1] Saturday  Sunday    Tuesday   Wednesday Friday    Monday    Thursday 
## Levels: Wednesday &lt; Thursday &lt; Friday &lt; Saturday &lt; Sunday &lt; Monday &lt; Tuesday</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" tabindex="-1"></a><span class="fu">str</span>(a10)</span></code></pre></div>
<pre><code>##  Ord.factor w/ 7 levels &quot;Wednesday&quot;&lt;&quot;Thursday&quot;&lt;..: 4 5 7 1 3 6 2</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" tabindex="-1"></a><span class="fu">class</span>(a10)</span></code></pre></div>
<pre><code>## [1] &quot;ordered&quot; &quot;factor&quot;</code></pre>
</div>
</div>
</div>
<div id="r-как-гис" class="section level2">
<h2>R как ГИС?</h2>
<ul>
<li><p>R устроен так, что можно реализовать сложные структуры данных, со средствами их инспектирования, что вполне применимо для пространственных данных и их метаданных</p></li>
<li><p>В R есть инструменты для анализа данных</p></li>
<li><p>В R есть инструменты для визуализации</p></li>
<li><p><em>Как особенность развития до текущего момента</em>: воспроизводимость реализована лучше интерактивности</p></li>
<li><p>В R уже многое сделано по манипуляции с пространственными данными: пользователю не обязательно быть разработчиком</p></li>
</ul>
<div id="средства-визуализации" class="section level3">
<h3>Средства визуализации</h3>
<p>Базовые средства R для визуализации (библиотека <code>graphics</code>) пространственных данных:</p>
<ul>
<li><p><code>points()</code> – отображение точек (геометрия POINT)</p></li>
<li><p><code>lines()</code>, <code>segments()</code>, <code>contour()</code> – отображение линий (геометрия LINESTRING)</p></li>
<li><p><code>polygon()</code>, <code>polypath()</code> – отображение полигонов (геометрия POLYGON)</p></li>
<li><p><code>image()</code>, <code>rasterImage()</code> – растровые изображения</p></li>
<li><p><code>text()</code>, <code>legend()</code> – аннотациии</p></li>
<li><p><code>axis()</code>, <code>mtext()</code> – рамочное оформление</p></li>
</ul>
<div id="пример-путешествия-мимочерез-спб" class="section level4">
<h4>Пример путешествия мимо/через Спб</h4>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb110-2"><a href="#cb110-2" tabindex="-1"></a>seqx <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">20</span>,<span class="dv">40</span>,<span class="at">by=</span><span class="dv">5</span>)</span>
<span id="cb110-3"><a href="#cb110-3" tabindex="-1"></a>seqy <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">55</span>,<span class="dv">65</span>,<span class="at">by=</span><span class="dv">2</span>)</span>
<span id="cb110-4"><a href="#cb110-4" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">runif</span>(n,<span class="at">min=</span><span class="fu">min</span>(seqx),<span class="at">max=</span><span class="fu">max</span>(seqx)))</span>
<span id="cb110-5"><a href="#cb110-5" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">runif</span>(n,<span class="at">min=</span><span class="fu">min</span>(seqy),<span class="at">max=</span><span class="fu">max</span>(seqy)))</span></code></pre></div>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" tabindex="-1"></a><span class="fu">plot</span>(x,y,<span class="at">type=</span><span class="st">&quot;n&quot;</span>,<span class="at">asp=</span><span class="cn">NA</span>,<span class="at">axes=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="st">&quot;&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb111-2"><a href="#cb111-2" tabindex="-1"></a><span class="fu">lines</span>(x,y,<span class="at">lwd=</span><span class="dv">4</span>,<span class="at">col=</span><span class="st">&quot;black&quot;</span>)</span>
<span id="cb111-3"><a href="#cb111-3" tabindex="-1"></a><span class="fu">lines</span>(x,y,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">&quot;orange&quot;</span>)</span>
<span id="cb111-4"><a href="#cb111-4" tabindex="-1"></a><span class="fu">box</span>()</span>
<span id="cb111-5"><a href="#cb111-5" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>,<span class="at">at=</span>seqx,<span class="at">lab=</span><span class="fu">paste0</span>(seqx,<span class="st">&quot;°E&quot;</span>),<span class="at">lwd=</span><span class="dv">0</span>,<span class="at">lwd.ticks=</span><span class="dv">1</span>,<span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb111-6"><a href="#cb111-6" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>,<span class="at">at=</span>seqy,<span class="at">lab=</span><span class="fu">paste0</span>(seqy,<span class="st">&quot;°N&quot;</span>),<span class="at">lwd=</span><span class="dv">0</span>,<span class="at">lwd.ticks=</span><span class="dv">1</span>,<span class="at">las=</span><span class="dv">1</span>)</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/spb1-1.svg" width="600px" height="450px" /></p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" tabindex="-1"></a>e <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sfc</span>(sf<span class="sc">::</span><span class="fu">st_linestring</span>(<span class="fu">cbind</span>(x,y)),<span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb112-2"><a href="#cb112-2" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">session_grid</span>(<span class="cn">NULL</span>)</span>
<span id="cb112-3"><a href="#cb112-3" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">glance</span>(e,<span class="at">blank=</span><span class="st">&quot;white&quot;</span>,<span class="at">coast.fill=</span><span class="st">&quot;#00000010&quot;</span>,<span class="at">pointsize=</span><span class="dv">12</span></span>
<span id="cb112-4"><a href="#cb112-4" tabindex="-1"></a>            ,<span class="at">col=</span><span class="st">&quot;black&quot;</span>,<span class="at">plot.lwd=</span><span class="dv">5</span>)</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/ursa01_spb2.png" width="396" height="500" /></p>
</div>
<div id="datavolcano" class="section level4">
<h4><code>data(volcano)</code></h4>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" tabindex="-1"></a><span class="fu">image</span>(volcano)</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/imgvolcano-1.svg" width="768" /></p>
<p>Это вулкан Maunga Whau (Mt Eden).</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" tabindex="-1"></a>ursa<span class="sc">:::</span><span class="fu">spatialize</span>(<span class="st">&quot;Mount Eden&quot;</span>,<span class="at">place=</span><span class="st">&quot;park&quot;</span>,<span class="at">style=</span><span class="st">&quot;web&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb114-2"><a href="#cb114-2" tabindex="-1"></a>   ursa<span class="sc">::</span><span class="fu">glance</span>(<span class="at">basemap.alpha=</span><span class="dv">1</span>,<span class="at">style=</span><span class="st">&quot;opentopomap&quot;</span>)</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/ursa03_glancevolcano.png" width="247" height="550" /></p>
</div>
</div>
<div id="пространственные-данные" class="section level3">
<h3>Пространст­вен­ные данные</h3>
<div id="векторы" class="section level4">
<h4>Векторы</h4>
<table>
<colgroup>
<col width="26%" />
<col width="31%" />
<col width="26%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th>Библиотека</th>
<th>Формат</th>
<th>Импорт</th>
<th>Экспорт</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://edzer.github.io/sp/"><code>sp</code></a></td>
<td><a href="https://gdal.org/drivers/vector/index.html">GDAL vector drivers</a></td>
<td><code>sf::st_read() &#x01C0;&gt; sf::as_Spatial()</code> <sup>1</sup></td>
<td><code>sf::st_as_sf() &#x01C0;&gt; sf::st_write</code> <sup>2</sup></td>
</tr>
<tr class="even">
<td><a href="https://r-spatial.github.io/sf/"><code>sf</code></a></td>
<td><a href="https://gdal.org/drivers/vector/index.html">GDAL vector drivers</a></td>
<td><code>st_read()</code></td>
<td><code>st_write()</code></td>
</tr>
<tr class="odd">
<td><a href="https://cran.rstudio.com/web/packages/gdalUtilities/"><code>gdalUtilities</code></a> <sup><em>факультативно</em><sup></td>
<td><a href="https://gdal.org/drivers/vector/index.html">GDAL vector drivers</a></td>
<td></td>
<td>оболочка системного GDAL</td>
</tr>
</tbody>
</table>
<!--
-->
<p><sup>1</sup>: <code>ursa::spatial_read(fname,engine="sp")</code> <br> <strong><code>rgdal</code></strong><code>::readOGR()</code></p>
<p><sup>2</sup>: <code>ursa::spatial_write(obj,fname)</code> <br> <strong><code>rgdal</code></strong><code>::writeOGR()</code></p>
</div>
<div id="растры" class="section level4">
<h4>Растры</h4>
<div class="font95">
<table>
<colgroup>
<col width="15%" />
<col width="21%" />
<col width="42%" />
<col width="21%" />
</colgroup>
<thead>
<tr class="header">
<th>Библиотека</th>
<th>Формат</th>
<th>Импорт</th>
<th>Экспорт</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>sp</code></td>
<td><a href="https://gdal.org/drivers/raster/index.html">GDAL raster drivers</a></td>
<td><code>raster::raster() &#x01C0;&gt; as("SpatialGridDataFrame")</code> <sup>1</sup></td>
<td><code>ursa::as_ursa(b) &#x01C0;&gt; ursa::as.Raster() &#x01C0;&gt; raster::writeRaster()</code> <sup>2</sup></td>
</tr>
<tr class="even">
<td><code>raster</code></td>
<td><a href="https://gdal.org/drivers/raster/rraster.html">RRASTER – R Raster</a>, <a href="https://gdal.org/drivers/raster/index.html">GDAL raster drivers</a></td>
<td><code>raster()</code>, <code>brick()</code>, <code>stack()</code></td>
<td><code>writeRaster()</code></td>
</tr>
<tr class="odd">
<td><code>terra</code></td>
<td><a href="https://gdal.org/drivers/raster/index.html">GDAL raster drivers</a></td>
<td><code>rast()</code></td>
<td><code>writeRaster()</code></td>
</tr>
<tr class="even">
<td><code>stars</code></td>
<td><a href="https://gdal.org/drivers/raster/index.html">GDAL raster drivers</a></td>
<td><code>read_stars()</code></td>
<td><code>write_stars()</code></td>
</tr>
<tr class="odd">
<td><a href="https://cran.rstudio.com/web/packages/ncdf4/"><code>ncdf4</code></a></td>
<td><a href="https://gdal.org/drivers/raster/netcdf.html">NetCDF</a></td>
<td><code>nc_open()</code></td>
<td><code>nc_create()</code></td>
</tr>
<tr class="even">
<td><code>ursa</code></td>
<td><a href="https://gdal.org/drivers/raster/envi.html">ENVI - ENVI .hdr Labelled Raster</a></td>
<td><code>read_envi()</code></td>
<td><code>write_envi()</code></td>
</tr>
</tbody>
</table>
<p><sup>1</sup>: <strong><code>rgdal</code></strong><code>::readGDAL()</code></p>
<p><sup>2</sup>: <strong><code>rgdal</code></strong><code>::writeGDAL()</code></p>
</div>
</div>
<div id="визуализация" class="section level4">
<h4>Визуализация</h4>
<p>Статическая, экспортируемая в обычные форматы изображений. PNG, JPG поддерживают DPI.</p>
<ul>
<li><p><code>ggplot2</code> и надстройки (префикс <code>gg*</code>)</p></li>
<li><p><code>ursa</code></p></li>
</ul>
<p>Интерактивная, отображаемая в браузере</p>
<ul>
<li><p><code>leaflet</code></p></li>
<li><p><code>mapview</code></p></li>
<li><p><code>tmap</code></p></li>
</ul>
</div>
</div>
<div id="по-форматам" class="section level3">
<h3>По форматам</h3>
<div id="растры-1" class="section level4">
<h4>Растры</h4>
<ul>
<li><p>Для хранения многослойные растров используется BSQ/BIL/BIP чередование слоев/строк/пикелей. Самый неэффективный - это BIP. При пространственно-временном анализе можно выбрать BIL, для большинства случаев - BSQ.</p></li>
<li><p>Целочисленный GeoTIFF быстро пишется и читается при использовании функций из библиотеки <code>rgdal</code></p></li>
<li><p><a href="https://gdal.org/drivers/raster/gtiff.html">GeoTIFF</a> часто используется при обмене данными.</p></li>
</ul>
</div>
<div id="векторы-1" class="section level4">
<h4>Векторы</h4>
<ul>
<li><p>Хорошую скорость чтения и записи демонстрирует формат <a href="https://gdal.org/drivers/vector/sqlite.html">“SQLite”</a> (“SpatiaLite” RDBMS) при использовании библиотеки <code>sf</code>.</p></li>
<li><p><a href="https://gdal.org/drivers/vector/geojson.html">“GeoJSON”</a> не очень быстрый, но можно использовать библиотеку <a href="https://cran.rstudio.com/web/packages/geojsonsf/"><code>geojsonf</code></a>.</p></li>
<li><p>При записи использовать опции, предусмотренные для выбранного формата данных</p></li>
<li><p>При записи <a href="https://gdal.org/drivers/vector/shapefile.html">“ESRI Shapefile”</a> обращать внимания на *.prj, так как у QGIS и ESRI-продуктов разные восприятия файлов проекций.</p></li>
<li><p>“ESRI Shapefile” преобладающий формат при обмене данными.</p></li>
</ul>
</div>
<div id="sf-или-sp" class="section level4">
<h4><code>sf</code> или <code>sp</code>?</h4>
<ul>
<li><p>В пользу <span class="large"><code>sf</code></span> больше аргументов:</p>
<ul>
<li><p>удобнее, развивается, поддерживается</p></li>
<li><p>в <code>sf</code> объекты класса S3, в <code>sp</code> объекты класса S4 (строже, но медленнее)</p></li>
<li><p>есть <code>sf::as_Spatial()</code> (или <code>as(...,"Spatial")</code>) для преобразования в объекты <code>sp</code>. Обратное преобразование: <code>sf::st_as_sf()</code>.</p></li>
</ul></li>
<li><p>Эффективность с геометрией POINT выше у <code>sp</code> из-за представления атрибутивной таблицы и геометрии в одной таблице.</p></li>
<li><p>Ряд библиотек завязаны на формат данных <code>sp</code>, например
<a href="https://cran.rstudio.com/web/packages/adehabitatHR/"><code>adehabitatHR</code></a>,
<a href="https://cran.rstudio.com/web/packages/dismo/"><code>dismo</code></a>,
<a href="https://cran.rstudio.com/web/packages/sdm/"><code>sdm</code></a>.</p></li>
</ul>
</div>
</div>
</div>
<div id="манипуляции-с-пространственными-данными" class="section level2">
<h2>Манипуляции с пространст­вен­ными данными</h2>
<div id="импорт" class="section level3 middle">
<h3 class="middle">Импорт</h3>
<p>Загрузить пространственные данные из файла</p>
<div id="источники-для-примера" class="section level4">
<h4>Источники для примера</h4>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" tabindex="-1"></a>(shpname <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;shape&quot;</span>,<span class="st">&quot;nc.shp&quot;</span>,<span class="at">package=</span><span class="st">&quot;sf&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;C:/Software/Rlibs43/sf/shape/nc.shp&quot;</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" tabindex="-1"></a><span class="fu">file.exists</span>(shpname)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" tabindex="-1"></a>(tifname <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata/tahoe.tif&quot;</span>,<span class="at">package=</span><span class="st">&quot;gdalUtilities&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;C:/Software/Rlibs43/gdalUtilities/extdata/tahoe.tif&quot;</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" tabindex="-1"></a><span class="fu">file.exists</span>(tifname)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">session_grid</span>(<span class="cn">NULL</span>)</span>
<span id="cb123-2"><a href="#cb123-2" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">glance</span>(shpname,<span class="at">coast=</span><span class="cn">FALSE</span>,<span class="at">field=</span><span class="st">&quot;(NAME|SID79)&quot;</span>,<span class="at">blank=</span><span class="st">&quot;white&quot;</span></span>
<span id="cb123-3"><a href="#cb123-3" tabindex="-1"></a>            ,<span class="at">legend=</span><span class="fu">list</span>(<span class="fu">list</span>(<span class="dv">1</span>,<span class="st">&quot;left&quot;</span>),<span class="fu">list</span>(<span class="dv">2</span>,<span class="st">&quot;left&quot;</span>)),<span class="at">dpi=</span><span class="dv">88</span>)</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/ursa05_scotBNG.png" width="1989" height="566" bound /></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">session_grid</span>(<span class="cn">NULL</span>)</span>
<span id="cb124-2"><a href="#cb124-2" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">glance</span>(tifname,<span class="at">dpi=</span><span class="dv">96</span>)</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/ursa07_tahoe-rgb.png" width="1242" height="550" bound /></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">session_grid</span>(<span class="cn">NULL</span>)</span>
<span id="cb125-2"><a href="#cb125-2" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">display_brick</span>(tifname,<span class="at">dpi=</span><span class="dv">96</span>)</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/ursa09_tahoe-channels.png" width="2901" height="550" bound /></p>
</div>
<div id="векторные-данные" class="section level4">
<h4>Векторные данные</h4>
<div id="rgdalsp" class="section level5">
<h5><code>rgdal/sp</code></h5>
<div class="oversize h650">
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" tabindex="-1"></a><span class="fu">try</span>(rgdal<span class="sc">::</span><span class="fu">ogrInfo</span>(shpname)) <span class="do">## Будет ошибка, если пакета &#39;rgdal&#39; нет</span></span></code></pre></div>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Source: &quot;C:\Software\Rlibs43\sf\shape\nc.shp&quot;, layer: &quot;nc&quot;
## Driver: ESRI Shapefile; number of rows: 100 
## Feature type: wkbPolygon with 2 dimensions
## Extent: (-84.32385 33.88199) - (-75.45698 36.58965)
## CRS: +proj=longlat +datum=NAD27 +no_defs 
## LDID: 87 
## Number of fields: 14 
##         name type length typeName
## 1       AREA    2     24     Real
## 2  PERIMETER    2     24     Real
## 3      CNTY_    2     24     Real
## 4    CNTY_ID    2     24     Real
## 5       NAME    4     80   String
## 6       FIPS    4     80   String
## 7     FIPSNO    2     24     Real
## 8   CRESS_ID    0      9  Integer
## 9      BIR74    2     24     Real
## 10     SID74    2     24     Real
## 11   NWBIR74    2     24     Real
## 12     BIR79    2     24     Real
## 13     SID79    2     24     Real
## 14   NWBIR79    2     24     Real</code></pre>
</div>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" tabindex="-1"></a>b.sp <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(shpname) <span class="sc">|&gt;</span> <span class="fu">as</span>(<span class="st">&quot;Spatial&quot;</span>) <span class="do">## rgdal::readOGR(shpname)</span></span></code></pre></div>
<pre><code>## Reading layer `nc&#39; from data source `C:\Software\Rlibs43\sf\shape\nc.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 100 features and 14 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965
## Geodetic CRS:  NAD27</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" tabindex="-1"></a><span class="fu">class</span>(b.sp)</span></code></pre></div>
<pre><code>## [1] &quot;SpatialPolygonsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" tabindex="-1"></a><span class="fu">isS4</span>(b.sp)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" tabindex="-1"></a><span class="fu">slotNames</span>(b.sp)</span></code></pre></div>
<pre><code>## [1] &quot;data&quot;        &quot;polygons&quot;    &quot;plotOrder&quot;   &quot;bbox&quot;        &quot;proj4string&quot;</code></pre>
<div class="oversize">
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">head</span>(b.sp,<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## Formal class &#39;SpatialPolygonsDataFrame&#39; [package &quot;sp&quot;] with 5 slots
##   ..@ data       :&#39;data.frame&#39;:  2 obs. of  14 variables:
##   .. ..$ AREA     : num [1:2] 0.114 0.061
##   .. ..$ PERIMETER: num [1:2] 1.44 1.23
##   .. ..$ CNTY_    : num [1:2] 1825 1827
##   .. ..$ CNTY_ID  : num [1:2] 1825 1827
##   .. ..$ NAME     : chr [1:2] &quot;Ashe&quot; &quot;Alleghany&quot;
##   .. ..$ FIPS     : chr [1:2] &quot;37009&quot; &quot;37005&quot;
##   .. ..$ FIPSNO   : num [1:2] 37009 37005
##   .. ..$ CRESS_ID : int [1:2] 5 3
##   .. ..$ BIR74    : num [1:2] 1091 487
##   .. ..$ SID74    : num [1:2] 1 0
##   .. ..$ NWBIR74  : num [1:2] 10 10
##   .. ..$ BIR79    : num [1:2] 1364 542
##   .. ..$ SID79    : num [1:2] 0 3
##   .. ..$ NWBIR79  : num [1:2] 19 12
##   ..@ polygons   :List of 2
##   .. ..$ :Formal class &#39;Polygons&#39; [package &quot;sp&quot;] with 5 slots
##   .. .. .. ..@ Polygons :List of 1
##   .. .. .. .. ..$ :Formal class &#39;Polygon&#39; [package &quot;sp&quot;] with 5 slots
##   .. .. .. .. .. .. ..@ labpt  : num [1:2] -81.5 36.4
##   .. .. .. .. .. .. ..@ area   : num 0.114
##   .. .. .. .. .. .. ..@ hole   : logi FALSE
##   .. .. .. .. .. .. ..@ ringDir: int 1
##   .. .. .. .. .. .. ..@ coords : num [1:27, 1:2] -81.5 -81.5 -81.6 -81.6 -81.7 ...
##   .. .. .. ..@ plotOrder: int 1
##   .. .. .. ..@ labpt    : num [1:2] -81.5 36.4
##   .. .. .. ..@ ID       : chr &quot;1&quot;
##   .. .. .. ..@ area     : num 0.114
##   .. .. .. ..$ comment: chr &quot;0&quot;
##   .. ..$ :Formal class &#39;Polygons&#39; [package &quot;sp&quot;] with 5 slots
##   .. .. .. ..@ Polygons :List of 1
##   .. .. .. .. ..$ :Formal class &#39;Polygon&#39; [package &quot;sp&quot;] with 5 slots
##   .. .. .. .. .. .. ..@ labpt  : num [1:2] -81.1 36.5
##   .. .. .. .. .. .. ..@ area   : num 0.0614
##   .. .. .. .. .. .. ..@ hole   : logi FALSE
##   .. .. .. .. .. .. ..@ ringDir: int 1
##   .. .. .. .. .. .. ..@ coords : num [1:26, 1:2] -81.2 -81.2 -81.3 -81.3 -81.3 ...
##   .. .. .. ..@ plotOrder: int 1
##   .. .. .. ..@ labpt    : num [1:2] -81.1 36.5
##   .. .. .. ..@ ID       : chr &quot;2&quot;
##   .. .. .. ..@ area     : num 0.0614
##   .. .. .. ..$ comment: chr &quot;0&quot;
##   ..@ plotOrder  : int [1:2] 1 2
##   ..@ bbox       : num [1:2, 1:2] -81.7 36.2 -80.9 36.6
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:2] &quot;x&quot; &quot;y&quot;
##   .. .. ..$ : chr [1:2] &quot;min&quot; &quot;max&quot;
##   ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
##   .. .. ..@ projargs: chr &quot;+proj=longlat +datum=NAD27 +no_defs&quot;
##   .. .. ..$ comment: chr &quot;GEOGCRS[\&quot;NAD27\&quot;,\n    DATUM[\&quot;North American Datum 1927\&quot;,\n        ELLIPSOID[\&quot;Clarke 1866\&quot;,6378206.4,294.9&quot;| __truncated__
##   ..$ comment: chr &quot;TRUE&quot;</code></pre>
</div>
</div>
<div id="importExample" class="section level5">
<h5><code>sf</code></h5>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" tabindex="-1"></a>b.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(shpname)</span></code></pre></div>
<pre><code>## Reading layer `nc&#39; from data source `C:\Software\Rlibs43\sf\shape\nc.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 100 features and 14 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965
## Geodetic CRS:  NAD27</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" tabindex="-1"></a><span class="fu">str</span>(b.sf)</span></code></pre></div>
<pre><code>## Classes &#39;sf&#39; and &#39;data.frame&#39;:   100 obs. of  15 variables:
##  $ AREA     : num  0.114 0.061 0.143 0.07 0.153 0.097 0.062 0.091 0.118 0.124 ...
##  $ PERIMETER: num  1.44 1.23 1.63 2.97 2.21 ...
##  $ CNTY_    : num  1825 1827 1828 1831 1832 ...
##  $ CNTY_ID  : num  1825 1827 1828 1831 1832 ...
##  $ NAME     : chr  &quot;Ashe&quot; &quot;Alleghany&quot; &quot;Surry&quot; &quot;Currituck&quot; ...
##  $ FIPS     : chr  &quot;37009&quot; &quot;37005&quot; &quot;37171&quot; &quot;37053&quot; ...
##  $ FIPSNO   : num  37009 37005 37171 37053 37131 ...
##  $ CRESS_ID : int  5 3 86 27 66 46 15 37 93 85 ...
##  $ BIR74    : num  1091 487 3188 508 1421 ...
##  $ SID74    : num  1 0 5 1 9 7 0 0 4 1 ...
##  $ NWBIR74  : num  10 10 208 123 1066 ...
##  $ BIR79    : num  1364 542 3616 830 1606 ...
##  $ SID79    : num  0 3 6 2 3 5 2 2 2 5 ...
##  $ NWBIR79  : num  19 12 260 145 1197 ...
##  $ geometry :sfc_MULTIPOLYGON of length 100; first list element: List of 1
##   ..$ :List of 1
##   .. ..$ : num [1:27, 1:2] -81.5 -81.5 -81.6 -81.6 -81.7 ...
##   ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;XY&quot; &quot;MULTIPOLYGON&quot; &quot;sfg&quot;
##  - attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
##  - attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA NA NA NA NA NA NA NA NA ...
##   ..- attr(*, &quot;names&quot;)= chr [1:14] &quot;AREA&quot; &quot;PERIMETER&quot; &quot;CNTY_&quot; &quot;CNTY_ID&quot; ...</code></pre>
</div>
</div>
<div id="растровые-данные" class="section level4">
<h4>Растровые данные</h4>
<div id="rgdalsp-1" class="section level5">
<h5><code>rgdal/sp</code></h5>
<div class="font92">
<p>Получение данных напрямую</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">raster</span>(tifname) <span class="sc">|&gt;</span> <span class="fu">as</span>(<span class="st">&quot;SpatialGridDataFrame&quot;</span>) <span class="do">## rgdal::readGDAL(tifname)</span></span></code></pre></div>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" tabindex="-1"></a><span class="fu">str</span>(d1)</span></code></pre></div>
<pre><code>## Formal class &#39;SpatialGridDataFrame&#39; [package &quot;sp&quot;] with 4 slots
##   ..@ data       :&#39;data.frame&#39;:  160000 obs. of  1 variable:
##   .. ..$ tahoe_1: num [1:160000] 34 108 130 93 114 159 157 171 172 200 ...
##   ..@ grid       :Formal class &#39;GridTopology&#39; [package &quot;sp&quot;] with 3 slots
##   .. .. ..@ cellcentre.offset: Named num [1:2] -119.9 39.3
##   .. .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;s1&quot; &quot;s2&quot;
##   .. .. ..@ cellsize         : num [1:2] 5.47e-06 5.47e-06
##   .. .. ..@ cells.dim        : int [1:2] 400 400
##   ..@ bbox       : num [1:2, 1:2] -119.9 39.3 -119.9 39.3
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:2] &quot;s1&quot; &quot;s2&quot;
##   .. .. ..$ : chr [1:2] &quot;min&quot; &quot;max&quot;
##   ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
##   .. .. ..@ projargs: chr &quot;+proj=longlat +datum=WGS84 +no_defs&quot;
##   .. .. ..$ comment: chr &quot;GEOGCRS[\&quot;unknown\&quot;,\n    DATUM[\&quot;World Geodetic System 1984\&quot;,\n        ELLIPSOID[\&quot;WGS 84\&quot;,6378137,298.25722&quot;| __truncated__</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" tabindex="-1"></a><span class="fu">summary</span>(d1<span class="sc">@</span>data[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##       0     105     157     149     198     255</code></pre>
</div>
<div class="font85">
<p>Получение данных более гибким способом</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" tabindex="-1"></a>md <span class="ot">&lt;-</span> <span class="fu">try</span>(rgdal<span class="sc">::</span><span class="fu">GDALinfo</span>(tifname))</span></code></pre></div>
<pre><code>## Warning: GDAL support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: GDAL support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning in rgdal::GDALinfo(tifname): statistics not supported by this driver

## Warning in rgdal::GDALinfo(tifname): statistics not supported by this driver

## Warning in rgdal::GDALinfo(tifname): statistics not supported by this driver</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(md,<span class="st">&quot;try-error&quot;</span>)) {</span>
<span id="cb157-2"><a href="#cb157-2" tabindex="-1"></a>   mdname <span class="ot">&lt;-</span> <span class="fu">names</span>(md)</span>
<span id="cb157-3"><a href="#cb157-3" tabindex="-1"></a>   <span class="fu">attributes</span>(md) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb157-4"><a href="#cb157-4" tabindex="-1"></a>   <span class="fu">names</span>(md) <span class="ot">&lt;-</span> mdname</span>
<span id="cb157-5"><a href="#cb157-5" tabindex="-1"></a>   <span class="fu">print</span>(md)</span>
<span id="cb157-6"><a href="#cb157-6" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>##          rows       columns         bands          ll.x          ll.y         res.x         res.y 
##  4.000000e+02  4.000000e+02  3.000000e+00 -1.199328e+02  3.928922e+01  5.472861e-06  5.472861e-06 
##     oblique.x     oblique.y 
##  0.000000e+00  0.000000e+00</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(md,<span class="st">&quot;try-error&quot;</span>)) {</span>
<span id="cb159-2"><a href="#cb159-2" tabindex="-1"></a>   dset <span class="ot">&lt;-</span> methods<span class="sc">::</span><span class="fu">new</span>(<span class="st">&quot;GDALReadOnlyDataset&quot;</span>,tifname)</span>
<span id="cb159-3"><a href="#cb159-3" tabindex="-1"></a>   d2 <span class="ot">&lt;-</span> rgdal<span class="sc">::</span><span class="fu">getRasterData</span>(dset,<span class="at">offset=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb159-4"><a href="#cb159-4" tabindex="-1"></a>                             ,<span class="at">region.dim=</span>md[<span class="fu">c</span>(<span class="st">&quot;rows&quot;</span>,<span class="st">&quot;columns&quot;</span>)])</span>
<span id="cb159-5"><a href="#cb159-5" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(md,<span class="st">&quot;try-error&quot;</span>))</span>
<span id="cb160-2"><a href="#cb160-2" tabindex="-1"></a>   <span class="fu">str</span>(d2)</span></code></pre></div>
<pre><code>##  int [1:400, 1:400, 1:3] 34 108 130 93 114 159 157 171 172 200 ...</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(md,<span class="st">&quot;try-error&quot;</span>))</span>
<span id="cb162-2"><a href="#cb162-2" tabindex="-1"></a>   <span class="fu">summary</span>(<span class="fu">c</span>(d2))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     0.0    61.0   104.0   110.4   159.0   255.0</code></pre>
</div>
</div>
<div id="raster" class="section level5">
<h5><code>raster</code></h5>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" tabindex="-1"></a>(d3 <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">brick</span>(tifname))</span></code></pre></div>
<pre><code>## class      : RasterBrick 
## dimensions : 400, 400, 160000, 3  (nrow, ncol, ncell, nlayers)
## resolution : 5.472861e-06, 5.472861e-06  (x, y)
## extent     : -119.9328, -119.9306, 39.28922, 39.29141  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : tahoe.tif 
## names      : tahoe_1, tahoe_2, tahoe_3</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" tabindex="-1"></a>v3 <span class="ot">&lt;-</span> d3[] <span class="do">## &#39;d3[]&#39; то же, что и &#39;raster::getValues(d3)&#39;</span></span>
<span id="cb166-2"><a href="#cb166-2" tabindex="-1"></a><span class="fu">c</span>(<span class="at">d3=</span><span class="fu">object.size</span>(d3),<span class="at">v3=</span><span class="fu">object.size</span>(v3))</span></code></pre></div>
<pre><code>##      d3      v3 
##   13352 3840640</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" tabindex="-1"></a><span class="fu">str</span>(v3)</span></code></pre></div>
<pre><code>##  num [1:160000, 1:3] 34 108 130 93 114 159 157 171 172 200 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr [1:3] &quot;tahoe_1&quot; &quot;tahoe_2&quot; &quot;tahoe_3&quot;</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">c</span>(v3))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     0.0    61.0   104.0   110.4   159.0   255.0</code></pre>
</div>
<div id="terra" class="section level5">
<h5><code>terra</code></h5>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" tabindex="-1"></a>(d4 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(tifname))</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 400, 400, 3  (nrow, ncol, nlyr)
## resolution  : 5.472861e-06, 5.472861e-06  (x, y)
## extent      : -119.9328, -119.9306, 39.28922, 39.29141  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 (EPSG:4326) 
## source      : tahoe.tif 
## colors RGB  : 1, 2, 3 
## names       : tahoe_1, tahoe_2, tahoe_3</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" tabindex="-1"></a>v4 <span class="ot">&lt;-</span> d4[] <span class="do">## &#39;d4[]&#39; то же, что и &#39;terra::values(d3)&#39;</span></span>
<span id="cb174-2"><a href="#cb174-2" tabindex="-1"></a><span class="fu">c</span>(<span class="at">d4=</span><span class="fu">object.size</span>(d4),<span class="at">v3=</span><span class="fu">object.size</span>(v4))</span></code></pre></div>
<pre><code>##      d4      v3 
##    1304 1920640</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" tabindex="-1"></a><span class="fu">str</span>(v4)</span></code></pre></div>
<pre><code>##  int [1:160000, 1:3] 34 108 130 93 114 159 157 171 172 200 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr [1:3] &quot;tahoe_1&quot; &quot;tahoe_2&quot; &quot;tahoe_3&quot;</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">c</span>(v4))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     0.0    61.0   104.0   110.4   159.0   255.0</code></pre>
</div>
</div>
</div>
<div id="характеристики" class="section level3 middle">
<h3 class="middle">Характеристики</h3>
<h4 class="toc-ignore unnumbered unlisted">
Характеристики, свойства и компоненты пространственных данных
</h4>
<div id="sp" class="section level5">
<h5><code>sp</code></h5>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" tabindex="-1"></a><span class="fu">class</span>(b.sp<span class="sc">$</span>NAME)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" tabindex="-1"></a><span class="fu">class</span>(b.sp[[<span class="st">&quot;NAME&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" tabindex="-1"></a><span class="fu">class</span>(b.sp[<span class="st">&quot;NAME&quot;</span>])</span></code></pre></div>
<pre><code>## [1] &quot;SpatialPolygonsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
</div>
<div id="sf" class="section level5">
<h5><code>sf</code></h5>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" tabindex="-1"></a><span class="fu">class</span>(b.sf<span class="sc">$</span>NAME)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" tabindex="-1"></a><span class="fu">class</span>(b.sf[[<span class="st">&quot;NAME&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" tabindex="-1"></a><span class="fu">class</span>(b.sf[<span class="st">&quot;NAME&quot;</span>])</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
</div>
<div id="таблица-атрибутов" class="section level4">
<h4>Таблица атрибутов</h4>
<div id="sp-1" class="section level5">
<h5><code>sp</code></h5>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">slot</span>(b.sp,<span class="st">&quot;data&quot;</span>))</span></code></pre></div>
<div class="kable-table">
<table>
<colgroup>
<col width="5%" />
<col width="9%" />
<col width="5%" />
<col width="7%" />
<col width="11%" />
<col width="5%" />
<col width="6%" />
<col width="8%" />
<col width="5%" />
<col width="5%" />
<col width="7%" />
<col width="5%" />
<col width="5%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">AREA</th>
<th align="right">PERIMETER</th>
<th align="right">CNTY_</th>
<th align="right">CNTY_ID</th>
<th align="left">NAME</th>
<th align="left">FIPS</th>
<th align="right">FIPSNO</th>
<th align="right">CRESS_ID</th>
<th align="right">BIR74</th>
<th align="right">SID74</th>
<th align="right">NWBIR74</th>
<th align="right">BIR79</th>
<th align="right">SID79</th>
<th align="right">NWBIR79</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.114</td>
<td align="right">1.442</td>
<td align="right">1825</td>
<td align="right">1825</td>
<td align="left">Ashe</td>
<td align="left">37009</td>
<td align="right">37009</td>
<td align="right">5</td>
<td align="right">1091</td>
<td align="right">1</td>
<td align="right">10</td>
<td align="right">1364</td>
<td align="right">0</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="right">0.061</td>
<td align="right">1.231</td>
<td align="right">1827</td>
<td align="right">1827</td>
<td align="left">Alleghany</td>
<td align="left">37005</td>
<td align="right">37005</td>
<td align="right">3</td>
<td align="right">487</td>
<td align="right">0</td>
<td align="right">10</td>
<td align="right">542</td>
<td align="right">3</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="right">0.143</td>
<td align="right">1.630</td>
<td align="right">1828</td>
<td align="right">1828</td>
<td align="left">Surry</td>
<td align="left">37171</td>
<td align="right">37171</td>
<td align="right">86</td>
<td align="right">3188</td>
<td align="right">5</td>
<td align="right">208</td>
<td align="right">3616</td>
<td align="right">6</td>
<td align="right">260</td>
</tr>
<tr class="even">
<td align="right">0.070</td>
<td align="right">2.968</td>
<td align="right">1831</td>
<td align="right">1831</td>
<td align="left">Currituck</td>
<td align="left">37053</td>
<td align="right">37053</td>
<td align="right">27</td>
<td align="right">508</td>
<td align="right">1</td>
<td align="right">123</td>
<td align="right">830</td>
<td align="right">2</td>
<td align="right">145</td>
</tr>
<tr class="odd">
<td align="right">0.153</td>
<td align="right">2.206</td>
<td align="right">1832</td>
<td align="right">1832</td>
<td align="left">Northampton</td>
<td align="left">37131</td>
<td align="right">37131</td>
<td align="right">66</td>
<td align="right">1421</td>
<td align="right">9</td>
<td align="right">1066</td>
<td align="right">1606</td>
<td align="right">3</td>
<td align="right">1197</td>
</tr>
<tr class="even">
<td align="right">0.097</td>
<td align="right">1.670</td>
<td align="right">1833</td>
<td align="right">1833</td>
<td align="left">Hertford</td>
<td align="left">37091</td>
<td align="right">37091</td>
<td align="right">46</td>
<td align="right">1452</td>
<td align="right">7</td>
<td align="right">954</td>
<td align="right">1838</td>
<td align="right">5</td>
<td align="right">1237</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="sf-1" class="section level5">
<h5><code>sf</code></h5>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" tabindex="-1"></a><span class="fu">head</span>(sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(b.sf,<span class="cn">NULL</span>))</span></code></pre></div>
<div class="kable-table">
<table>
<colgroup>
<col width="5%" />
<col width="9%" />
<col width="5%" />
<col width="7%" />
<col width="11%" />
<col width="5%" />
<col width="6%" />
<col width="8%" />
<col width="5%" />
<col width="5%" />
<col width="7%" />
<col width="5%" />
<col width="5%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">AREA</th>
<th align="right">PERIMETER</th>
<th align="right">CNTY_</th>
<th align="right">CNTY_ID</th>
<th align="left">NAME</th>
<th align="left">FIPS</th>
<th align="right">FIPSNO</th>
<th align="right">CRESS_ID</th>
<th align="right">BIR74</th>
<th align="right">SID74</th>
<th align="right">NWBIR74</th>
<th align="right">BIR79</th>
<th align="right">SID79</th>
<th align="right">NWBIR79</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.114</td>
<td align="right">1.442</td>
<td align="right">1825</td>
<td align="right">1825</td>
<td align="left">Ashe</td>
<td align="left">37009</td>
<td align="right">37009</td>
<td align="right">5</td>
<td align="right">1091</td>
<td align="right">1</td>
<td align="right">10</td>
<td align="right">1364</td>
<td align="right">0</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="right">0.061</td>
<td align="right">1.231</td>
<td align="right">1827</td>
<td align="right">1827</td>
<td align="left">Alleghany</td>
<td align="left">37005</td>
<td align="right">37005</td>
<td align="right">3</td>
<td align="right">487</td>
<td align="right">0</td>
<td align="right">10</td>
<td align="right">542</td>
<td align="right">3</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="right">0.143</td>
<td align="right">1.630</td>
<td align="right">1828</td>
<td align="right">1828</td>
<td align="left">Surry</td>
<td align="left">37171</td>
<td align="right">37171</td>
<td align="right">86</td>
<td align="right">3188</td>
<td align="right">5</td>
<td align="right">208</td>
<td align="right">3616</td>
<td align="right">6</td>
<td align="right">260</td>
</tr>
<tr class="even">
<td align="right">0.070</td>
<td align="right">2.968</td>
<td align="right">1831</td>
<td align="right">1831</td>
<td align="left">Currituck</td>
<td align="left">37053</td>
<td align="right">37053</td>
<td align="right">27</td>
<td align="right">508</td>
<td align="right">1</td>
<td align="right">123</td>
<td align="right">830</td>
<td align="right">2</td>
<td align="right">145</td>
</tr>
<tr class="odd">
<td align="right">0.153</td>
<td align="right">2.206</td>
<td align="right">1832</td>
<td align="right">1832</td>
<td align="left">Northampton</td>
<td align="left">37131</td>
<td align="right">37131</td>
<td align="right">66</td>
<td align="right">1421</td>
<td align="right">9</td>
<td align="right">1066</td>
<td align="right">1606</td>
<td align="right">3</td>
<td align="right">1197</td>
</tr>
<tr class="even">
<td align="right">0.097</td>
<td align="right">1.670</td>
<td align="right">1833</td>
<td align="right">1833</td>
<td align="left">Hertford</td>
<td align="left">37091</td>
<td align="right">37091</td>
<td align="right">46</td>
<td align="right">1452</td>
<td align="right">7</td>
<td align="right">954</td>
<td align="right">1838</td>
<td align="right">5</td>
<td align="right">1237</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="геометрия" class="section level4">
<h4>Геометрия</h4>
<div id="sp-2" class="section level5">
<h5><code>sp</code></h5>
<div class="oversize">
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" tabindex="-1"></a>g.sp <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">geometry</span>(b.sp)</span></code></pre></div>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">head</span>(g.sp,<span class="dv">2</span>)) <span class="do">## много строк; выведем первые две записи</span></span></code></pre></div>
<pre><code>## Formal class &#39;SpatialPolygons&#39; [package &quot;sp&quot;] with 4 slots
##   ..@ polygons   :List of 2
##   .. ..$ :Formal class &#39;Polygons&#39; [package &quot;sp&quot;] with 5 slots
##   .. .. .. ..@ Polygons :List of 1
##   .. .. .. .. ..$ :Formal class &#39;Polygon&#39; [package &quot;sp&quot;] with 5 slots
##   .. .. .. .. .. .. ..@ labpt  : num [1:2] -81.5 36.4
##   .. .. .. .. .. .. ..@ area   : num 0.114
##   .. .. .. .. .. .. ..@ hole   : logi FALSE
##   .. .. .. .. .. .. ..@ ringDir: int 1
##   .. .. .. .. .. .. ..@ coords : num [1:27, 1:2] -81.5 -81.5 -81.6 -81.6 -81.7 ...
##   .. .. .. ..@ plotOrder: int 1
##   .. .. .. ..@ labpt    : num [1:2] -81.5 36.4
##   .. .. .. ..@ ID       : chr &quot;1&quot;
##   .. .. .. ..@ area     : num 0.114
##   .. .. .. ..$ comment: chr &quot;0&quot;
##   .. ..$ :Formal class &#39;Polygons&#39; [package &quot;sp&quot;] with 5 slots
##   .. .. .. ..@ Polygons :List of 1
##   .. .. .. .. ..$ :Formal class &#39;Polygon&#39; [package &quot;sp&quot;] with 5 slots
##   .. .. .. .. .. .. ..@ labpt  : num [1:2] -81.1 36.5
##   .. .. .. .. .. .. ..@ area   : num 0.0614
##   .. .. .. .. .. .. ..@ hole   : logi FALSE
##   .. .. .. .. .. .. ..@ ringDir: int 1
##   .. .. .. .. .. .. ..@ coords : num [1:26, 1:2] -81.2 -81.2 -81.3 -81.3 -81.3 ...
##   .. .. .. ..@ plotOrder: int 1
##   .. .. .. ..@ labpt    : num [1:2] -81.1 36.5
##   .. .. .. ..@ ID       : chr &quot;2&quot;
##   .. .. .. ..@ area     : num 0.0614
##   .. .. .. ..$ comment: chr &quot;0&quot;
##   ..@ plotOrder  : int [1:2] 1 2
##   ..@ bbox       : num [1:2, 1:2] -81.7 36.2 -80.9 36.6
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:2] &quot;x&quot; &quot;y&quot;
##   .. .. ..$ : chr [1:2] &quot;min&quot; &quot;max&quot;
##   ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
##   .. .. ..@ projargs: chr &quot;+proj=longlat +datum=NAD27 +no_defs&quot;
##   .. .. ..$ comment: chr &quot;GEOGCRS[\&quot;NAD27\&quot;,\n    DATUM[\&quot;North American Datum 1927\&quot;,\n        ELLIPSOID[\&quot;Clarke 1866\&quot;,6378206.4,294.9&quot;| __truncated__
##   ..$ comment: chr &quot;TRUE&quot;</code></pre>
</div>
</div>
<div id="sf-2" class="section level5">
<h5><code>sf</code></h5>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" tabindex="-1"></a>(<span class="fu">head</span>(g.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_geometry</span>(b.sf),<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## Geometry set for 2 features 
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -81.74107 ymin: 36.23436 xmax: -80.90344 ymax: 36.58965
## Geodetic CRS:  NAD27</code></pre>
<pre><code>## MULTIPOLYGON (((-81.47276 36.23436, -81.54084 3...</code></pre>
<pre><code>## MULTIPOLYGON (((-81.23989 36.36536, -81.24069 3...</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" tabindex="-1"></a><span class="fu">str</span>(g.sf)</span></code></pre></div>
<pre><code>## sfc_MULTIPOLYGON of length 100; first list element: List of 1
##  $ :List of 1
##   ..$ : num [1:27, 1:2] -81.5 -81.5 -81.6 -81.6 -81.7 ...
##  - attr(*, &quot;class&quot;)= chr [1:3] &quot;XY&quot; &quot;MULTIPOLYGON&quot; &quot;sfg&quot;</code></pre>
</div>
</div>
<div id="проекция" class="section level4 middle">
<h4 class="middle">Проекция</h4>
<p>В современных пакетах R данные проекции представляются в виде WKT;
по возможножности, сохраняется связь с EPSG и PROJ.</p>
<div id="sp-3" class="section level5">
<h5><code>sp</code></h5>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">proj4string</span>(b.sp)</span></code></pre></div>
<pre><code>## [1] &quot;+proj=longlat +datum=NAD27 +no_defs&quot;</code></pre>
</div>
<div id="sf-3" class="section level5">
<h5><code>sf</code></h5>
<div class="oversize">
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_crs</span>(b.sf)</span></code></pre></div>
<pre><code>## Coordinate Reference System:
##   User input: NAD27 
##   wkt:
## GEOGCRS[&quot;NAD27&quot;,
##     DATUM[&quot;North American Datum 1927&quot;,
##         ELLIPSOID[&quot;Clarke 1866&quot;,6378206.4,294.978698213898,
##             LENGTHUNIT[&quot;metre&quot;,1]]],
##     PRIMEM[&quot;Greenwich&quot;,0,
##         ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     CS[ellipsoidal,2],
##         AXIS[&quot;latitude&quot;,north,
##             ORDER[1],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##         AXIS[&quot;longitude&quot;,east,
##             ORDER[2],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     ID[&quot;EPSG&quot;,4267]]</code></pre>
</div>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_crs</span>(b.sf)<span class="sc">$</span>proj4string</span></code></pre></div>
<pre><code>## [1] &quot;+proj=longlat +datum=NAD27 +no_defs&quot;</code></pre>
</div>
</div>
<div id="пространственный-охват" class="section level4">
<h4>Пространственный охват</h4>
<div id="sp-4" class="section level5">
<h5><code>sp</code></h5>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">bbox</span>(b.sp)</span></code></pre></div>
<pre><code>##         min       max
## x -84.32385 -75.45698
## y  33.88199  36.58965</code></pre>
</div>
<div id="sf-4" class="section level5">
<h5><code>sf</code></h5>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_bbox</span>(b.sf)</span></code></pre></div>
<pre><code>##      xmin      ymin      xmax      ymax 
## -84.32385  33.88199 -75.45698  36.58965</code></pre>
</div>
</div>
</div>
<div id="создание" class="section level3 middle">
<h3 class="middle">Создание</h3>
<p>Создание пространственных данных, например, новый слой ГИС</p>
<p>Выйдем из здания вокзала ст. Валдай и создадим точечный <code>Spatial</code>-объект:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" tabindex="-1"></a>pt0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lon=</span><span class="fl">33.24529</span>,<span class="at">lat=</span><span class="fl">57.97012</span>)</span>
<span id="cb213-2"><a href="#cb213-2" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">coordinates</span>(pt0) <span class="ot">&lt;-</span> <span class="er">~</span>lon<span class="sc">+</span>lat</span>
<span id="cb213-3"><a href="#cb213-3" tabindex="-1"></a><span class="fu">try</span>(sp<span class="sc">::</span><span class="fu">proj4string</span>(pt0) <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:4326&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in CPL_crs_from_input(x): GDAL Message 1: +init=epsg:XXXX syntax is deprecated. It might return a
## CRS with a non-EPSG compliant axis order.</code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">proj4string</span>(pt0) <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">CRS</span>(<span class="st">&quot;EPSG:4326&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">glance</span>(pt0,<span class="at">resetProj=</span><span class="cn">TRUE</span>,<span class="at">style=</span><span class="st">&quot;Stadia.OSMBright&quot;</span></span>
<span id="cb216-2"><a href="#cb216-2" tabindex="-1"></a>            ,<span class="at">basemap.order=</span><span class="st">&quot;before&quot;</span>,<span class="at">basemap.alpha=</span><span class="dv">1</span>,<span class="at">dpi=</span><span class="dv">91</span>)</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/ursa11_Valdai.png" width="419" /></p>
<p>Смотрим на структуру данных:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" tabindex="-1"></a><span class="fu">str</span>(pt0)</span></code></pre></div>
<pre><code>## Formal class &#39;SpatialPoints&#39; [package &quot;sp&quot;] with 3 slots
##   ..@ coords     : num [1, 1:2] 33.2 58
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr &quot;1&quot;
##   .. .. ..$ : chr [1:2] &quot;lon&quot; &quot;lat&quot;
##   ..@ bbox       : num [1:2, 1:2] 33.2 58 33.2 58
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:2] &quot;lon&quot; &quot;lat&quot;
##   .. .. ..$ : chr [1:2] &quot;min&quot; &quot;max&quot;
##   ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
##   .. .. ..@ projargs: chr &quot;+proj=longlat +datum=WGS84 +no_defs&quot;
##   .. .. ..$ comment: chr &quot;GEOGCRS[\&quot;WGS 84\&quot;,\n    ENSEMBLE[\&quot;World Geodetic System 1984 ensemble\&quot;,\n        MEMBER[\&quot;World Geodetic Sys&quot;| __truncated__</code></pre>
<p>Изменим проекцию для расчета расстояний по координатам:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" tabindex="-1"></a>pt0 <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">spTransform</span>(pt0,<span class="st">&quot;+proj=laea +lat_0=58 +lon_0=35 +datum=WGS84&quot;</span>)</span></code></pre></div>
<p>Извлечем координаты:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" tabindex="-1"></a>xy <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">coordinates</span>(pt0)</span></code></pre></div>
<p>Решаем перемещаться минутными сегментами в течение часа:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">60</span></span></code></pre></div>
<p>На основе координат создаем таблицу перемещения. По умолчанию весь период стоим на месте и смотрим на север:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" tabindex="-1"></a>loc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">step=</span><span class="fu">seq</span>(<span class="dv">0</span>,n),<span class="at">look=</span>pi<span class="sc">/</span><span class="dv">2</span>,<span class="at">x=</span>xy[,<span class="dv">1</span>],<span class="at">y=</span>xy[,<span class="dv">2</span>])</span></code></pre></div>
<p>Скорость перемещений (в м мин<sup>-1</sup>) в течение минуты случайна:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" tabindex="-1"></a>segment <span class="ot">&lt;-</span> <span class="fu">runif</span>(n,<span class="at">min=</span><span class="dv">5</span>,<span class="at">max=</span><span class="dv">80</span>)</span>
<span id="cb223-2"><a href="#cb223-2" tabindex="-1"></a><span class="fu">str</span>(segment)</span></code></pre></div>
<pre><code>##  num [1:60] 52.3 34.7 43.5 15.2 14.1 ...</code></pre>
<p>Задаем, что если следующий сегмент длинный, то отклонение направления от предыдущего сегмента будет меньше:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" tabindex="-1"></a>angle <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">-</span>segment<span class="sc">/</span><span class="dv">100</span>,<span class="cf">function</span>(x) <span class="fu">runif</span>(<span class="dv">1</span>,<span class="at">min=</span><span class="sc">-</span>x<span class="sc">*</span>pi,<span class="at">max=</span>x<span class="sc">*</span>pi))</span>
<span id="cb225-2"><a href="#cb225-2" tabindex="-1"></a><span class="fu">str</span>(angle)</span></code></pre></div>
<pre><code>##  num [1:60] 0.716 -0.33 0.255 -2.531 2.215 ...</code></pre>
<p>Заполняем последующие шаги на основе предыдущих:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(n)) {</span>
<span id="cb227-2"><a href="#cb227-2" tabindex="-1"></a>   loc<span class="sc">$</span>look[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (loc<span class="sc">$</span>look[i]<span class="sc">+</span>angle[i]) <span class="sc">%%</span> (<span class="dv">2</span><span class="sc">*</span>pi)</span>
<span id="cb227-3"><a href="#cb227-3" tabindex="-1"></a>   loc<span class="sc">$</span>x[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> loc<span class="sc">$</span>x[i]<span class="sc">+</span>segment[i]<span class="sc">*</span><span class="fu">cos</span>(loc<span class="sc">$</span>look[i<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb227-4"><a href="#cb227-4" tabindex="-1"></a>   loc<span class="sc">$</span>y[i<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> loc<span class="sc">$</span>y[i]<span class="sc">+</span>segment[i]<span class="sc">*</span><span class="fu">sin</span>(loc<span class="sc">$</span>look[i<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb227-5"><a href="#cb227-5" tabindex="-1"></a>}</span>
<span id="cb227-6"><a href="#cb227-6" tabindex="-1"></a><span class="fu">head</span>(loc)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">step</th>
<th align="right">look</th>
<th align="right">x</th>
<th align="right">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">1.570796</td>
<td align="right">-103834.6</td>
<td align="right">-1982.122</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2.286998</td>
<td align="right">-103868.9</td>
<td align="right">-1942.659</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">1.957072</td>
<td align="right">-103882.0</td>
<td align="right">-1910.512</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">2.211981</td>
<td align="right">-103908.1</td>
<td align="right">-1875.621</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">5.963900</td>
<td align="right">-103893.7</td>
<td align="right">-1880.384</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">1.895394</td>
<td align="right">-103898.1</td>
<td align="right">-1867.058</td>
</tr>
</tbody>
</table>
</div>
<p>Создадим линейный <code>sf</code>-объект</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" tabindex="-1"></a>tr <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>,n)</span></code></pre></div>
<p>Матрица (с двумя столбцами) координат задается как LINESTRING:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(n))</span>
<span id="cb229-2"><a href="#cb229-2" tabindex="-1"></a>   tr[[i]] <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_linestring</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(loc<span class="sc">$</span>x[i],loc<span class="sc">$</span>y[i],loc<span class="sc">$</span>x[i<span class="sc">+</span><span class="dv">1</span>],loc<span class="sc">$</span>y[i<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb229-3"><a href="#cb229-3" tabindex="-1"></a>                               ,<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<div class="oversize">
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" tabindex="-1"></a><span class="fu">str</span>(tr)</span></code></pre></div>
<pre><code>## List of 60
##  $ : &#39;XY&#39; num [1:2, 1:2] -103835 -103869 -1982 -1943
##  $ : &#39;XY&#39; num [1:2, 1:2] -103869 -103882 -1943 -1911
##  $ : &#39;XY&#39; num [1:2, 1:2] -103882 -103908 -1911 -1876
##  $ : &#39;XY&#39; num [1:2, 1:2] -103908 -103894 -1876 -1880
##  $ : &#39;XY&#39; num [1:2, 1:2] -103894 -103898 -1880 -1867
##  $ : &#39;XY&#39; num [1:2, 1:2] -103898 -103889 -1867 -1789
##  $ : &#39;XY&#39; num [1:2, 1:2] -103889 -103910 -1789 -1799
##  $ : &#39;XY&#39; num [1:2, 1:2] -103910 -103916 -1799 -1785
##  $ : &#39;XY&#39; num [1:2, 1:2] -103916 -103941 -1785 -1809
##  $ : &#39;XY&#39; num [1:2, 1:2] -103941 -104003 -1809 -1817
##  $ : &#39;XY&#39; num [1:2, 1:2] -104003 -104023 -1817 -1839
##  $ : &#39;XY&#39; num [1:2, 1:2] -104023 -104014 -1839 -1846
##  $ : &#39;XY&#39; num [1:2, 1:2] -104014 -103981 -1846 -1834
##  $ : &#39;XY&#39; num [1:2, 1:2] -103981 -103962 -1834 -1805
##  $ : &#39;XY&#39; num [1:2, 1:2] -103962 -103927 -1805 -1798
##  $ : &#39;XY&#39; num [1:2, 1:2] -103927 -103848 -1798 -1807
##  $ : &#39;XY&#39; num [1:2, 1:2] -103848 -103814 -1807 -1812
##  $ : &#39;XY&#39; num [1:2, 1:2] -103814 -103754 -1812 -1776
##  $ : &#39;XY&#39; num [1:2, 1:2] -103754 -103684 -1776 -1743
##  $ : &#39;XY&#39; num [1:2, 1:2] -103684 -103668 -1743 -1781
##  $ : &#39;XY&#39; num [1:2, 1:2] -103668 -103665 -1781 -1827
##  $ : &#39;XY&#39; num [1:2, 1:2] -103665 -103641 -1827 -1878
##  $ : &#39;XY&#39; num [1:2, 1:2] -103641 -103622 -1878 -1914
##  $ : &#39;XY&#39; num [1:2, 1:2] -103622 -103566 -1914 -1971
##  $ : &#39;XY&#39; num [1:2, 1:2] -103566 -103550 -1971 -2020
##  $ : &#39;XY&#39; num [1:2, 1:2] -103550 -103499 -2020 -2046
##  $ : &#39;XY&#39; num [1:2, 1:2] -103499 -103436 -2046 -2031
##  $ : &#39;XY&#39; num [1:2, 1:2] -103436 -103421 -2031 -2003
##  $ : &#39;XY&#39; num [1:2, 1:2] -103421 -103436 -2003 -1935
##  $ : &#39;XY&#39; num [1:2, 1:2] -103436 -103451 -1935 -1934
##  $ : &#39;XY&#39; num [1:2, 1:2] -103451 -103502 -1934 -1896
##  $ : &#39;XY&#39; num [1:2, 1:2] -103502 -103497 -1896 -1829
##  $ : &#39;XY&#39; num [1:2, 1:2] -103497 -103456 -1829 -1767
##  $ : &#39;XY&#39; num [1:2, 1:2] -103456 -103454 -1767 -1717
##  $ : &#39;XY&#39; num [1:2, 1:2] -103454 -103473 -1717 -1662
##  $ : &#39;XY&#39; num [1:2, 1:2] -103473 -103435 -1662 -1652
##  $ : &#39;XY&#39; num [1:2, 1:2] -103435 -103414 -1652 -1688
##  $ : &#39;XY&#39; num [1:2, 1:2] -103414 -103367 -1688 -1732
##  $ : &#39;XY&#39; num [1:2, 1:2] -103367 -103379 -1732 -1747
##  $ : &#39;XY&#39; num [1:2, 1:2] -103379 -103425 -1747 -1762
##  $ : &#39;XY&#39; num [1:2, 1:2] -103425 -103434 -1762 -1775
##  $ : &#39;XY&#39; num [1:2, 1:2] -103434 -103425 -1775 -1780
##  $ : &#39;XY&#39; num [1:2, 1:2] -103425 -103386 -1780 -1799
##  $ : &#39;XY&#39; num [1:2, 1:2] -103386 -103391 -1799 -1771
##  $ : &#39;XY&#39; num [1:2, 1:2] -103391 -103370 -1771 -1767
##  $ : &#39;XY&#39; num [1:2, 1:2] -103370 -103376 -1767 -1757
##  $ : &#39;XY&#39; num [1:2, 1:2] -103376 -103375 -1757 -1764
##  $ : &#39;XY&#39; num [1:2, 1:2] -103375 -103321 -1764 -1807
##  $ : &#39;XY&#39; num [1:2, 1:2] -103321 -103329 -1807 -1843
##  $ : &#39;XY&#39; num [1:2, 1:2] -103329 -103306 -1843 -1868
##  $ : &#39;XY&#39; num [1:2, 1:2] -103306 -103304 -1868 -1854
##  $ : &#39;XY&#39; num [1:2, 1:2] -103304 -103317 -1854 -1834
##  $ : &#39;XY&#39; num [1:2, 1:2] -103317 -103310 -1834 -1840
##  $ : &#39;XY&#39; num [1:2, 1:2] -103310 -103311 -1840 -1818
##  $ : &#39;XY&#39; num [1:2, 1:2] -103311 -103336 -1818 -1755
##  $ : &#39;XY&#39; num [1:2, 1:2] -103336 -103392 -1755 -1733
##  $ : &#39;XY&#39; num [1:2, 1:2] -103392 -103402 -1733 -1706
##  $ : &#39;XY&#39; num [1:2, 1:2] -103402 -103359 -1706 -1685
##  $ : &#39;XY&#39; num [1:2, 1:2] -103359 -103322 -1685 -1673
##  $ : &#39;XY&#39; num [1:2, 1:2] -103322 -103326 -1673 -1667</code></pre>
</div>
<p>Набор сегментов объединяем в геометрию:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" tabindex="-1"></a>tr <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sfc</span>(tr,<span class="at">crs=</span>sp<span class="sc">::</span><span class="fu">proj4string</span>(pt0))</span>
<span id="cb232-2"><a href="#cb232-2" tabindex="-1"></a><span class="fu">str</span>(tr)</span></code></pre></div>
<pre><code>## sfc_LINESTRING of length 60; first list element:  &#39;XY&#39; num [1:2, 1:2] -103835 -103869 -1982 -1943</code></pre>
<p>С геометрией связываем атрибутивную таблицу.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" tabindex="-1"></a>tr <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sf</span>(<span class="at">step=</span><span class="fu">seq</span>(n),<span class="at">segment=</span>segment,<span class="at">geometry=</span>tr)</span>
<span id="cb234-2"><a href="#cb234-2" tabindex="-1"></a><span class="fu">str</span>(tr)</span></code></pre></div>
<pre><code>## Classes &#39;sf&#39; and &#39;data.frame&#39;:   60 obs. of  3 variables:
##  $ step    : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ segment : num  52.3 34.7 43.5 15.2 14.1 ...
##  $ geometry:sfc_LINESTRING of length 60; first list element:  &#39;XY&#39; num [1:2, 1:2] -103835 -103869 -1982 -1943
##  - attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
##  - attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA
##   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;step&quot; &quot;segment&quot;</code></pre>
</div>
<div id="визуализация-1" class="section level3">
<h3>Визуализация</h3>
<div id="статическая" class="section level4">
<h4>Статическая</h4>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">session_grid</span>(<span class="cn">NULL</span>)</span>
<span id="cb236-2"><a href="#cb236-2" tabindex="-1"></a>ursa<span class="sc">::</span><span class="fu">glance</span>(tr,<span class="at">style=</span><span class="st">&quot;opentopomap&quot;</span>,<span class="at">plot.lwd=</span><span class="dv">5</span></span>
<span id="cb236-3"><a href="#cb236-3" tabindex="-1"></a>            ,<span class="at">layout=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">legend=</span><span class="fu">list</span>(<span class="st">&quot;left&quot;</span>,<span class="fu">list</span>(<span class="st">&quot;bottom&quot;</span>,<span class="dv">2</span>)),<span class="at">las=</span><span class="dv">1</span>,<span class="at">dpi=</span><span class="dv">96</span>)</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/ursa13_route.png" width="1333" height="500" bound /></p>
<div class="middle">
<p>Графическое отображение переопределенной под класс объекта функцией <code>plot()</code> средствами библиотеки <code>sp</code> и <code>sf</code> развито слабо…</p>
</div>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" tabindex="-1"></a><span class="fu">plot</span>(tr,<span class="at">lwd=</span><span class="dv">5</span>) <span class="do">## &#39;sf&#39;-object</span></span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/trplot-sf-1.svg" width="646.08" bound /></p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">as_Spatial</span>(tr),<span class="at">lwd=</span><span class="dv">5</span>) <span class="do">## &#39;sp&#39;-object (&#39;SpatialPointsDataFrame&#39;)</span></span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/trplot-sp-1.svg" width="646.08" bound /></p>
<p><a href="#importExample">Возвращаясь</a> к ранее загруженным данным</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" tabindex="-1"></a><span class="fu">plot</span>(b.sf[<span class="st">&quot;SID79&quot;</span>])</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/scotplot-1.svg" width="646.08" height="550" /></p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_geometry</span>(b.sf),<span class="at">col=</span>sf<span class="sc">::</span><span class="fu">sf.colors</span>(<span class="dv">12</span>,<span class="at">categorical=</span><span class="cn">TRUE</span>)</span>
<span id="cb240-2"><a href="#cb240-2" tabindex="-1"></a>    ,<span class="at">border=</span><span class="st">&#39;grey&#39;</span>,<span class="at">axes=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/scotplotgeom-1.svg" width="646.08" height="550" /></p>
<div class="middle">
<p>Для оформления карт можно использовать функционал других библиотек.</p>
</div>
<div id="ggplot2" class="section level5">
<h5><code>ggplot2</code></h5>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span></code></pre></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb243-2"><a href="#cb243-2" tabindex="-1"></a>   <span class="fu">geom_sf</span>(<span class="at">data=</span>b.sf,<span class="fu">aes</span>(<span class="at">fill=</span>SID79))<span class="sc">+</span></span>
<span id="cb243-3"><a href="#cb243-3" tabindex="-1"></a>   <span class="fu">coord_sf</span>(<span class="at">crs=</span>sf<span class="sc">::</span><span class="fu">st_crs</span>(<span class="dv">3857</span>))</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/geomsf-1.svg" width="646.08" height="500" /></p>
</div>
<div id="tmap" class="section level5">
<h5><code>tmap</code></h5>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" tabindex="-1"></a><span class="fu">require</span>(tmap)</span></code></pre></div>
<pre><code>## Loading required package: tmap</code></pre>
<pre><code>## Breaking News: tmap 3.x is retiring. Please test v4, e.g. with
## remotes::install_github(&#39;r-tmap/tmap&#39;)</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;plot&quot;</span>)</span></code></pre></div>
<pre><code>## tmap mode set to plotting</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" tabindex="-1"></a>(tm1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(b.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="st">&quot;FIPSNO&quot;</span>) <span class="sc">+</span> <span class="fu">tm_scale_bar</span>() <span class="sc">+</span></span>
<span id="cb249-2"><a href="#cb249-2" tabindex="-1"></a>   <span class="fu">tm_compass</span>(<span class="at">position=</span><span class="fu">c</span>(<span class="st">&quot;left&quot;</span>,<span class="st">&quot;bottom&quot;</span>)) <span class="sc">+</span> <span class="fu">tm_graticules</span>())</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/tmap-plot-1.svg" width="646.08" height="445" /></p>
</div>
<div id="для-публикаций" class="section level5">
<h5>Для публикаций</h5>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" tabindex="-1"></a>fileout4 <span class="ot">&lt;-</span> <span class="st">&quot;assets/general/firstmap.png&quot;</span></span>
<span id="cb250-2"><a href="#cb250-2" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">dirname</span>(fileout4)))</span>
<span id="cb250-3"><a href="#cb250-3" tabindex="-1"></a>   <span class="fu">dir.create</span>(<span class="fu">dirname</span>(fileout4),<span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb250-4"><a href="#cb250-4" tabindex="-1"></a><span class="fu">png</span>(fileout4, <span class="at">res=</span><span class="dv">300</span>, <span class="at">width=</span><span class="dv">1600</span>, <span class="at">height=</span><span class="dv">1200</span>,</span>
<span id="cb250-5"><a href="#cb250-5" tabindex="-1"></a>    <span class="at">type=</span><span class="st">&quot;cairo&quot;</span>, <span class="at">pointsize=</span><span class="dv">12</span>, <span class="at">family=</span><span class="st">&quot;sans&quot;</span>)</span>
<span id="cb250-6"><a href="#cb250-6" tabindex="-1"></a><span class="fu">print</span>(tm1)</span>
<span id="cb250-7"><a href="#cb250-7" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## devSVG 
##      2</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(fileout4) <span class="do">## try &#39;browseURL(fileout4)&#39;</span></span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/57762a52~chunk.png" width="800" bound /></p>
</div>
</div>
<div id="интерактивная" class="section level4">
<h4>Интерактивная</h4>
<div id="mapview" class="section level5">
<h5><code>mapview</code></h5>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> mapview<span class="sc">::</span><span class="fu">mapview</span>(b.sf) <span class="do">## Не отобразится в Jupyter R Notebook.</span></span>
<span id="cb253-2"><a href="#cb253-2" tabindex="-1"></a>ursa<span class="sc">:::</span><span class="fu">widgetize</span>(m<span class="sc">@</span>map)</span></code></pre></div>
<div class="framed">
<iframe src="assets/lesson05/widget_mapview_0d592282862eac0f46e7e1e978dfe1bb.html" width="646.08" height="400px" data-external="1" class="ursa-widgetize">
</iframe>
</div>
</div>
<div id="leaflet" class="section level5">
<h5><code>leaflet</code></h5>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" tabindex="-1"></a><span class="fu">require</span>(leaflet)</span></code></pre></div>
<pre><code>## Loading required package: leaflet</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" tabindex="-1"></a>b <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(b.sf,<span class="dv">4326</span>)</span>
<span id="cb256-2"><a href="#cb256-2" tabindex="-1"></a>b<span class="sc">$</span>category <span class="ot">&lt;-</span> <span class="fu">factor</span>(b<span class="sc">$</span>SID79,<span class="at">ordered=</span><span class="cn">TRUE</span>)</span>
<span id="cb256-3"><a href="#cb256-3" tabindex="-1"></a>fpal <span class="ot">&lt;-</span> <span class="fu">colorFactor</span>(<span class="fu">topo.colors</span>(<span class="dv">5</span>),b<span class="sc">$</span>category)</span>
<span id="cb256-4"><a href="#cb256-4" tabindex="-1"></a>provList <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;CartoDB.Positron&quot;</span>,<span class="st">&quot;CartoDB.DarkMatter&quot;</span>,<span class="st">&quot;Esri.OceanBasemap&quot;</span>)</span>
<span id="cb256-5"><a href="#cb256-5" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">leaflet</span>()</span>
<span id="cb256-6"><a href="#cb256-6" tabindex="-1"></a><span class="cf">for</span> (p <span class="cf">in</span> <span class="fu">c</span>(provList)) m <span class="ot">&lt;-</span> <span class="fu">addProviderTiles</span>(m,providers[[p]],<span class="at">group=</span>p)</span>
<span id="cb256-7"><a href="#cb256-7" tabindex="-1"></a>m <span class="ot">&lt;-</span> m <span class="sc">%&gt;%</span> </span>
<span id="cb256-8"><a href="#cb256-8" tabindex="-1"></a>   <span class="fu">addPolygons</span>(<span class="at">data=</span>b,<span class="at">fillColor=</span><span class="sc">~</span><span class="fu">fpal</span>(category),<span class="at">fillOpacity=</span><span class="fl">0.5</span></span>
<span id="cb256-9"><a href="#cb256-9" tabindex="-1"></a>              ,<span class="at">weight=</span><span class="fl">1.6</span>,<span class="at">color=</span><span class="sc">~</span><span class="fu">fpal</span>(category),<span class="at">opacity=</span><span class="fl">0.75</span></span>
<span id="cb256-10"><a href="#cb256-10" tabindex="-1"></a>              ,<span class="at">label=</span><span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;SID79: &quot;</span>,SID79,<span class="st">&quot; (&quot;</span>,NAME,<span class="st">&quot;)&quot;</span>)</span>
<span id="cb256-11"><a href="#cb256-11" tabindex="-1"></a>              ,<span class="at">popup=</span><span class="sc">~</span><span class="fu">sprintf</span>(<span class="st">&quot;Например, поле AREA, равное %.3f&quot;</span>,AREA)</span>
<span id="cb256-12"><a href="#cb256-12" tabindex="-1"></a>              ) <span class="sc">%&gt;%</span></span>
<span id="cb256-13"><a href="#cb256-13" tabindex="-1"></a>   <span class="fu">addMeasure</span>(<span class="st">&quot;topright&quot;</span>,<span class="at">primaryLengthUnit=</span><span class="st">&quot;meters&quot;</span></span>
<span id="cb256-14"><a href="#cb256-14" tabindex="-1"></a>             ,<span class="at">primaryAreaUnit=</span><span class="st">&quot;sqmeters&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb256-15"><a href="#cb256-15" tabindex="-1"></a>   <span class="fu">addScaleBar</span>(<span class="st">&quot;bottomright&quot;</span></span>
<span id="cb256-16"><a href="#cb256-16" tabindex="-1"></a>             <span class="co"># ,options = scaleBarOptions(imperial=FALSE,maxWidth=400)</span></span>
<span id="cb256-17"><a href="#cb256-17" tabindex="-1"></a>              ) <span class="sc">%&gt;%</span></span>
<span id="cb256-18"><a href="#cb256-18" tabindex="-1"></a>   <span class="fu">addLayersControl</span>(<span class="at">position=</span><span class="st">&quot;topleft&quot;</span></span>
<span id="cb256-19"><a href="#cb256-19" tabindex="-1"></a>                   ,<span class="at">baseGroups=</span><span class="fu">c</span>(provList)</span>
<span id="cb256-20"><a href="#cb256-20" tabindex="-1"></a>                   ,<span class="at">options=</span><span class="fu">layersControlOptions</span>(<span class="at">collapsed=</span><span class="cn">TRUE</span>)</span>
<span id="cb256-21"><a href="#cb256-21" tabindex="-1"></a>                   ) <span class="sc">%&gt;%</span></span>
<span id="cb256-22"><a href="#cb256-22" tabindex="-1"></a>   <span class="fu">addLegend</span>(<span class="st">&quot;bottomright&quot;</span>,<span class="at">pal=</span>fpal,<span class="at">values=</span>b<span class="sc">$</span>category,<span class="at">opacity=</span><span class="fl">0.6</span></span>
<span id="cb256-23"><a href="#cb256-23" tabindex="-1"></a>            ,<span class="at">title=</span><span class="st">&quot;SID79&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" tabindex="-1"></a>ursa<span class="sc">:::</span><span class="fu">widgetize</span>(m) <span class="do">## Не отображается в Jupyter R Notebook.</span></span></code></pre></div>
<div class="framed">
<iframe src="assets/lesson05/widget_leadletwidget_e1d2c7ffe9cc8869346248e321387887.html" width="646.08" height="400px" data-external="1" class="ursa-widgetize">
</iframe>
</div>
</div>
<div id="tmap-1" class="section level5">
<h5><code>tmap</code></h5>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;view&quot;</span>)</span></code></pre></div>
<pre><code>## tmap mode set to interactive viewing</code></pre>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" tabindex="-1"></a>tm <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(b.sf) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="st">&quot;FIPSNO&quot;</span>)</span>
<span id="cb260-2"><a href="#cb260-2" tabindex="-1"></a>ursa<span class="sc">:::</span><span class="fu">widgetize</span>(<span class="fu">tmap_leaflet</span>(tm),<span class="at">height=</span><span class="dv">510</span>)</span></code></pre></div>
<div class="framed">
<iframe src="assets/lesson05/widget_tmap-view_22e2d85487f51e2008102f4173f45a5c.html" width="646.08" height="510" data-external="1" class="ursa-widgetize">
</iframe>
</div>
<p><a href="https://cran.rstudio.com/web/packages/tmap/vignettes/tmap-getstarted.html"><code>tmap</code> “Get Started” vignette</a></p>
<iframe src="https://cran.rstudio.com/web/packages/tmap/vignettes/tmap-getstarted.html" width="646.08" height="610" data-external="1">
</iframe>
</div>
<div id="примеры" class="section level5">
<h5>Примеры</h5>
<p><a href="https://bhaskarvk.github.io/user2017.geodataviz/">GeoSpatial Data Visualization in R</a></p>
<iframe src="https://bhaskarvk.github.io/user2017.geodataviz/" width="646.08" height="610" data-external="1">
</iframe>
</div>
</div>
</div>
<div id="экспорт" class="section level3 middle">
<h3 class="middle">Экспорт</h3>
<p>Сохранить пространственные данные в файл</p>
<div id="sprgdal" class="section level5">
<h5><code>sp/rgdal</code></h5>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" tabindex="-1"></a>pt <span class="ot">&lt;-</span> loc</span>
<span id="cb261-2"><a href="#cb261-2" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">coordinates</span>(pt) <span class="ot">&lt;-</span> <span class="er">~</span>x<span class="sc">+</span>y</span>
<span id="cb261-3"><a href="#cb261-3" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">proj4string</span>(pt) <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">proj4string</span>(pt0)</span>
<span id="cb261-4"><a href="#cb261-4" tabindex="-1"></a>pt <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">spTransform</span>(pt,<span class="st">&quot;EPSG:4326&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: PROJ support is provided by the sf and terra packages among others</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" tabindex="-1"></a>fileout1 <span class="ot">&lt;-</span> <span class="st">&quot;afterTrain.geojson&quot;</span></span>
<span id="cb263-2"><a href="#cb263-2" tabindex="-1"></a>ret <span class="ot">&lt;-</span> <span class="fu">try</span>(rgdal<span class="sc">::</span><span class="fu">writeOGR</span>(pt,fileout1,<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">..+&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="fu">basename</span>(fileout1))</span>
<span id="cb263-3"><a href="#cb263-3" tabindex="-1"></a>                          ,<span class="at">driver=</span><span class="st">&quot;GeoJSON&quot;</span>,<span class="at">overwrite_layer=</span><span class="cn">TRUE</span>,<span class="at">morphToESRI=</span><span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">inherits</span>(ret,<span class="st">&quot;try-error&quot;</span>))</span>
<span id="cb266-2"><a href="#cb266-2" tabindex="-1"></a>   pt <span class="sc">|&gt;</span></span>
<span id="cb266-3"><a href="#cb266-3" tabindex="-1"></a>     sf<span class="sc">::</span><span class="fu">st_as_sf</span>() <span class="sc">|&gt;</span></span>
<span id="cb266-4"><a href="#cb266-4" tabindex="-1"></a>     sf<span class="sc">::</span><span class="fu">st_write</span>(fileout1,<span class="at">driver=</span><span class="st">&quot;GeoJSON&quot;</span></span>
<span id="cb266-5"><a href="#cb266-5" tabindex="-1"></a>                 ,<span class="at">delete_layer=</span><span class="fu">file.exists</span>(fileout1),<span class="at">delete_dsn=</span><span class="fu">file.exists</span>(fileout1))</span></code></pre></div>
<p>Проверим, появился ли файл:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" tabindex="-1"></a><span class="fu">dir</span>(<span class="at">pattern=</span><span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">..+&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="fu">basename</span>(fileout1),<span class="st">&quot;.*&quot;</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;afterTrain.geojson&quot;</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" tabindex="-1"></a><span class="fu">try</span>(ursa<span class="sc">::</span><span class="fu">glance</span>(fileout1,<span class="at">style=</span><span class="st">&quot;CartoDB&quot;</span>,<span class="at">las=</span><span class="dv">1</span>,<span class="at">size=</span><span class="dv">480</span>,<span class="at">dpi=</span><span class="dv">192</span>))</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/ursa15_glancept.png" width="388" bound /></p>
</div>
<div id="sf-5" class="section level5">
<h5><code>sf</code></h5>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" tabindex="-1"></a>b.sf <span class="ot">&lt;-</span> b.sf[,<span class="fu">c</span>(<span class="st">&quot;NAME&quot;</span>,<span class="st">&quot;SID79&quot;</span>)]</span>
<span id="cb270-2"><a href="#cb270-2" tabindex="-1"></a>b.sf<span class="sc">$</span><span class="st">&#39;категория&#39;</span> <span class="ot">&lt;-</span> b<span class="sc">$</span>category</span>
<span id="cb270-3"><a href="#cb270-3" tabindex="-1"></a>b.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(b.sf,<span class="dv">3857</span>)</span>
<span id="cb270-4"><a href="#cb270-4" tabindex="-1"></a>fileout2 <span class="ot">&lt;-</span> <span class="st">&quot;tahoe.sqlite&quot;</span></span>
<span id="cb270-5"><a href="#cb270-5" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(b.sf,<span class="at">dsn=</span>fileout2,<span class="at">layer=</span><span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">..+&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="fu">basename</span>(fileout2))</span>
<span id="cb270-6"><a href="#cb270-6" tabindex="-1"></a>            ,<span class="at">driver=</span><span class="st">&quot;SQLite&quot;</span>,<span class="at">layer_options=</span><span class="fu">c</span>(<span class="st">&quot;LAUNDER=NO&quot;</span>),<span class="at">quiet=</span><span class="cn">TRUE</span></span>
<span id="cb270-7"><a href="#cb270-7" tabindex="-1"></a>            ,<span class="at">delete_layer=</span><span class="fu">file.exists</span>(fileout2),<span class="at">delete_dsn=</span><span class="fu">file.exists</span>(fileout2))</span></code></pre></div>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" tabindex="-1"></a><span class="fu">dir</span>(<span class="at">pattern=</span><span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">..+&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="fu">basename</span>(fileout2),<span class="st">&quot;.*&quot;</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;tahoe.sqlite&quot;</code></pre>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" tabindex="-1"></a><span class="fu">try</span>(ursa<span class="sc">::</span><span class="fu">glance</span>(fileout2,<span class="at">resetGrid=</span><span class="cn">TRUE</span>,<span class="at">layout=</span><span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">1</span>)</span>
<span id="cb273-2"><a href="#cb273-2" tabindex="-1"></a>                ,<span class="at">style=</span><span class="st">&quot;opentopomap&quot;</span>,<span class="at">las=</span><span class="dv">1</span>,<span class="at">dpi=</span><span class="dv">192</span>,<span class="at">size=</span><span class="dv">480</span>))</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/ursa17_glancescot.png" width="310" bound /></p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" tabindex="-1"></a>fileout3 <span class="ot">&lt;-</span> <span class="st">&quot;track.shp&quot;</span></span>
<span id="cb274-2"><a href="#cb274-2" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(tr,<span class="at">dsn=</span>fileout3,<span class="at">layer=</span><span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">..+&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="fu">basename</span>(fileout2))</span>
<span id="cb274-3"><a href="#cb274-3" tabindex="-1"></a>            ,<span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>,<span class="at">quiet=</span><span class="cn">TRUE</span></span>
<span id="cb274-4"><a href="#cb274-4" tabindex="-1"></a>            ,<span class="at">delete_layer=</span><span class="fu">file.exists</span>(fileout3),<span class="at">delete_dsn=</span><span class="fu">file.exists</span>(fileout3))</span></code></pre></div>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" tabindex="-1"></a><span class="fu">dir</span>(<span class="at">pattern=</span><span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">..+&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="fu">basename</span>(fileout3),<span class="st">&quot;.*&quot;</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;track.dbf&quot; &quot;track.prj&quot; &quot;track.shp&quot; &quot;track.shx&quot;</code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" tabindex="-1"></a><span class="fu">try</span>(ursa<span class="sc">::</span><span class="fu">glance</span>(fileout3,<span class="at">resetGrid=</span><span class="cn">TRUE</span></span>
<span id="cb277-2"><a href="#cb277-2" tabindex="-1"></a>                ,<span class="at">style=</span><span class="st">&quot;CartoDB&quot;</span>,<span class="at">las=</span><span class="dv">1</span>,<span class="at">dpi=</span><span class="dv">192</span>,<span class="at">size=</span><span class="dv">480</span>))</span></code></pre></div>
<p class="centered-image"><img src="assets/lesson05/ursa19_glancetrack.png" width="361" bound /></p>
</div>
</div>
<div id="рисование" class="section level3">
<h3>Рисование</h3>
<p>Этот раздел предлагается пройти самостоятельно</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" tabindex="-1"></a>track <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_linestring</span>(<span class="fu">cbind</span>(loc<span class="sc">$</span>x,loc<span class="sc">$</span>y))</span>
<span id="cb278-2"><a href="#cb278-2" tabindex="-1"></a>track <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sf</span>(<span class="fu">data.frame</span>(<span class="at">desc=</span><span class="st">&quot;walk&quot;</span></span>
<span id="cb278-3"><a href="#cb278-3" tabindex="-1"></a>                  ,sf<span class="sc">::</span><span class="fu">st_sfc</span>(track,<span class="at">crs=</span>sp<span class="sc">::</span><span class="fu">proj4string</span>(pt0))))</span>
<span id="cb278-4"><a href="#cb278-4" tabindex="-1"></a>paint <span class="ot">&lt;-</span> mapview<span class="sc">::</span><span class="fu">viewExtent</span>(track,<span class="at">alpha=</span><span class="fl">0.01</span>) <span class="sc">%&gt;%</span> mapedit<span class="sc">::</span><span class="fu">editMap</span>(<span class="st">&quot;track&quot;</span>)</span>
<span id="cb278-5"><a href="#cb278-5" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb278-6"><a href="#cb278-6" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(paint<span class="sc">$</span>finished)) {</span>
<span id="cb278-7"><a href="#cb278-7" tabindex="-1"></a>   result <span class="ot">&lt;-</span> paint<span class="sc">$</span>finished</span>
<span id="cb278-8"><a href="#cb278-8" tabindex="-1"></a>   mapview<span class="sc">::</span><span class="fu">mapview</span>(result)</span>
<span id="cb278-9"><a href="#cb278-9" tabindex="-1"></a>   ursa<span class="sc">::</span><span class="fu">session_grid</span>(<span class="cn">NULL</span>)</span>
<span id="cb278-10"><a href="#cb278-10" tabindex="-1"></a>   ursa<span class="sc">::</span><span class="fu">glance</span>(result,<span class="at">style=</span><span class="st">&quot;CartoDB&quot;</span>)</span>
<span id="cb278-11"><a href="#cb278-11" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="дополнительно-по-r" class="section level2">
<h2>Дополнительно по R</h2>
<div id="воспроизводимость" class="section level3">
<h3>Воспроизво­ди­мость</h3>
<p>Ниже приведены фрагмента кода, которые не были выполнены при составлении программы занятия. Их предлагается выполнить самостоятельно. Также необходимо <a href="#pandoc">установленный Pandoc</a>.</p>
<p>Содержимое занятия сгенерировано из файла <code>lesson05.R</code>. Загрузим его, переименовав:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" tabindex="-1"></a>sfile <span class="ot">&lt;-</span> <span class="st">&quot;lesson05.R&quot;</span></span>
<span id="cb279-2"><a href="#cb279-2" tabindex="-1"></a>rfile <span class="ot">&lt;-</span> <span class="st">&quot;lesson05-reproduced.R&quot;</span></span>
<span id="cb279-3"><a href="#cb279-3" tabindex="-1"></a>{</span>
<span id="cb279-4"><a href="#cb279-4" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">file.exists</span>(sfile))</span>
<span id="cb279-5"><a href="#cb279-5" tabindex="-1"></a>      <span class="fu">file.copy</span>(sfile,rfile,<span class="at">overwrite=</span><span class="cn">TRUE</span>,<span class="at">copy.date=</span><span class="cn">TRUE</span>)</span>
<span id="cb279-6"><a href="#cb279-6" tabindex="-1"></a>   <span class="cf">else</span></span>
<span id="cb279-7"><a href="#cb279-7" tabindex="-1"></a>      <span class="fu">download.file</span>(<span class="fu">file.path</span>(<span class="st">&quot;https://nplatonov.github.io/sevinGIS&quot;</span>,sfile)</span>
<span id="cb279-8"><a href="#cb279-8" tabindex="-1"></a>                   ,rfile)</span>
<span id="cb279-9"><a href="#cb279-9" tabindex="-1"></a>}</span></code></pre></div>
<!-- file.copy("main.R","lesson.R",overwrite=TRUE,copy.date=TRUE) -->
<p>На основе этого файла создадим markdown-документ:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" tabindex="-1"></a>mdfile <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">spin</span>(rfile,<span class="at">knit=</span><span class="cn">FALSE</span>)</span>
<span id="cb280-2"><a href="#cb280-2" tabindex="-1"></a>mdfile</span></code></pre></div>
<p>Затем из markdown-документа сформируем html-документ:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" tabindex="-1"></a><span class="cf">if</span> (rmarkdown<span class="sc">::</span><span class="fu">pandoc_available</span>()) {</span>
<span id="cb281-2"><a href="#cb281-2" tabindex="-1"></a>   htmlfile <span class="ot">&lt;-</span> rmarkdown<span class="sc">::</span><span class="fu">render</span>(mdfile,<span class="at">output_format=</span><span class="st">&quot;html_document&quot;</span></span>
<span id="cb281-3"><a href="#cb281-3" tabindex="-1"></a>                                ,<span class="at">output_options=</span><span class="fu">list</span>(<span class="at">toc=</span><span class="cn">TRUE</span>))</span>
<span id="cb281-4"><a href="#cb281-4" tabindex="-1"></a>   <span class="fu">print</span>(<span class="fu">basename</span>(htmlfile))</span>
<span id="cb281-5"><a href="#cb281-5" tabindex="-1"></a>}</span></code></pre></div>
<p>Полученный html-документ можно открыть в браузере.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" tabindex="-1"></a><span class="cf">if</span> ((rmarkdown<span class="sc">::</span><span class="fu">pandoc_available</span>())<span class="sc">&amp;&amp;</span>(<span class="fu">file.exists</span>(htmlfile))) </span>
<span id="cb282-2"><a href="#cb282-2" tabindex="-1"></a>   <span class="fu">browseURL</span>(<span class="fu">basename</span>(htmlfile))</span></code></pre></div>
<p>И можно скопировать/переименовать/удалить</p>
<div id="параметры-сессии" class="section level4">
<h4>Параметры сессии</h4>
<div class="oversize font85">
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.3.3 RC (2024-02-22 r85988 ucrt)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 19045)
## 
## Matrix products: default
## 
## 
## locale:
## [1] LC_COLLATE=English_United Kingdom.utf8  LC_CTYPE=Russian_Russia.1251           
## [3] LC_MONETARY=English_United Kingdom.utf8 LC_NUMERIC=C                           
## [5] LC_TIME=English_United Kingdom.utf8    
## system code page: 65001
## 
## time zone: Europe/Moscow
## tzcode source: internal
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] leaflet_2.2.1 tmap_3.3-4    ggplot2_3.4.4
## 
## loaded via a namespace (and not attached):
##   [1] tidyselect_1.2.0        viridisLite_0.4.2       farver_2.1.1            dplyr_1.1.4            
##   [5] R.utils_2.12.3          fastmap_1.1.1           mapview_2.11.2          promises_1.2.1         
##   [9] XML_3.99-0.16.1         digest_0.6.34           mime_0.12               lifecycle_1.0.4        
##  [13] sf_1.0-15               ellipsis_0.3.2          plutil_0.9-7305         terra_1.7-71           
##  [17] magrittr_2.0.3          compiler_4.3.3          rlang_1.1.3             sass_0.4.8             
##  [21] tools_4.3.3             leafpop_0.1.0           utf8_1.2.4              yaml_2.3.8             
##  [25] knitr_1.45              brew_1.0-10             labeling_0.4.3          htmlwidgets_1.6.4      
##  [29] sp_2.1-3                classInt_0.4-10         RColorBrewer_1.1-3      abind_1.4-5            
##  [33] KernSmooth_2.23-22      withr_3.0.0             gdalUtils_2.0.3.2       leafsync_0.1.0         
##  [37] R.oo_1.26.0             grid_4.3.3              stats4_4.3.3            ursa_3.11.0-1070       
##  [41] fansi_1.0.6             mapedit_0.6.0           xtable_1.8-4            e1071_1.7-14           
##  [45] leafem_0.2.3            colorspace_2.1-0        scales_1.3.0            iterators_1.0.14       
##  [49] dichromat_2.0-0.1       cli_3.6.2               rmarkdown_2.25          generics_0.1.3         
##  [53] tmaptools_3.1-1         DBI_1.2.2               cachem_1.0.8            proxy_0.4-27           
##  [57] stars_0.6-4             parallel_4.3.3          s2_1.1.6                base64enc_0.1-3        
##  [61] vctrs_0.6.5             jsonlite_1.8.8          geojsonsf_2.0.3         systemfonts_1.0.5      
##  [65] crosstalk_1.2.1         foreach_1.5.2           jquerylib_0.1.4         units_0.8-5            
##  [69] rgdal_1.6-7             glue_1.7.0              lwgeom_0.2-13           leaflet.providers_2.0.0
##  [73] codetools_0.2-19        xaringanExtra_0.7.0     gtable_0.3.4            later_1.3.2            
##  [77] raster_3.6-26           munsell_0.5.0           tibble_3.2.1            pillar_1.9.0           
##  [81] htmltools_0.5.7         satellite_1.0.5         R6_2.5.1                wk_0.9.1               
##  [85] tcltk_4.3.3             evaluate_0.23           shiny_1.8.0             lattice_0.22-5         
##  [89] highr_0.10              png_0.1-8               R.methodsS3_1.8.2       httpuv_1.6.14          
##  [93] bslib_0.6.1             class_7.3-22            uuid_1.2-0              Rcpp_1.0.12            
##  [97] widgetframe_0.3.1       svglite_2.1.3           xfun_0.42               pkgconfig_2.0.3</code></pre>
</div>
</div>
</div>
<div id="узнать-больше-об-r" class="section level3">
<h3>Узнать больше об R</h3>
<ul>
<li><p><a href="https://www.r-bloggers.com/">R-Bloggers</a> – современные тенденции R</p></li>
<li><p><a href="https://rweekly.org/">R-Weekly</a> – еженедельные новости из мира R: блог, новые пакеты, предсоящие мероприятия</p></li>
<li><p>R’s <a href="https://cran.rstudio.com/web/views/Spatial.html">Spatial</a> and <a href="https://cran.rstudio.com/web/views/SpatioTemporal.html">SpatioTemporal</a> Task Views</p></li>
<li><p><a href="https://www.r-spatial.org/">R-Spatial</a> – веб-сайт и блог для интересующихся использованием R для анализа пространственных и пространственно-временных данных</p></li>
<li><p><a href="https://geocompr.github.io">Geocomputation with R</a> - book and relative</p></li>
<li><p><a href="https://stackoverflow.com/feeds/tag/r">Stackoverflow</a> с тегом #R.</p></li>
<li><p><a href="https://gis.stackexchange.com/questions">Stackexchange</a> о ГИС, в т.ч. с использованием R.</p></li>
<li><p>Package’s vignettes – обобщенное знакомство с библиотекой. Обычно содержат воспроизводимый код.</p></li>
</ul>
<div id="книги" class="section level4">
<h4>Книги</h4>
<ul>
<li><a href="https://bookdown.org/michael_bcalles/gis-crash-course-in-r/">A Crash Course in Geographic Information Systems (GIS) using R</a></li>
</ul>
</div>
</div>
</div>
<div id="section" class="section level1 additional">
<h1 class="additional"></h1>
<div class="small bottom">
<p>Данные после занятия остались на диске. Если не нужны, выполнить следующее:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">dir</span>(<span class="at">pattern=</span><span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">..+&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="fu">basename</span>(fileout1),<span class="st">&quot;.*&quot;</span>))))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">dir</span>(<span class="at">pattern=</span><span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">..+&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="fu">basename</span>(fileout2),<span class="st">&quot;.*&quot;</span>))))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">dir</span>(<span class="at">pattern=</span><span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">..+&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="fu">basename</span>(fileout3),<span class="st">&quot;.*&quot;</span>))))</span></code></pre></div>
<pre><code>## [1] TRUE TRUE TRUE TRUE</code></pre>
</div>
<style type="text/css">
:root {
   --pointsize: 20pt;
   --sidebar-pointsize: 78%;
   --sidebar: 25%;
}
</style>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
